import{$ as Ht,Ea as Wn,Ec as zs,Y as al,a as Wr,ac as ll,b as Gr,bc as hl,ca as He,da as Oe,ea as Qt,ec as js,g as T,ga as cl,ha as Kr,ia as ul,j as St,o as sl,p as ol,pa as dt,r as Us,s as Bs,t as qs,ta as Hr,va as Fe,z as $s}from"./chunk-2WHKZRHE.js";var fl=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Lp=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let o=n[t++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){let o=n[t++],a=n[t++],u=n[t++],h=((i&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{let o=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return e.join("")},Qr={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let o=n[i],a=i+1<n.length,u=a?n[i+1]:0,h=i+2<n.length,f=h?n[i+2]:0,m=o>>2,I=(o&3)<<4|u>>4,S=(u&15)<<2|f>>6,R=f&63;h||(R=64,a||(S=64)),r.push(t[m],t[I],t[S],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(fl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Lp(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let o=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;let f=i<n.length?t[n.charAt(i)]:64;++i;let I=i<n.length?t[n.charAt(i)]:64;if(++i,o==null||u==null||f==null||I==null)throw new Gs;let S=o<<2|u>>4;if(r.push(S),f!==64){let R=u<<4&240|f>>2;if(r.push(R),I!==64){let O=f<<6&192|I;r.push(O)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Gs=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Mp=function(n){let e=fl(n);return Qr.encodeByteArray(e,!0)},Gn=function(n){return Mp(n).replace(/\./g,"")},Yr=function(n){try{return Qr.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function pl(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Fp=()=>pl().__FIREBASE_DEFAULTS__,Up=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Bp=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&Yr(n[1]);return e&&JSON.parse(e)},Jr=()=>{try{return Fp()||Up()||Bp()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ml=n=>{var e,t;return(t=(e=Jr())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},gl=n=>{let e=ml(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},Hs=()=>{var n;return(n=Jr())===null||n===void 0?void 0:n.config},_l=n=>{var e;return(e=Jr())===null||e===void 0?void 0:e[`_${n}`]};var Rt=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function yl(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Gn(JSON.stringify(t)),Gn(JSON.stringify(a)),""].join(".")}function Se(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Il(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Se())}function qp(){var n;let e=(n=Jr())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function vl(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Xr(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function El(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function wl(){return!qp()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Pt(){try{return typeof indexedDB=="object"}catch{return!1}}function Zr(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var o;e(((o=i.error)===null||o===void 0?void 0:o.message)||"")}}catch(t){e(t)}})}function Tl(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}var $p="FirebaseError",_e=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=$p,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Te.prototype.create)}},Te=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,o=this.errors[e],a=o?jp(o,r):"Error",u=`${this.serviceName}: ${a} (${i}).`;return new _e(i,u,r)}};function jp(n,e){return n.replace(zp,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var zp=/\{\$([^}]+)}/g;function ft(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let o=n[i],a=e[i];if(dl(o)&&dl(a)){if(!ft(o,a))return!1}else if(o!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function dl(n){return n!==null&&typeof n=="object"}function Qs(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Al(n,e){let t=new Ks(n,e);return t.subscribe.bind(t)}var Ks=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Wp(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=Ws),i.error===void 0&&(i.error=Ws),i.complete===void 0&&(i.complete=Ws);let o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Wp(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Ws(){}var Gp=1e3,Kp=2,Hp=4*60*60*1e3,Qp=.5;function ei(n,e=Gp,t=Kp){let r=e*Math.pow(t,n),i=Math.round(Qp*r*(Math.random()-.5)*2);return Math.min(Hp,r+i)}function Pe(n){return n&&n._delegate?n._delegate:n}var re=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Ct="[DEFAULT]";var Ys=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new Rt;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Jp(e))try{this.getOrInitializeService({instanceIdentifier:Ct})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=Ct){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return T(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Ct){return this.instances.has(e)}getOptions(e=Ct){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[o,a]of this.instancesDeferred.entries()){let u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),o=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;o.add(e),this.onInitCallbacks.set(i,o);let a=this.instances.get(i);return a&&e(a,i),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Yp(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Ct){return this.component?this.component.multipleInstances?e:Ct:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Yp(n){return n===Ct?void 0:n}function Jp(n){return n.instantiationMode==="EAGER"}var ti=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new Ys(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var Xp=[],U=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(U||{}),Zp={debug:U.DEBUG,verbose:U.VERBOSE,info:U.INFO,warn:U.WARN,error:U.ERROR,silent:U.SILENT},em=U.INFO,tm={[U.DEBUG]:"log",[U.VERBOSE]:"log",[U.INFO]:"info",[U.WARN]:"warn",[U.ERROR]:"error"},nm=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=tm[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Ce=class{constructor(e){this.name=e,this._logLevel=em,this._logHandler=nm,this._userLogHandler=null,Xp.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in U))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Zp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,U.DEBUG,...e),this._logHandler(this,U.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,U.VERBOSE,...e),this._logHandler(this,U.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,U.INFO,...e),this._logHandler(this,U.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,U.WARN,...e),this._logHandler(this,U.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,U.ERROR,...e),this._logHandler(this,U.ERROR,...e)}};var rm=(n,e)=>e.some(t=>n instanceof t),bl,Sl;function im(){return bl||(bl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sm(){return Sl||(Sl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Rl=new WeakMap,Xs=new WeakMap,Pl=new WeakMap,Js=new WeakMap,eo=new WeakMap;function om(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(Ue(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Rl.set(t,n)}).catch(()=>{}),eo.set(e,n),e}function am(n){if(Xs.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Xs.set(n,e)}var Zs={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Xs.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Pl.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ue(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Cl(n){Zs=n(Zs)}function cm(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(ni(this),e,...t);return Pl.set(r,e.sort?e.sort():[e]),Ue(r)}:sm().includes(n)?function(...e){return n.apply(ni(this),e),Ue(Rl.get(this))}:function(...e){return Ue(n.apply(ni(this),e))}}function um(n){return typeof n=="function"?cm(n):(n instanceof IDBTransaction&&am(n),rm(n,im())?new Proxy(n,Zs):n)}function Ue(n){if(n instanceof IDBRequest)return om(n);if(Js.has(n))return Js.get(n);let e=um(n);return e!==n&&(Js.set(n,e),eo.set(e,n)),e}var ni=n=>eo.get(n);function ri(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){let a=indexedDB.open(n,e),u=Ue(a);return r&&a.addEventListener("upgradeneeded",h=>{r(Ue(a.result),h.oldVersion,h.newVersion,Ue(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),i&&h.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}var lm=["get","getKey","getAll","getAllKeys","count"],hm=["put","add","delete","clear"],to=new Map;function kl(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(to.get(e))return to.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=hm.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||lm.includes(t)))return;let o=function(a,...u){return T(this,null,function*(){let h=this.transaction(a,i?"readwrite":"readonly"),f=h.store;return r&&(f=f.index(u.shift())),(yield Promise.all([f[t](...u),i&&h.done]))[0]})};return to.set(e,o),o}Cl(n=>Gr(Wr({},n),{get:(e,t,r)=>kl(e,t)||n.get(e,t,r),has:(e,t)=>!!kl(e,t)||n.has(e,t)}));var ro=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(dm(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function dm(n){let e=n.getComponent();return e?.type==="VERSION"}var io="@firebase/app",Dl="0.11.1";var Qe=new Ce("@firebase/app"),fm="@firebase/app-compat",pm="@firebase/analytics-compat",mm="@firebase/analytics",gm="@firebase/app-check-compat",_m="@firebase/app-check",ym="@firebase/auth",Im="@firebase/auth-compat",vm="@firebase/database",Em="@firebase/data-connect",wm="@firebase/database-compat",Tm="@firebase/functions",Am="@firebase/functions-compat",bm="@firebase/installations",Sm="@firebase/installations-compat",Rm="@firebase/messaging",Pm="@firebase/messaging-compat",Cm="@firebase/performance",km="@firebase/performance-compat",Dm="@firebase/remote-config",Nm="@firebase/remote-config-compat",Om="@firebase/storage",xm="@firebase/storage-compat",Vm="@firebase/firestore",Lm="@firebase/vertexai",Mm="@firebase/firestore-compat",Fm="firebase",Um="11.3.1";var so="[DEFAULT]",Bm={[io]:"fire-core",[fm]:"fire-core-compat",[mm]:"fire-analytics",[pm]:"fire-analytics-compat",[_m]:"fire-app-check",[gm]:"fire-app-check-compat",[ym]:"fire-auth",[Im]:"fire-auth-compat",[vm]:"fire-rtdb",[Em]:"fire-data-connect",[wm]:"fire-rtdb-compat",[Tm]:"fire-fn",[Am]:"fire-fn-compat",[bm]:"fire-iid",[Sm]:"fire-iid-compat",[Rm]:"fire-fcm",[Pm]:"fire-fcm-compat",[Cm]:"fire-perf",[km]:"fire-perf-compat",[Dm]:"fire-rc",[Nm]:"fire-rc-compat",[Om]:"fire-gcs",[xm]:"fire-gcs-compat",[Vm]:"fire-fst",[Mm]:"fire-fst-compat",[Lm]:"fire-vertex","fire-js":"fire-js",[Fm]:"fire-js-all"};var Kn=new Map,qm=new Map,oo=new Map;function Nl(n,e){try{n.container.addComponent(e)}catch(t){Qe.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function de(n){let e=n.name;if(oo.has(e))return Qe.debug(`There were multiple attempts to register component ${e}.`),!1;oo.set(e,n);for(let t of Kn.values())Nl(t,n);for(let t of qm.values())Nl(t,n);return!0}function Be(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ye(n){return n==null?!1:n.settings!==void 0}var $m={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},pt=new Te("app","Firebase",$m);var ao=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new re("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw pt.create("app-deleted",{appName:this._name})}};var Yt=Um;function lo(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:so,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw pt.create("bad-app-name",{appName:String(i)});if(t||(t=Hs()),!t)throw pt.create("no-options");let o=Kn.get(i);if(o){if(ft(t,o.options)&&ft(r,o.config))return o;throw pt.create("duplicate-app",{appName:i})}let a=new ti(i);for(let h of oo.values())a.addComponent(h);let u=new ao(t,r,a);return Kn.set(i,u),u}function Je(n=so){let e=Kn.get(n);if(!e&&n===so&&Hs())return lo();if(!e)throw pt.create("no-app",{appName:n});return e}function ii(){return Array.from(Kn.values())}function Y(n,e,t){var r;let i=(r=Bm[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){let u=[`Unable to register library "${i}" with version "${e}":`];o&&u.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&u.push("and"),a&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Qe.warn(u.join(" "));return}de(new re(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var jm="firebase-heartbeat-database",zm=1,Hn="firebase-heartbeat-store",no=null;function Ll(){return no||(no=ri(jm,zm,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Hn)}catch(t){console.warn(t)}}}}).catch(n=>{throw pt.create("idb-open",{originalErrorMessage:n.message})})),no}function Wm(n){return T(this,null,function*(){try{let t=(yield Ll()).transaction(Hn),r=yield t.objectStore(Hn).get(Ml(n));return yield t.done,r}catch(e){if(e instanceof _e)Qe.warn(e.message);else{let t=pt.create("idb-get",{originalErrorMessage:e?.message});Qe.warn(t.message)}}})}function Ol(n,e){return T(this,null,function*(){try{let r=(yield Ll()).transaction(Hn,"readwrite");yield r.objectStore(Hn).put(e,Ml(n)),yield r.done}catch(t){if(t instanceof _e)Qe.warn(t.message);else{let r=pt.create("idb-set",{originalErrorMessage:t?.message});Qe.warn(r.message)}}})}function Ml(n){return`${n.name}!${n.options.appId}`}var Gm=1024,Km=30,co=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new uo(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return T(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=xl();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:i}),this._heartbeatsCache.heartbeats.length>Km){let a=Qm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Qe.warn(r)}})}getHeartbeatsHeader(){return T(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=xl(),{heartbeatsToSend:r,unsentEntries:i}=Hm(this._heartbeatsCache.heartbeats),o=Gn(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return Qe.warn(t),""}})}};function xl(){return new Date().toISOString().substring(0,10)}function Hm(n,e=Gm){let t=[],r=n.slice();for(let i of n){let o=t.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),Vl(t)>e){o.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Vl(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var uo=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return T(this,null,function*(){return Pt()?Zr().then(()=>!0).catch(()=>!1):!1})}read(){return T(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield Wm(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return T(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Ol(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return T(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Ol(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function Vl(n){return Gn(JSON.stringify({version:2,heartbeats:n})).length}function Qm(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function Ym(n){de(new re("platform-logger",e=>new ro(e),"PRIVATE")),de(new re("heartbeat",e=>new co(e),"PRIVATE")),Y(io,Dl,n),Y(io,Dl,"esm2017"),Y("fire-js","")}Ym("");var Jm="firebase",Xm="11.3.1";Y(Jm,Xm,"app");function ho(n){n===void 0&&(ul(ho),n=He(dt));let e=n.get(Hr);return t=>new St(r=>{let i=e.add(),o=!1;function a(){o||(i(),o=!0)}let u=t.subscribe({next:h=>{r.next(h),a()},complete:()=>{r.complete(),a()},error:h=>{r.error(h),a()}});return u.add(()=>{r.unsubscribe(),a()}),u})}var Xe=new ll("ANGULARFIRE2_VERSION");function Xt(n,e,t){if(e){if(e.length===1)return e[0];let o=e.filter(a=>a.app===t);if(o.length===1)return o[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var mt=(n,e)=>{let t=e?[e]:ii(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(a=>{r.includes(a)||r.push(a)})}),r},Jt=function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n}(Jt||{}),Fl=js()&&typeof Zone<"u"?Jt.WARN:Jt.SILENT;var si=class{zone;delegate;constructor(e,t=ol){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,o=function(a){i?i.runGuarded(()=>{e.apply(this,[a])}):e.apply(this,[a])};return this.delegate.schedule(o,t,r)}},Ze=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=He(Fe);this.outsideAngular=t.runOutsideAngular(()=>new si(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new si(typeof Zone>"u"?void 0:Zone.current,sl))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=al({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Ul=!1;function Zm(n,e){!Ul&&(Fl>Jt.SILENT||js())&&(Ul=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),Fl>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function eg(n){let e=He(Fe,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function kt(n){let e=He(Fe,{optional:!0});return e?e.run(()=>n()):n()}var tg=(n,e,t)=>(...r)=>(e&&setTimeout(e,0),Kr(t,()=>kt(()=>n.apply(void 0,r)))),xe=(n,e,t)=>(t||=e?Jt.WARN:Jt.VERBOSE,function(){let r,i=arguments,o,a,u;try{o=He(Ze),a=He(Hr),u=He(cl)}catch{return Zm(n,t),n.apply(this,i)}for(let f=0;f<arguments.length;f++)typeof i[f]=="function"&&(e&&(r||=kt(()=>a.add())),i[f]=tg(i[f],r,u));let h=eg(()=>n.apply(this,i));return e?h instanceof St?h.pipe(qs(o.outsideAngular),Bs(o.insideAngular),ho(u)):h instanceof Promise?kt(()=>new Promise((f,m)=>{a.run(()=>h).then(I=>Kr(u,()=>kt(()=>f(I))),I=>Kr(u,()=>kt(()=>m(I))))})):typeof h=="function"&&r?function(){return setTimeout(r,0),h.apply(this,arguments)}:kt(()=>h):h instanceof St?h.pipe(qs(o.outsideAngular),Bs(o.insideAngular)):kt(()=>h)});var et=class{constructor(e){return e}},Dt=class{constructor(){return ii()}};function ng(n){return n&&n.length===1?n[0]:new et(Je())}var fo=new Ht("angularfire2._apps"),rg={provide:et,useFactory:ng,deps:[[new Oe,fo]]},ig={provide:Dt,deps:[[new Oe,fo]]};function sg(n){return(e,t)=>{let r=t.get(Wn);Y("angularfire",Xe.full,"core"),Y("angularfire",Xe.full,"app"),Y("angular",hl.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new et(i)}}function kw(n,...e){return Qt([rg,ig,{provide:fo,useFactory:sg(n),multi:!0,deps:[Fe,dt,Ze,...e]}])}var Dw=xe(lo,!0);var $l="@firebase/installations",_o="0.6.12";var jl=1e4,zl=`w:${_o}`,Wl="FIS_v2",og="https://firebaseinstallations.googleapis.com/v1",ag=60*60*1e3,cg="installations",ug="Installations";var lg={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Ot=new Te(cg,ug,lg);function Gl(n){return n instanceof _e&&n.code.includes("request-failed")}function Kl({projectId:n}){return`${og}/projects/${n}/installations`}function Hl(n){return{token:n.token,requestStatus:2,expiresIn:dg(n.expiresIn),creationTime:Date.now()}}function Ql(n,e){return T(this,null,function*(){let r=(yield e.json()).error;return Ot.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})})}function Yl({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function hg(n,{refreshToken:e}){let t=Yl(n);return t.append("Authorization",fg(e)),t}function Jl(n){return T(this,null,function*(){let e=yield n();return e.status>=500&&e.status<600?n():e})}function dg(n){return Number(n.replace("s","000"))}function fg(n){return`${Wl} ${n}`}function pg(r,i){return T(this,arguments,function*({appConfig:n,heartbeatServiceProvider:e},{fid:t}){let o=Kl(n),a=Yl(n),u=e.getImmediate({optional:!0});if(u){let I=yield u.getHeartbeatsHeader();I&&a.append("x-firebase-client",I)}let h={fid:t,authVersion:Wl,appId:n.appId,sdkVersion:zl},f={method:"POST",headers:a,body:JSON.stringify(h)},m=yield Jl(()=>fetch(o,f));if(m.ok){let I=yield m.json();return{fid:I.fid||t,registrationStatus:2,refreshToken:I.refreshToken,authToken:Hl(I.authToken)}}else throw yield Ql("Create Installation",m)})}function Xl(n){return new Promise(e=>{setTimeout(e,n)})}function mg(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}var gg=/^[cdef][\w-]{21}$/,go="";function _g(){try{let n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;let t=yg(n);return gg.test(t)?t:go}catch{return go}}function yg(n){return mg(n).substr(0,22)}function ai(n){return`${n.appName}!${n.appId}`}var Zl=new Map;function eh(n,e){let t=ai(n);th(t,e),Ig(t,e)}function th(n,e){let t=Zl.get(n);if(t)for(let r of t)r(e)}function Ig(n,e){let t=vg();t&&t.postMessage({key:n,fid:e}),Eg()}var Nt=null;function vg(){return!Nt&&"BroadcastChannel"in self&&(Nt=new BroadcastChannel("[Firebase] FID Change"),Nt.onmessage=n=>{th(n.data.key,n.data.fid)}),Nt}function Eg(){Zl.size===0&&Nt&&(Nt.close(),Nt=null)}var wg="firebase-installations-database",Tg=1,xt="firebase-installations-store",po=null;function yo(){return po||(po=ri(wg,Tg,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(xt)}}})),po}function oi(n,e){return T(this,null,function*(){let t=ai(n),i=(yield yo()).transaction(xt,"readwrite"),o=i.objectStore(xt),a=yield o.get(t);return yield o.put(e,t),yield i.done,(!a||a.fid!==e.fid)&&eh(n,e.fid),e})}function nh(n){return T(this,null,function*(){let e=ai(n),r=(yield yo()).transaction(xt,"readwrite");yield r.objectStore(xt).delete(e),yield r.done})}function ci(n,e){return T(this,null,function*(){let t=ai(n),i=(yield yo()).transaction(xt,"readwrite"),o=i.objectStore(xt),a=yield o.get(t),u=e(a);return u===void 0?yield o.delete(t):yield o.put(u,t),yield i.done,u&&(!a||a.fid!==u.fid)&&eh(n,u.fid),u})}function Io(n){return T(this,null,function*(){let e,t=yield ci(n.appConfig,r=>{let i=Ag(r),o=bg(n,i);return e=o.registrationPromise,o.installationEntry});return t.fid===go?{installationEntry:yield e}:{installationEntry:t,registrationPromise:e}})}function Ag(n){let e=n||{fid:_g(),registrationStatus:0};return rh(e)}function bg(n,e){if(e.registrationStatus===0){if(!navigator.onLine){let i=Promise.reject(Ot.create("app-offline"));return{installationEntry:e,registrationPromise:i}}let t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=Sg(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Rg(n)}:{installationEntry:e}}function Sg(n,e){return T(this,null,function*(){try{let t=yield pg(n,e);return oi(n.appConfig,t)}catch(t){throw Gl(t)&&t.customData.serverCode===409?yield nh(n.appConfig):yield oi(n.appConfig,{fid:e.fid,registrationStatus:0}),t}})}function Rg(n){return T(this,null,function*(){let e=yield Bl(n.appConfig);for(;e.registrationStatus===1;)yield Xl(100),e=yield Bl(n.appConfig);if(e.registrationStatus===0){let{installationEntry:t,registrationPromise:r}=yield Io(n);return r||t}return e})}function Bl(n){return ci(n,e=>{if(!e)throw Ot.create("installation-not-found");return rh(e)})}function rh(n){return Pg(n)?{fid:n.fid,registrationStatus:0}:n}function Pg(n){return n.registrationStatus===1&&n.registrationTime+jl<Date.now()}function Cg(r,i){return T(this,arguments,function*({appConfig:n,heartbeatServiceProvider:e},t){let o=kg(n,t),a=hg(n,t),u=e.getImmediate({optional:!0});if(u){let I=yield u.getHeartbeatsHeader();I&&a.append("x-firebase-client",I)}let h={installation:{sdkVersion:zl,appId:n.appId}},f={method:"POST",headers:a,body:JSON.stringify(h)},m=yield Jl(()=>fetch(o,f));if(m.ok){let I=yield m.json();return Hl(I)}else throw yield Ql("Generate Auth Token",m)})}function kg(n,{fid:e}){return`${Kl(n)}/${e}/authTokens:generate`}function vo(n,e=!1){return T(this,null,function*(){let t,r=yield ci(n.appConfig,o=>{if(!ih(o))throw Ot.create("not-registered");let a=o.authToken;if(!e&&Og(a))return o;if(a.requestStatus===1)return t=Dg(n,e),o;{if(!navigator.onLine)throw Ot.create("app-offline");let u=Vg(o);return t=Ng(n,u),u}});return t?yield t:r.authToken})}function Dg(n,e){return T(this,null,function*(){let t=yield ql(n.appConfig);for(;t.authToken.requestStatus===1;)yield Xl(100),t=yield ql(n.appConfig);let r=t.authToken;return r.requestStatus===0?vo(n,e):r})}function ql(n){return ci(n,e=>{if(!ih(e))throw Ot.create("not-registered");let t=e.authToken;return Lg(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function Ng(n,e){return T(this,null,function*(){try{let t=yield Cg(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return yield oi(n.appConfig,r),t}catch(t){if(Gl(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))yield nh(n.appConfig);else{let r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});yield oi(n.appConfig,r)}throw t}})}function ih(n){return n!==void 0&&n.registrationStatus===2}function Og(n){return n.requestStatus===2&&!xg(n)}function xg(n){let e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+ag}function Vg(n){let e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function Lg(n){return n.requestStatus===1&&n.requestTime+jl<Date.now()}function Mg(n){return T(this,null,function*(){let e=n,{installationEntry:t,registrationPromise:r}=yield Io(e);return r?r.catch(console.error):vo(e).catch(console.error),t.fid})}function Fg(n,e=!1){return T(this,null,function*(){let t=n;return yield Ug(t),(yield vo(t,e)).token})}function Ug(n){return T(this,null,function*(){let{registrationPromise:e}=yield Io(n);e&&(yield e)})}function Bg(n){if(!n||!n.options)throw mo("App Configuration");if(!n.name)throw mo("App Name");let e=["projectId","apiKey","appId"];for(let t of e)if(!n.options[t])throw mo(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function mo(n){return Ot.create("missing-app-config-values",{valueName:n})}var sh="installations",qg="installations-internal",$g=n=>{let e=n.getProvider("app").getImmediate(),t=Bg(e),r=Be(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},jg=n=>{let e=n.getProvider("app").getImmediate(),t=Be(e,sh).getImmediate();return{getId:()=>Mg(t),getToken:i=>Fg(t,i)}};function zg(){de(new re(sh,$g,"PUBLIC")),de(new re(qg,jg,"PRIVATE"))}zg();Y($l,_o);Y($l,_o,"esm2017");var ui="analytics",Wg="firebase_id",Gg="origin",Kg=60*1e3,Hg="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Ro="https://www.googletagmanager.com/gtag/js";var Ae=new Ce("@firebase/analytics");var Qg={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Re=new Te("analytics","Analytics",Qg);function Yg(n){if(!n.startsWith(Ro)){let e=Re.create("invalid-gtag-resource",{gtagURL:n});return Ae.warn(e.message),""}return n}function dh(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function Jg(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function Xg(n,e){let t=Jg("firebase-js-sdk-policy",{createScriptURL:Yg}),r=document.createElement("script"),i=`${Ro}?l=${n}&id=${e}`;r.src=t?t?.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function Zg(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}function e_(n,e,t,r,i,o){return T(this,null,function*(){let a=r[i];try{if(a)yield e[a];else{let h=(yield dh(t)).find(f=>f.measurementId===i);h&&(yield e[h.appId])}}catch(u){Ae.error(u)}n("config",i,o)})}function t_(n,e,t,r,i){return T(this,null,function*(){try{let o=[];if(i&&i.send_to){let a=i.send_to;Array.isArray(a)||(a=[a]);let u=yield dh(t);for(let h of a){let f=u.find(I=>I.measurementId===h),m=f&&e[f.appId];if(m)o.push(m);else{o=[];break}}}o.length===0&&(o=Object.values(e)),yield Promise.all(o),n("event",r,i||{})}catch(o){Ae.error(o)}})}function n_(n,e,t,r){function i(o,...a){return T(this,null,function*(){try{if(o==="event"){let[u,h]=a;yield t_(n,e,t,u,h)}else if(o==="config"){let[u,h]=a;yield e_(n,e,t,r,u,h)}else if(o==="consent"){let[u,h]=a;n("consent",u,h)}else if(o==="get"){let[u,h,f]=a;n("get",u,h,f)}else if(o==="set"){let[u]=a;n("set",u)}else n(o,...a)}catch(u){Ae.error(u)}})}return i}function r_(n,e,t,r,i){let o=function(...a){window[r].push(arguments)};return window[i]&&typeof window[i]=="function"&&(o=window[i]),window[i]=n_(o,n,e,t),{gtagCore:o,wrappedGtag:window[i]}}function i_(n){let e=window.document.getElementsByTagName("script");for(let t of Object.values(e))if(t.src&&t.src.includes(Ro)&&t.src.includes(n))return t;return null}var s_=30,o_=1e3,wo=class{constructor(e={},t=o_){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}},fh=new wo;function a_(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}function c_(n){return T(this,null,function*(){var e;let{appId:t,apiKey:r}=n,i={method:"GET",headers:a_(r)},o=Hg.replace("{app-id}",t),a=yield fetch(o,i);if(a.status!==200&&a.status!==304){let u="";try{let h=yield a.json();!((e=h.error)===null||e===void 0)&&e.message&&(u=h.error.message)}catch{}throw Re.create("config-fetch-failed",{httpStatus:a.status,responseMessage:u})}return a.json()})}function u_(r){return T(this,arguments,function*(n,e=fh,t){let{appId:i,apiKey:o,measurementId:a}=n.options;if(!i)throw Re.create("no-app-id");if(!o){if(a)return{measurementId:a,appId:i};throw Re.create("no-api-key")}let u=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},h=new To;return setTimeout(()=>T(this,null,function*(){h.abort()}),t!==void 0?t:Kg),ph({appId:i,apiKey:o,measurementId:a},u,h,e)})}function ph(o,a,u){return T(this,arguments,function*(n,{throttleEndTimeMillis:e,backoffCount:t},r,i=fh){var h;let{appId:f,measurementId:m}=n;try{yield l_(r,e)}catch(I){if(m)return Ae.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${m} provided in the "measurementId" field in the local Firebase config. [${I?.message}]`),{appId:f,measurementId:m};throw I}try{let I=yield c_(n);return i.deleteThrottleMetadata(f),I}catch(I){let S=I;if(!h_(S)){if(i.deleteThrottleMetadata(f),m)return Ae.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${m} provided in the "measurementId" field in the local Firebase config. [${S?.message}]`),{appId:f,measurementId:m};throw I}let R=Number((h=S?.customData)===null||h===void 0?void 0:h.httpStatus)===503?ei(t,i.intervalMillis,s_):ei(t,i.intervalMillis),O={throttleEndTimeMillis:Date.now()+R,backoffCount:t+1};return i.setThrottleMetadata(f,O),Ae.debug(`Calling attemptFetch again in ${R} millis`),ph(n,O,r,i)}})}function l_(n,e){return new Promise((t,r)=>{let i=Math.max(e-Date.now(),0),o=setTimeout(t,i);n.addEventListener(()=>{clearTimeout(o),r(Re.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function h_(n){if(!(n instanceof _e)||!n.customData)return!1;let e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}var To=class{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}};var Ao;function d_(n,e,t,r,i){return T(this,null,function*(){if(i&&i.global){n("event",t,r);return}else{let o=yield e,a=Object.assign(Object.assign({},r),{send_to:o});n("event",t,a)}})}var bo;function f_(n){bo=n}function p_(n){Ao=n}function m_(){return T(this,null,function*(){if(Pt())try{yield Zr()}catch(n){return Ae.warn(Re.create("indexeddb-unavailable",{errorInfo:n?.toString()}).message),!1}else return Ae.warn(Re.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0})}function g_(n,e,t,r,i,o,a){return T(this,null,function*(){var u;let h=u_(n);h.then(R=>{t[R.measurementId]=R.appId,n.options.measurementId&&R.measurementId!==n.options.measurementId&&Ae.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${R.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(R=>Ae.error(R)),e.push(h);let f=m_().then(R=>{if(R)return r.getId()}),[m,I]=yield Promise.all([h,f]);i_(o)||Xg(o,m.measurementId),bo&&(i("consent","default",bo),f_(void 0)),i("js",new Date);let S=(u=a?.config)!==null&&u!==void 0?u:{};return S[Gg]="firebase",S.update=!0,I!=null&&(S[Wg]=I),i("config",m.measurementId,S),Ao&&(i("set",Ao),p_(void 0)),m.measurementId})}var So=class{constructor(e){this.app=e}_delete(){return delete Qn[this.app.options.appId],Promise.resolve()}},Qn={},oh=[],ah={},Eo="dataLayer",__="gtag",ch,mh,uh=!1;function y_(){let n=[];if(Xr()&&n.push("This is a browser extension environment."),Tl()||n.push("Cookies are not available."),n.length>0){let e=n.map((r,i)=>`(${i+1}) ${r}`).join(" "),t=Re.create("invalid-analytics-context",{errorInfo:e});Ae.warn(t.message)}}function I_(n,e,t){y_();let r=n.options.appId;if(!r)throw Re.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Ae.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Re.create("no-api-key");if(Qn[r]!=null)throw Re.create("already-exists",{id:r});if(!uh){Zg(Eo);let{wrappedGtag:o,gtagCore:a}=r_(Qn,oh,ah,Eo,__);mh=o,ch=a,uh=!0}return Qn[r]=g_(n,oh,ah,e,ch,Eo,t),new So(n)}function gh(n=Je()){n=Pe(n);let e=Be(n,ui);return e.isInitialized()?e.getImmediate():_h(n)}function _h(n,e={}){let t=Be(n,ui);if(t.isInitialized()){let i=t.getImmediate();if(ft(e,t.getOptions()))return i;throw Re.create("already-initialized")}return t.initialize({options:e})}function Po(n,e,t,r){n=Pe(n),d_(mh,Qn[n.app.options.appId],e,t,r).catch(i=>Ae.error(i))}var lh="@firebase/analytics",hh="0.10.11";function v_(){de(new re(ui,(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return I_(r,i,t)},"PUBLIC")),de(new re("analytics-internal",n,"PRIVATE")),Y(lh,hh),Y(lh,hh,"esm2017");function n(e){try{let t=e.getProvider(ui).getImmediate();return{logEvent:(r,i,o)=>Po(t,r,i,o)}}catch(t){throw Re.create("interop-component-reg-failed",{reason:t})}}}v_();var E_=new Map,w_={activated:!1,tokenObservers:[]},T_={initialized:!1,enabled:!1};function Ve(n){return E_.get(n)||Object.assign({},w_)}function wh(){return T_}var A_="https://content-firebaseappcheck.googleapis.com/v1";var b_="exchangeDebugToken",yh={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},eT=24*60*60*1e3;var ko=class{constructor(e,t,r,i,o){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=o,this.pending=null,this.nextErrorWaitInterval=i,i>o)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return T(this,null,function*(){this.stop();try{this.pending=new Rt,this.pending.promise.catch(t=>{}),yield S_(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Rt,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function S_(n){return new Promise(e=>{setTimeout(e,n)})}var R_={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},gt=new Te("appCheck","AppCheck",R_);function Th(n){if(!Ve(n).activated)throw gt.create("use-before-activation",{appName:n.name})}function Ah(r,i){return T(this,arguments,function*({url:n,body:e},t){let o={"Content-Type":"application/json"},a=t.getImmediate({optional:!0});if(a){let R=yield a.getHeartbeatsHeader();R&&(o["X-Firebase-Client"]=R)}let u={method:"POST",body:JSON.stringify(e),headers:o},h;try{h=yield fetch(n,u)}catch(R){throw gt.create("fetch-network-error",{originalErrorMessage:R?.message})}if(h.status!==200)throw gt.create("fetch-status-error",{httpStatus:h.status});let f;try{f=yield h.json()}catch(R){throw gt.create("fetch-parse-error",{originalErrorMessage:R?.message})}let m=f.ttl.match(/^([\d.]+)(s)$/);if(!m||!m[2]||isNaN(Number(m[1])))throw gt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${f.ttl}`});let I=Number(m[1])*1e3,S=Date.now();return{token:f.token,expireTimeMillis:S+I,issuedAtTimeMillis:S}})}function bh(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${A_}/projects/${t}/apps/${r}:${b_}?key=${i}`,body:{debug_token:e}}}var P_="firebase-app-check-database",C_=1,Do="firebase-app-check-store";var li=null;function k_(){return li||(li=new Promise((n,e)=>{try{let t=indexedDB.open(P_,C_);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(gt.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Do,{keyPath:"compositeKey"})}}}catch(t){e(gt.create("storage-open",{originalErrorMessage:t?.message}))}}),li)}function D_(n,e){return N_(O_(n),e)}function N_(n,e){return T(this,null,function*(){let r=(yield k_()).transaction(Do,"readwrite"),o=r.objectStore(Do).put({compositeKey:n,value:e});return new Promise((a,u)=>{o.onsuccess=h=>{a()},r.onerror=h=>{var f;u(gt.create("storage-set",{originalErrorMessage:(f=h.target.error)===null||f===void 0?void 0:f.message}))}})})}function O_(n){return`${n.options.appId}-${n.name}`}var No=new Ce("@firebase/app-check");function Co(n,e){return Pt()?D_(n,e).catch(t=>{No.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Sh(){return wh().enabled}function Rh(){return T(this,null,function*(){let n=wh();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var x_={error:"UNKNOWN_ERROR"};function V_(n){return Qr.encodeString(JSON.stringify(n),!1)}function Oo(n,e=!1){return T(this,null,function*(){let t=n.app;Th(t);let r=Ve(t),i=r.token,o;if(i&&!Yn(i)&&(r.token=void 0,i=void 0),!i){let h=yield r.cachedTokenPromise;h&&(Yn(h)?i=h:yield Co(t,void 0))}if(!e&&i&&Yn(i))return{token:i.token};let a=!1;if(Sh()){r.exchangeTokenPromise||(r.exchangeTokenPromise=Ah(bh(t,yield Rh()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),a=!0);let h=yield r.exchangeTokenPromise;return yield Co(t,h),r.token=h,{token:h.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),a=!0),i=yield Ve(t).exchangeTokenPromise}catch(h){h.code==="appCheck/throttled"?No.warn(h.message):No.error(h),o=h}let u;return i?o?Yn(i)?u={token:i.token,internalError:o}:u=vh(o):(u={token:i.token},r.token=i,yield Co(t,i)):u=vh(o),a&&U_(t,u),u})}function L_(n){return T(this,null,function*(){let e=n.app;Th(e);let{provider:t}=Ve(e);if(Sh()){let r=yield Rh(),{token:i}=yield Ah(bh(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function M_(n,e,t,r){let{app:i}=n,o=Ve(i),a={next:t,error:r,type:e};if(o.tokenObservers=[...o.tokenObservers,a],o.token&&Yn(o.token)){let u=o.token;Promise.resolve().then(()=>{t({token:u.token}),Ih(n)}).catch(()=>{})}o.cachedTokenPromise.then(()=>Ih(n))}function Ph(n,e){let t=Ve(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Ih(n){let{app:e}=n,t=Ve(e),r=t.tokenRefresher;r||(r=F_(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function F_(n){let{app:e}=n;return new ko(()=>T(this,null,function*(){let t=Ve(e),r;if(t.token?r=yield Oo(n,!0):r=yield Oo(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Ve(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},yh.RETRIAL_MIN_WAIT,yh.RETRIAL_MAX_WAIT)}function U_(n,e){let t=Ve(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Yn(n){return n.expireTimeMillis-Date.now()>0}function vh(n){return{token:V_(x_),error:n}}var xo=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Ve(this.app);for(let t of e)Ph(this.app,t.next);return Promise.resolve()}};function B_(n,e){return new xo(n,e)}function q_(n){return{getToken:e=>Oo(n,e),getLimitedUseToken:()=>L_(n),addTokenListener:e=>M_(n,"INTERNAL",e),removeTokenListener:e=>Ph(n.app,e)}}var $_="@firebase/app-check",j_="0.8.11";var z_="app-check",Eh="app-check-internal";function W_(){de(new re(z_,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return B_(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Eh).initialize()})),de(new re(Eh,n=>{let e=n.getProvider("app-check").getImmediate();return q_(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Y($_,j_)}W_();var G_="app-check";var hi=class{constructor(){return mt(G_)}};var K_=["localhost","0.0.0.0","127.0.0.1"],fT=typeof window<"u"&&K_.includes(window.location.hostname);function Lh(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Mh=Lh,Fh=new Te("auth","Firebase",Lh());var mi=new Ce("@firebase/auth");function Q_(n,...e){mi.logLevel<=U.WARN&&mi.warn(`Auth (${Yt}): ${n}`,...e)}function fi(n,...e){mi.logLevel<=U.ERROR&&mi.error(`Auth (${Yt}): ${n}`,...e)}function Ch(n,...e){throw Go(n,...e)}function Wo(n,...e){return Go(n,...e)}function Uh(n,e,t){let r=Object.assign(Object.assign({},Mh()),{[e]:t});return new Te("auth","Firebase",r).create(e,{appName:n.name})}function pi(n){return Uh(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Go(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Fh.create(n,...e)}function K(n,e,...t){if(!n)throw Go(e,...t)}function Jn(n){let e="INTERNAL ASSERTION FAILED: "+n;throw fi(e),new Error(e)}function gi(n,e){n||Jn(e)}function Y_(){return kh()==="http:"||kh()==="https:"}function kh(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function J_(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Y_()||Xr()||"connection"in navigator)?navigator.onLine:!0}function X_(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var Lt=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,gi(t>e,"Short delay should be less than long delay!"),this.isMobile=Il()||El()}get(){return J_()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Z_(n,e){gi(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var _i=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Jn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Jn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Jn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var ey={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var ty=new Lt(3e4,6e4);function Bh(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Ei(o,a,u,h){return T(this,arguments,function*(n,e,t,r,i={}){return qh(n,i,()=>T(this,null,function*(){let f={},m={};r&&(e==="GET"?m=r:f={body:JSON.stringify(r)});let I=Qs(Object.assign({key:n.config.apiKey},m)).slice(1),S=yield n._getAdditionalHeaders();S["Content-Type"]="application/json",n.languageCode&&(S["X-Firebase-Locale"]=n.languageCode);let R=Object.assign({method:e,headers:S},f);return vl()||(R.referrerPolicy="no-referrer"),_i.fetch()($h(n,n.config.apiHost,t,I),R)}))})}function qh(n,e,t){return T(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},ey),e);try{let i=new Mo(n),o=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield o.json();if("needConfirmation"in a)throw di(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{let u=o.ok?a.errorMessage:a.error.message,[h,f]=u.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw di(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw di(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw di(n,"user-disabled",a);let m=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw Uh(n,m,f);Ch(n,m)}}catch(i){if(i instanceof _e)throw i;Ch(n,"network-request-failed",{message:String(i)})}})}function $h(n,e,t,r){let i=`${e}${t}?${r}`;return n.config.emulator?Z_(n.config,i):`${n.config.apiScheme}://${i}`}var Mo=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Wo(this.auth,"network-request-failed")),ty.get())})}};function di(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=Wo(n,e,r);return i.customData._tokenResponse=t,i}function ny(n,e){return T(this,null,function*(){return Ei(n,"POST","/v1/accounts:delete",e)})}function jh(n,e){return T(this,null,function*(){return Ei(n,"POST","/v1/accounts:lookup",e)})}function Xn(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Ko(n,e=!1){return T(this,null,function*(){let t=Pe(n),r=yield t.getIdToken(e),i=zh(r);K(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let o=typeof i.firebase=="object"?i.firebase:void 0,a=o?.sign_in_provider;return{claims:i,token:r,authTime:Xn(Vo(i.auth_time)),issuedAtTime:Xn(Vo(i.iat)),expirationTime:Xn(Vo(i.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}})}function Vo(n){return Number(n)*1e3}function zh(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return fi("JWT malformed, contained fewer than 3 sections"),null;try{let i=Yr(t);return i?JSON.parse(i):(fi("Failed to decode base64 JWT payload"),null)}catch(i){return fi("Caught error parsing JWT payload as JSON",i?.toString()),null}}function Dh(n){let e=zh(n);return K(e,"internal-error"),K(typeof e.exp<"u","internal-error"),K(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Fo(n,e,t=!1){return T(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof _e&&ry(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function ry({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Uo=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>T(this,null,function*(){yield this.iteration()}),t)}iteration(){return T(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var er=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Xn(this.lastLoginAt),this.creationTime=Xn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function yi(n){return T(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield Fo(n,jh(t,{idToken:r}));K(i?.users.length,t,"internal-error");let o=i.users[0];n._notifyReloadListener(o);let a=!((e=o.providerUserInfo)===null||e===void 0)&&e.length?Wh(o.providerUserInfo):[],u=iy(n.providerData,a),h=n.isAnonymous,f=!(n.email&&o.passwordHash)&&!u?.length,m=h?f:!1,I={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:u,metadata:new er(o.createdAt,o.lastLoginAt),isAnonymous:m};Object.assign(n,I)})}function Ho(n){return T(this,null,function*(){let e=Pe(n);yield yi(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function iy(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Wh(n){return n.map(e=>{var{providerId:t}=e,r=Us(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function sy(n,e){return T(this,null,function*(){let t=yield qh(n,{},()=>T(this,null,function*(){let r=Qs({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=n.config,a=$h(n,i,"/v1/token",`key=${o}`),u=yield n._getAdditionalHeaders();return u["Content-Type"]="application/x-www-form-urlencoded",_i.fetch()(a,{method:"POST",headers:u,body:r})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function oy(n,e){return T(this,null,function*(){return Ei(n,"POST","/v2/accounts:revokeToken",Bh(n,e))})}var Zn=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){K(e.idToken,"internal-error"),K(typeof e.idToken<"u","internal-error"),K(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Dh(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){K(e.length!==0,"internal-error");let t=Dh(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return T(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(K(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return T(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:o}=yield sy(e,t);this.updateTokensAndExpiration(r,i,Number(o))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:o}=t,a=new n;return r&&(K(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(K(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),o&&(K(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return Jn("not implemented")}};function _t(n,e){K(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var tr=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,o=Us(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Uo(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new er(o.createdAt||void 0,o.lastLoginAt||void 0)}getIdToken(e){return T(this,null,function*(){let t=yield Fo(this,this.stsTokenManager.getToken(this.auth,e));return K(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Ko(this,e)}reload(){return Ho(this)}_assign(e){this!==e&&(K(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){K(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return T(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield yi(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return T(this,null,function*(){if(Ye(this.auth.app))return Promise.reject(pi(this.auth));let e=yield this.getIdToken();return yield Fo(this,ny(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,o,a,u,h,f,m;let I=(r=t.displayName)!==null&&r!==void 0?r:void 0,S=(i=t.email)!==null&&i!==void 0?i:void 0,R=(o=t.phoneNumber)!==null&&o!==void 0?o:void 0,O=(a=t.photoURL)!==null&&a!==void 0?a:void 0,V=(u=t.tenantId)!==null&&u!==void 0?u:void 0,N=(h=t._redirectEventId)!==null&&h!==void 0?h:void 0,G=(f=t.createdAt)!==null&&f!==void 0?f:void 0,H=(m=t.lastLoginAt)!==null&&m!==void 0?m:void 0,{uid:z,emailVerified:X,isAnonymous:ve,providerData:Q,stsTokenManager:v}=t;K(z&&v,e,"internal-error");let p=Zn.fromJSON(this.name,v);K(typeof z=="string",e,"internal-error"),_t(I,e.name),_t(S,e.name),K(typeof X=="boolean",e,"internal-error"),K(typeof ve=="boolean",e,"internal-error"),_t(R,e.name),_t(O,e.name),_t(V,e.name),_t(N,e.name),_t(G,e.name),_t(H,e.name);let _=new n({uid:z,auth:e,email:S,emailVerified:X,displayName:I,isAnonymous:ve,photoURL:O,phoneNumber:R,tenantId:V,stsTokenManager:p,createdAt:G,lastLoginAt:H});return Q&&Array.isArray(Q)&&(_.providerData=Q.map(y=>Object.assign({},y))),N&&(_._redirectEventId=N),_}static _fromIdTokenResponse(e,t,r=!1){return T(this,null,function*(){let i=new Zn;i.updateFromServerResponse(t);let o=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield yi(o),o})}static _fromGetAccountInfoResponse(e,t,r){return T(this,null,function*(){let i=t.users[0];K(i.localId!==void 0,"internal-error");let o=i.providerUserInfo!==void 0?Wh(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!o?.length,u=new Zn;u.updateFromIdToken(r);let h=new n({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:a}),f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new er(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(h,f),h})}};var Nh=new Map;function Vt(n){gi(n instanceof Function,"Expected a class definition");let e=Nh.get(n);return e?(gi(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Nh.set(n,e),e)}var ay=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return T(this,null,function*(){return!0})}_set(t,r){return T(this,null,function*(){this.storage[t]=r})}_get(t){return T(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return T(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),Bo=ay;function Lo(n,e,t){return`firebase:${n}:${e}:${t}`}var Ii=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:o}=this.auth;this.fullUserKey=Lo(this.userKey,i.apiKey,o),this.fullPersistenceKey=Lo("persistence",i.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return T(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);return e?tr._fromJSON(this.auth,e):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return T(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return T(this,null,function*(){if(!t.length)return new n(Vt(Bo),e,r);let i=(yield Promise.all(t.map(f=>T(this,null,function*(){if(yield f._isAvailable())return f})))).filter(f=>f),o=i[0]||Vt(Bo),a=Lo(r,e.config.apiKey,e.name),u=null;for(let f of t)try{let m=yield f._get(a);if(m){let I=tr._fromJSON(e,m);f!==o&&(u=I),o=f;break}}catch{}let h=i.filter(f=>f._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new n(o,e,r):(o=h[0],u&&(yield o._set(a,u.toJSON())),yield Promise.all(t.map(f=>T(this,null,function*(){if(f!==o)try{yield f._remove(a)}catch{}}))),new n(o,e,r))})}};function Oh(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(hy(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(cy(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(fy(e))return"Blackberry";if(py(e))return"Webos";if(uy(e))return"Safari";if((e.includes("chrome/")||ly(e))&&!e.includes("edge/"))return"Chrome";if(dy(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function cy(n=Se()){return/firefox\//i.test(n)}function uy(n=Se()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ly(n=Se()){return/crios\//i.test(n)}function hy(n=Se()){return/iemobile/i.test(n)}function dy(n=Se()){return/android/i.test(n)}function fy(n=Se()){return/blackberry/i.test(n)}function py(n=Se()){return/webos/i.test(n)}function Gh(n,e=[]){let t;switch(n){case"Browser":t=Oh(Se());break;case"Worker":t=`${Oh(Se())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Yt}/${r}`}var qo=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=o=>new Promise((a,u)=>{try{let h=e(o);a(h)}catch(h){u(h)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return T(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function my(t){return T(this,arguments,function*(n,e={}){return Ei(n,"GET","/v2/passwordPolicy",Bh(n,e))})}var gy=6,$o=class{constructor(e){var t,r,i,o;let a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:gy,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(o=e.forceUpgradeOnSignin)!==null&&o!==void 0?o:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,o,a,u;let h={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,h),this.validatePasswordCharacterOptions(e,h),h.isValid&&(h.isValid=(t=h.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),h.isValid&&(h.isValid=(r=h.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),h.isValid&&(h.isValid=(i=h.containsLowercaseLetter)!==null&&i!==void 0?i:!0),h.isValid&&(h.isValid=(o=h.containsUppercaseLetter)!==null&&o!==void 0?o:!0),h.isValid&&(h.isValid=(a=h.containsNumericCharacter)!==null&&a!==void 0?a:!0),h.isValid&&(h.isValid=(u=h.containsNonAlphanumericCharacter)!==null&&u!==void 0?u:!0),h}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}};var jo=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new vi(this),this.idTokenSubscription=new vi(this),this.beforeStateQueue=new qo(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Fh,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Vt(t)),this._initializationPromise=this.queue(()=>T(this,null,function*(){var r,i;if(!this._deleted&&(this.persistenceManager=yield Ii.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return T(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return T(this,null,function*(){try{let t=yield jh(this,{idToken:e}),r=yield tr._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return T(this,null,function*(){var t;if(Ye(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(u,u))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,o=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,u=i?._redirectEventId,h=yield this.tryRedirectSignIn(e);(!a||a===u)&&h?.user&&(i=h.user,o=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(o)try{yield this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return K(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return T(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return T(this,null,function*(){try{yield yi(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=X_()}_delete(){return T(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return T(this,null,function*(){if(Ye(this.app))return Promise.reject(pi(this));let t=e?Pe(e):null;return t&&K(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return T(this,null,function*(){if(!this._deleted)return e&&K(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>T(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return T(this,null,function*(){return Ye(this.app)?Promise.reject(pi(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Ye(this.app)?Promise.reject(pi(this)):this.queue(()=>T(this,null,function*(){yield this.assertedPersistence.setPersistence(Vt(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return T(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return T(this,null,function*(){let e=yield my(this),t=new $o(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Te("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return T(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield oy(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return T(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return T(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&Vt(e)||this._popupRedirectResolver;K(t,this,"argument-error"),this.redirectPersistenceManager=yield Ii.create(this,[Vt(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return T(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>T(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return T(this,null,function*(){if(e===this.currentUser)return this.queue(()=>T(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let o=typeof t=="function"?t:t.next.bind(t),a=!1,u=this._isInitialized?Promise.resolve():this._initializationPromise;if(K(u,this,"internal-error"),u.then(()=>{a||o(this.currentUser)}),typeof t=="function"){let h=e.addObserver(t,r,i);return()=>{a=!0,h()}}else{let h=e.addObserver(t);return()=>{a=!0,h()}}}directlySetCurrentUser(e){return T(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return K(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Gh(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return T(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return T(this,null,function*(){var e;if(Ye(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&Q_(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function _y(n){return Pe(n)}var vi=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Al(t=>this.observer=t)}get next(){return K(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var yy={loadJS(){return T(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Iy(n){yy=n}function vy(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function Ey(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(Vt);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}var bT=vy("rcb"),ST=new Lt(3e4,6e4);var RT=new Lt(2e3,1e4);var PT=10*60*1e3;var CT=new Lt(3e4,6e4);var kT=new Lt(5e3,15e3);var DT=encodeURIComponent("fac");var xh="@firebase/auth",Vh="1.9.0";var zo=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return T(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){K(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function wy(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Ty(n){de(new re("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;K(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Gh(n)},f=new jo(r,i,o,h);return Ey(f,t),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),de(new re("auth-internal",e=>{let t=_y(e.getProvider("auth").getImmediate());return(r=>new zo(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Y(xh,Vh,wy(n)),Y(xh,Vh,"esm2017")}var Ay=5*60,NT=_l("authIdTokenMaxAge")||Ay;function by(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Iy({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let o=Wo("internal-error");o.customData=i,t(o)},r.type="text/javascript",r.charset="UTF-8",by().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Ty("Browser");var TI="auth";var wi=class{constructor(){return mt(TI)}};var nr=class{constructor(e){return e}},Kh="analytics",Qo=class{constructor(){return mt(Kh)}};var BA=xe(gh,!0);var qA=xe(Po,!1,2);var $A=Math.floor(Math.random()*(2**32-1))-2**31;var Yo=new Ht("angularfire2.analytics-instances");function AI(n,e,t){if(!zs(t))return null;let r=Xt(Kh,n,e);return r&&new nr(r)}function bI(n){return(e,t,r)=>{if(!zs(r))return null;let i=e.runOutsideAngular(()=>n(t));return new nr(i)}}var SI={provide:Qo,deps:[[new Oe,Yo]]},RI={provide:nr,useFactory:AI,deps:[[new Oe,Yo],et,Wn]};function jA(n,...e){return Y("angularfire",Xe.full,"analytics"),Qt([RI,SI,{provide:Yo,useFactory:bI(n),multi:!0,deps:[Fe,dt,Wn,Ze,Dt,...e]}])}var Hh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Qh={};var tt,Jo;(function(){var n;function e(v,p){function _(){}_.prototype=p.prototype,v.D=p.prototype,v.prototype=new _,v.prototype.constructor=v,v.C=function(y,E,A){for(var g=Array(arguments.length-2),We=2;We<arguments.length;We++)g[We-2]=arguments[We];return p.prototype[E].apply(y,g)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,p,_){_||(_=0);var y=Array(16);if(typeof p=="string")for(var E=0;16>E;++E)y[E]=p.charCodeAt(_++)|p.charCodeAt(_++)<<8|p.charCodeAt(_++)<<16|p.charCodeAt(_++)<<24;else for(E=0;16>E;++E)y[E]=p[_++]|p[_++]<<8|p[_++]<<16|p[_++]<<24;p=v.g[0],_=v.g[1],E=v.g[2];var A=v.g[3],g=p+(A^_&(E^A))+y[0]+3614090360&4294967295;p=_+(g<<7&4294967295|g>>>25),g=A+(E^p&(_^E))+y[1]+3905402710&4294967295,A=p+(g<<12&4294967295|g>>>20),g=E+(_^A&(p^_))+y[2]+606105819&4294967295,E=A+(g<<17&4294967295|g>>>15),g=_+(p^E&(A^p))+y[3]+3250441966&4294967295,_=E+(g<<22&4294967295|g>>>10),g=p+(A^_&(E^A))+y[4]+4118548399&4294967295,p=_+(g<<7&4294967295|g>>>25),g=A+(E^p&(_^E))+y[5]+1200080426&4294967295,A=p+(g<<12&4294967295|g>>>20),g=E+(_^A&(p^_))+y[6]+2821735955&4294967295,E=A+(g<<17&4294967295|g>>>15),g=_+(p^E&(A^p))+y[7]+4249261313&4294967295,_=E+(g<<22&4294967295|g>>>10),g=p+(A^_&(E^A))+y[8]+1770035416&4294967295,p=_+(g<<7&4294967295|g>>>25),g=A+(E^p&(_^E))+y[9]+2336552879&4294967295,A=p+(g<<12&4294967295|g>>>20),g=E+(_^A&(p^_))+y[10]+4294925233&4294967295,E=A+(g<<17&4294967295|g>>>15),g=_+(p^E&(A^p))+y[11]+2304563134&4294967295,_=E+(g<<22&4294967295|g>>>10),g=p+(A^_&(E^A))+y[12]+1804603682&4294967295,p=_+(g<<7&4294967295|g>>>25),g=A+(E^p&(_^E))+y[13]+4254626195&4294967295,A=p+(g<<12&4294967295|g>>>20),g=E+(_^A&(p^_))+y[14]+2792965006&4294967295,E=A+(g<<17&4294967295|g>>>15),g=_+(p^E&(A^p))+y[15]+1236535329&4294967295,_=E+(g<<22&4294967295|g>>>10),g=p+(E^A&(_^E))+y[1]+4129170786&4294967295,p=_+(g<<5&4294967295|g>>>27),g=A+(_^E&(p^_))+y[6]+3225465664&4294967295,A=p+(g<<9&4294967295|g>>>23),g=E+(p^_&(A^p))+y[11]+643717713&4294967295,E=A+(g<<14&4294967295|g>>>18),g=_+(A^p&(E^A))+y[0]+3921069994&4294967295,_=E+(g<<20&4294967295|g>>>12),g=p+(E^A&(_^E))+y[5]+3593408605&4294967295,p=_+(g<<5&4294967295|g>>>27),g=A+(_^E&(p^_))+y[10]+38016083&4294967295,A=p+(g<<9&4294967295|g>>>23),g=E+(p^_&(A^p))+y[15]+3634488961&4294967295,E=A+(g<<14&4294967295|g>>>18),g=_+(A^p&(E^A))+y[4]+3889429448&4294967295,_=E+(g<<20&4294967295|g>>>12),g=p+(E^A&(_^E))+y[9]+568446438&4294967295,p=_+(g<<5&4294967295|g>>>27),g=A+(_^E&(p^_))+y[14]+3275163606&4294967295,A=p+(g<<9&4294967295|g>>>23),g=E+(p^_&(A^p))+y[3]+4107603335&4294967295,E=A+(g<<14&4294967295|g>>>18),g=_+(A^p&(E^A))+y[8]+1163531501&4294967295,_=E+(g<<20&4294967295|g>>>12),g=p+(E^A&(_^E))+y[13]+2850285829&4294967295,p=_+(g<<5&4294967295|g>>>27),g=A+(_^E&(p^_))+y[2]+4243563512&4294967295,A=p+(g<<9&4294967295|g>>>23),g=E+(p^_&(A^p))+y[7]+1735328473&4294967295,E=A+(g<<14&4294967295|g>>>18),g=_+(A^p&(E^A))+y[12]+2368359562&4294967295,_=E+(g<<20&4294967295|g>>>12),g=p+(_^E^A)+y[5]+4294588738&4294967295,p=_+(g<<4&4294967295|g>>>28),g=A+(p^_^E)+y[8]+2272392833&4294967295,A=p+(g<<11&4294967295|g>>>21),g=E+(A^p^_)+y[11]+1839030562&4294967295,E=A+(g<<16&4294967295|g>>>16),g=_+(E^A^p)+y[14]+4259657740&4294967295,_=E+(g<<23&4294967295|g>>>9),g=p+(_^E^A)+y[1]+2763975236&4294967295,p=_+(g<<4&4294967295|g>>>28),g=A+(p^_^E)+y[4]+1272893353&4294967295,A=p+(g<<11&4294967295|g>>>21),g=E+(A^p^_)+y[7]+4139469664&4294967295,E=A+(g<<16&4294967295|g>>>16),g=_+(E^A^p)+y[10]+3200236656&4294967295,_=E+(g<<23&4294967295|g>>>9),g=p+(_^E^A)+y[13]+681279174&4294967295,p=_+(g<<4&4294967295|g>>>28),g=A+(p^_^E)+y[0]+3936430074&4294967295,A=p+(g<<11&4294967295|g>>>21),g=E+(A^p^_)+y[3]+3572445317&4294967295,E=A+(g<<16&4294967295|g>>>16),g=_+(E^A^p)+y[6]+76029189&4294967295,_=E+(g<<23&4294967295|g>>>9),g=p+(_^E^A)+y[9]+3654602809&4294967295,p=_+(g<<4&4294967295|g>>>28),g=A+(p^_^E)+y[12]+3873151461&4294967295,A=p+(g<<11&4294967295|g>>>21),g=E+(A^p^_)+y[15]+530742520&4294967295,E=A+(g<<16&4294967295|g>>>16),g=_+(E^A^p)+y[2]+3299628645&4294967295,_=E+(g<<23&4294967295|g>>>9),g=p+(E^(_|~A))+y[0]+4096336452&4294967295,p=_+(g<<6&4294967295|g>>>26),g=A+(_^(p|~E))+y[7]+1126891415&4294967295,A=p+(g<<10&4294967295|g>>>22),g=E+(p^(A|~_))+y[14]+2878612391&4294967295,E=A+(g<<15&4294967295|g>>>17),g=_+(A^(E|~p))+y[5]+4237533241&4294967295,_=E+(g<<21&4294967295|g>>>11),g=p+(E^(_|~A))+y[12]+1700485571&4294967295,p=_+(g<<6&4294967295|g>>>26),g=A+(_^(p|~E))+y[3]+2399980690&4294967295,A=p+(g<<10&4294967295|g>>>22),g=E+(p^(A|~_))+y[10]+4293915773&4294967295,E=A+(g<<15&4294967295|g>>>17),g=_+(A^(E|~p))+y[1]+2240044497&4294967295,_=E+(g<<21&4294967295|g>>>11),g=p+(E^(_|~A))+y[8]+1873313359&4294967295,p=_+(g<<6&4294967295|g>>>26),g=A+(_^(p|~E))+y[15]+4264355552&4294967295,A=p+(g<<10&4294967295|g>>>22),g=E+(p^(A|~_))+y[6]+2734768916&4294967295,E=A+(g<<15&4294967295|g>>>17),g=_+(A^(E|~p))+y[13]+1309151649&4294967295,_=E+(g<<21&4294967295|g>>>11),g=p+(E^(_|~A))+y[4]+4149444226&4294967295,p=_+(g<<6&4294967295|g>>>26),g=A+(_^(p|~E))+y[11]+3174756917&4294967295,A=p+(g<<10&4294967295|g>>>22),g=E+(p^(A|~_))+y[2]+718787259&4294967295,E=A+(g<<15&4294967295|g>>>17),g=_+(A^(E|~p))+y[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(E+(g<<21&4294967295|g>>>11))&4294967295,v.g[2]=v.g[2]+E&4294967295,v.g[3]=v.g[3]+A&4294967295}r.prototype.u=function(v,p){p===void 0&&(p=v.length);for(var _=p-this.blockSize,y=this.B,E=this.h,A=0;A<p;){if(E==0)for(;A<=_;)i(this,v,A),A+=this.blockSize;if(typeof v=="string"){for(;A<p;)if(y[E++]=v.charCodeAt(A++),E==this.blockSize){i(this,y),E=0;break}}else for(;A<p;)if(y[E++]=v[A++],E==this.blockSize){i(this,y),E=0;break}}this.h=E,this.o+=p},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;var _=8*this.o;for(p=v.length-8;p<v.length;++p)v[p]=_&255,_/=256;for(this.u(v),v=Array(16),p=_=0;4>p;++p)for(var y=0;32>y;y+=8)v[_++]=this.g[p]>>>y&255;return v};function o(v,p){var _=u;return Object.prototype.hasOwnProperty.call(_,v)?_[v]:_[v]=p(v)}function a(v,p){this.h=p;for(var _=[],y=!0,E=v.length-1;0<=E;E--){var A=v[E]|0;y&&A==p||(_[E]=A,y=!1)}this.g=_}var u={};function h(v){return-128<=v&&128>v?o(v,function(p){return new a([p|0],0>p?-1:0)}):new a([v|0],0>v?-1:0)}function f(v){if(isNaN(v)||!isFinite(v))return I;if(0>v)return N(f(-v));for(var p=[],_=1,y=0;v>=_;y++)p[y]=v/_|0,_*=4294967296;return new a(p,0)}function m(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return N(m(v.substring(1),p));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=f(Math.pow(p,8)),y=I,E=0;E<v.length;E+=8){var A=Math.min(8,v.length-E),g=parseInt(v.substring(E,E+A),p);8>A?(A=f(Math.pow(p,A)),y=y.j(A).add(f(g))):(y=y.j(_),y=y.add(f(g)))}return y}var I=h(0),S=h(1),R=h(16777216);n=a.prototype,n.m=function(){if(V(this))return-N(this).m();for(var v=0,p=1,_=0;_<this.g.length;_++){var y=this.i(_);v+=(0<=y?y:4294967296+y)*p,p*=4294967296}return v},n.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(O(this))return"0";if(V(this))return"-"+N(this).toString(v);for(var p=f(Math.pow(v,6)),_=this,y="";;){var E=X(_,p).g;_=G(_,E.j(p));var A=((0<_.g.length?_.g[0]:_.h)>>>0).toString(v);if(_=E,O(_))return A+y;for(;6>A.length;)A="0"+A;y=A+y}},n.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function O(v){if(v.h!=0)return!1;for(var p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function V(v){return v.h==-1}n.l=function(v){return v=G(this,v),V(v)?-1:O(v)?0:1};function N(v){for(var p=v.g.length,_=[],y=0;y<p;y++)_[y]=~v.g[y];return new a(_,~v.h).add(S)}n.abs=function(){return V(this)?N(this):this},n.add=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],y=0,E=0;E<=p;E++){var A=y+(this.i(E)&65535)+(v.i(E)&65535),g=(A>>>16)+(this.i(E)>>>16)+(v.i(E)>>>16);y=g>>>16,A&=65535,g&=65535,_[E]=g<<16|A}return new a(_,_[_.length-1]&-2147483648?-1:0)};function G(v,p){return v.add(N(p))}n.j=function(v){if(O(this)||O(v))return I;if(V(this))return V(v)?N(this).j(N(v)):N(N(this).j(v));if(V(v))return N(this.j(N(v)));if(0>this.l(R)&&0>v.l(R))return f(this.m()*v.m());for(var p=this.g.length+v.g.length,_=[],y=0;y<2*p;y++)_[y]=0;for(y=0;y<this.g.length;y++)for(var E=0;E<v.g.length;E++){var A=this.i(y)>>>16,g=this.i(y)&65535,We=v.i(E)>>>16,Sn=v.i(E)&65535;_[2*y+2*E]+=g*Sn,H(_,2*y+2*E),_[2*y+2*E+1]+=A*Sn,H(_,2*y+2*E+1),_[2*y+2*E+1]+=g*We,H(_,2*y+2*E+1),_[2*y+2*E+2]+=A*We,H(_,2*y+2*E+2)}for(y=0;y<p;y++)_[y]=_[2*y+1]<<16|_[2*y];for(y=p;y<2*p;y++)_[y]=0;return new a(_,0)};function H(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function z(v,p){this.g=v,this.h=p}function X(v,p){if(O(p))throw Error("division by zero");if(O(v))return new z(I,I);if(V(v))return p=X(N(v),p),new z(N(p.g),N(p.h));if(V(p))return p=X(v,N(p)),new z(N(p.g),p.h);if(30<v.g.length){if(V(v)||V(p))throw Error("slowDivide_ only works with positive integers.");for(var _=S,y=p;0>=y.l(v);)_=ve(_),y=ve(y);var E=Q(_,1),A=Q(y,1);for(y=Q(y,2),_=Q(_,2);!O(y);){var g=A.add(y);0>=g.l(v)&&(E=E.add(_),A=g),y=Q(y,1),_=Q(_,1)}return p=G(v,E.j(p)),new z(E,p)}for(E=I;0<=v.l(p);){for(_=Math.max(1,Math.floor(v.m()/p.m())),y=Math.ceil(Math.log(_)/Math.LN2),y=48>=y?1:Math.pow(2,y-48),A=f(_),g=A.j(p);V(g)||0<g.l(v);)_-=y,A=f(_),g=A.j(p);O(A)&&(A=S),E=E.add(A),v=G(v,g)}return new z(E,v)}n.A=function(v){return X(this,v).h},n.and=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],y=0;y<p;y++)_[y]=this.i(y)&v.i(y);return new a(_,this.h&v.h)},n.or=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],y=0;y<p;y++)_[y]=this.i(y)|v.i(y);return new a(_,this.h|v.h)},n.xor=function(v){for(var p=Math.max(this.g.length,v.g.length),_=[],y=0;y<p;y++)_[y]=this.i(y)^v.i(y);return new a(_,this.h^v.h)};function ve(v){for(var p=v.g.length+1,_=[],y=0;y<p;y++)_[y]=v.i(y)<<1|v.i(y-1)>>>31;return new a(_,v.h)}function Q(v,p){var _=p>>5;p%=32;for(var y=v.g.length-_,E=[],A=0;A<y;A++)E[A]=0<p?v.i(A+_)>>>p|v.i(A+_+1)<<32-p:v.i(A+_);return new a(E,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Jo=Qh.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=f,a.fromString=m,tt=Qh.Integer=a}).apply(typeof Hh<"u"?Hh:typeof self<"u"?self:typeof window<"u"?window:{});var Ti=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},nt={};var Xo,PI,Zt,Zo,rr,Ai,ea,ta,na;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(s,c,l){return s==Array.prototype||s==Object.prototype||(s[c]=l.value),s};function t(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ti=="object"&&Ti];for(var c=0;c<s.length;++c){var l=s[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=t(this);function i(s,c){if(c)e:{var l=r;s=s.split(".");for(var d=0;d<s.length-1;d++){var w=s[d];if(!(w in l))break e;l=l[w]}s=s[s.length-1],d=l[s],c=c(d),c!=d&&c!=null&&e(l,s,{configurable:!0,writable:!0,value:c})}}function o(s,c){s instanceof String&&(s+="");var l=0,d=!1,w={next:function(){if(!d&&l<s.length){var b=l++;return{value:c(b,s[b]),done:!1}}return d=!0,{done:!0,value:void 0}}};return w[Symbol.iterator]=function(){return w},w}i("Array.prototype.values",function(s){return s||function(){return o(this,function(c,l){return l})}});var a=a||{},u=this||self;function h(s){var c=typeof s;return c=c!="object"?c:s?Array.isArray(s)?"array":c:"null",c=="array"||c=="object"&&typeof s.length=="number"}function f(s){var c=typeof s;return c=="object"&&s!=null||c=="function"}function m(s,c,l){return s.call.apply(s.bind,arguments)}function I(s,c,l){if(!s)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var w=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(w,d),s.apply(c,w)}}return function(){return s.apply(c,arguments)}}function S(s,c,l){return S=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:I,S.apply(null,arguments)}function R(s,c){var l=Array.prototype.slice.call(arguments,1);return function(){var d=l.slice();return d.push.apply(d,arguments),s.apply(this,d)}}function O(s,c){function l(){}l.prototype=c.prototype,s.aa=c.prototype,s.prototype=new l,s.prototype.constructor=s,s.Qb=function(d,w,b){for(var C=Array(arguments.length-2),J=2;J<arguments.length;J++)C[J-2]=arguments[J];return c.prototype[w].apply(d,C)}}function V(s){let c=s.length;if(0<c){let l=Array(c);for(let d=0;d<c;d++)l[d]=s[d];return l}return[]}function N(s,c){for(let l=1;l<arguments.length;l++){let d=arguments[l];if(h(d)){let w=s.length||0,b=d.length||0;s.length=w+b;for(let C=0;C<b;C++)s[w+C]=d[C]}else s.push(d)}}class G{constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function H(s){return/^[\s\xa0]*$/.test(s)}function z(){var s=u.navigator;return s&&(s=s.userAgent)?s:""}function X(s){return X[" "](s),s}X[" "]=function(){};var ve=z().indexOf("Gecko")!=-1&&!(z().toLowerCase().indexOf("webkit")!=-1&&z().indexOf("Edge")==-1)&&!(z().indexOf("Trident")!=-1||z().indexOf("MSIE")!=-1)&&z().indexOf("Edge")==-1;function Q(s,c,l){for(let d in s)c.call(l,s[d],d,s)}function v(s,c){for(let l in s)c.call(void 0,s[l],l,s)}function p(s){let c={};for(let l in s)c[l]=s[l];return c}let _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function y(s,c){let l,d;for(let w=1;w<arguments.length;w++){d=arguments[w];for(l in d)s[l]=d[l];for(let b=0;b<_.length;b++)l=_[b],Object.prototype.hasOwnProperty.call(d,l)&&(s[l]=d[l])}}function E(s){var c=1;s=s.split(":");let l=[];for(;0<c&&s.length;)l.push(s.shift()),c--;return s.length&&l.push(s.join(":")),l}function A(s){u.setTimeout(()=>{throw s},0)}function g(){var s=ps;let c=null;return s.g&&(c=s.g,s.g=s.g.next,s.g||(s.h=null),c.next=null),c}class We{constructor(){this.h=this.g=null}add(c,l){let d=Sn.get();d.set(c,l),this.h?this.h.next=d:this.g=d,this.h=d}}var Sn=new G(()=>new np,s=>s.reset());class np{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let Rn,Pn=!1,ps=new We,iu=()=>{let s=u.Promise.resolve(void 0);Rn=()=>{s.then(rp)}};var rp=()=>{for(var s;s=g();){try{s.h.call(s.g)}catch(l){A(l)}var c=Sn;c.j(s),100>c.h&&(c.h++,s.next=c.g,c.g=s)}Pn=!1};function ct(){this.s=this.s,this.C=this.C}ct.prototype.s=!1,ct.prototype.ma=function(){this.s||(this.s=!0,this.N())},ct.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function fe(s,c){this.type=s,this.g=this.target=c,this.defaultPrevented=!1}fe.prototype.h=function(){this.defaultPrevented=!0};var ip=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var s=!1,c=Object.defineProperty({},"passive",{get:function(){s=!0}});try{let l=()=>{};u.addEventListener("test",l,c),u.removeEventListener("test",l,c)}catch{}return s}();function Cn(s,c){if(fe.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s){var l=this.type=s.type,d=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;if(this.target=s.target||s.srcElement,this.g=c,c=s.relatedTarget){if(ve){e:{try{X(c.nodeName);var w=!0;break e}catch{}w=!1}w||(c=null)}}else l=="mouseover"?c=s.fromElement:l=="mouseout"&&(c=s.toElement);this.relatedTarget=c,d?(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=typeof s.pointerType=="string"?s.pointerType:sp[s.pointerType]||"",this.state=s.state,this.i=s,s.defaultPrevented&&Cn.aa.h.call(this)}}O(Cn,fe);var sp={2:"touch",3:"pen",4:"mouse"};Cn.prototype.h=function(){Cn.aa.h.call(this);var s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var kn="closure_listenable_"+(1e6*Math.random()|0),op=0;function ap(s,c,l,d,w){this.listener=s,this.proxy=null,this.src=c,this.type=l,this.capture=!!d,this.ha=w,this.key=++op,this.da=this.fa=!1}function Pr(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function Cr(s){this.src=s,this.g={},this.h=0}Cr.prototype.add=function(s,c,l,d,w){var b=s.toString();s=this.g[b],s||(s=this.g[b]=[],this.h++);var C=gs(s,c,d,w);return-1<C?(c=s[C],l||(c.fa=!1)):(c=new ap(c,this.src,b,!!d,w),c.fa=l,s.push(c)),c};function ms(s,c){var l=c.type;if(l in s.g){var d=s.g[l],w=Array.prototype.indexOf.call(d,c,void 0),b;(b=0<=w)&&Array.prototype.splice.call(d,w,1),b&&(Pr(c),s.g[l].length==0&&(delete s.g[l],s.h--))}}function gs(s,c,l,d){for(var w=0;w<s.length;++w){var b=s[w];if(!b.da&&b.listener==c&&b.capture==!!l&&b.ha==d)return w}return-1}var _s="closure_lm_"+(1e6*Math.random()|0),ys={};function su(s,c,l,d,w){if(d&&d.once)return au(s,c,l,d,w);if(Array.isArray(c)){for(var b=0;b<c.length;b++)su(s,c[b],l,d,w);return null}return l=ws(l),s&&s[kn]?s.K(c,l,f(d)?!!d.capture:!!d,w):ou(s,c,l,!1,d,w)}function ou(s,c,l,d,w,b){if(!c)throw Error("Invalid event type");var C=f(w)?!!w.capture:!!w,J=vs(s);if(J||(s[_s]=J=new Cr(s)),l=J.add(c,l,d,C,b),l.proxy)return l;if(d=cp(),l.proxy=d,d.src=s,d.listener=l,s.addEventListener)ip||(w=C),w===void 0&&(w=!1),s.addEventListener(c.toString(),d,w);else if(s.attachEvent)s.attachEvent(uu(c.toString()),d);else if(s.addListener&&s.removeListener)s.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");return l}function cp(){function s(l){return c.call(s.src,s.listener,l)}let c=up;return s}function au(s,c,l,d,w){if(Array.isArray(c)){for(var b=0;b<c.length;b++)au(s,c[b],l,d,w);return null}return l=ws(l),s&&s[kn]?s.L(c,l,f(d)?!!d.capture:!!d,w):ou(s,c,l,!0,d,w)}function cu(s,c,l,d,w){if(Array.isArray(c))for(var b=0;b<c.length;b++)cu(s,c[b],l,d,w);else d=f(d)?!!d.capture:!!d,l=ws(l),s&&s[kn]?(s=s.i,c=String(c).toString(),c in s.g&&(b=s.g[c],l=gs(b,l,d,w),-1<l&&(Pr(b[l]),Array.prototype.splice.call(b,l,1),b.length==0&&(delete s.g[c],s.h--)))):s&&(s=vs(s))&&(c=s.g[c.toString()],s=-1,c&&(s=gs(c,l,d,w)),(l=-1<s?c[s]:null)&&Is(l))}function Is(s){if(typeof s!="number"&&s&&!s.da){var c=s.src;if(c&&c[kn])ms(c.i,s);else{var l=s.type,d=s.proxy;c.removeEventListener?c.removeEventListener(l,d,s.capture):c.detachEvent?c.detachEvent(uu(l),d):c.addListener&&c.removeListener&&c.removeListener(d),(l=vs(c))?(ms(l,s),l.h==0&&(l.src=null,c[_s]=null)):Pr(s)}}}function uu(s){return s in ys?ys[s]:ys[s]="on"+s}function up(s,c){if(s.da)s=!0;else{c=new Cn(c,this);var l=s.listener,d=s.ha||s.src;s.fa&&Is(s),s=l.call(d,c)}return s}function vs(s){return s=s[_s],s instanceof Cr?s:null}var Es="__closure_events_fn_"+(1e9*Math.random()>>>0);function ws(s){return typeof s=="function"?s:(s[Es]||(s[Es]=function(c){return s.handleEvent(c)}),s[Es])}function pe(){ct.call(this),this.i=new Cr(this),this.M=this,this.F=null}O(pe,ct),pe.prototype[kn]=!0,pe.prototype.removeEventListener=function(s,c,l,d){cu(this,s,c,l,d)};function Ee(s,c){var l,d=s.F;if(d)for(l=[];d;d=d.F)l.push(d);if(s=s.M,d=c.type||c,typeof c=="string")c=new fe(c,s);else if(c instanceof fe)c.target=c.target||s;else{var w=c;c=new fe(d,s),y(c,w)}if(w=!0,l)for(var b=l.length-1;0<=b;b--){var C=c.g=l[b];w=kr(C,d,!0,c)&&w}if(C=c.g=s,w=kr(C,d,!0,c)&&w,w=kr(C,d,!1,c)&&w,l)for(b=0;b<l.length;b++)C=c.g=l[b],w=kr(C,d,!1,c)&&w}pe.prototype.N=function(){if(pe.aa.N.call(this),this.i){var s=this.i,c;for(c in s.g){for(var l=s.g[c],d=0;d<l.length;d++)Pr(l[d]);delete s.g[c],s.h--}}this.F=null},pe.prototype.K=function(s,c,l,d){return this.i.add(String(s),c,!1,l,d)},pe.prototype.L=function(s,c,l,d){return this.i.add(String(s),c,!0,l,d)};function kr(s,c,l,d){if(c=s.i.g[String(c)],!c)return!0;c=c.concat();for(var w=!0,b=0;b<c.length;++b){var C=c[b];if(C&&!C.da&&C.capture==l){var J=C.listener,he=C.ha||C.src;C.fa&&ms(s.i,C),w=J.call(he,d)!==!1&&w}}return w&&!d.defaultPrevented}function lu(s,c,l){if(typeof s=="function")l&&(s=S(s,l));else if(s&&typeof s.handleEvent=="function")s=S(s.handleEvent,s);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:u.setTimeout(s,c||0)}function hu(s){s.g=lu(()=>{s.g=null,s.i&&(s.i=!1,hu(s))},s.l);let c=s.h;s.h=null,s.m.apply(null,c)}class lp extends ct{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:hu(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Dn(s){ct.call(this),this.h=s,this.g={}}O(Dn,ct);var du=[];function fu(s){Q(s.g,function(c,l){this.g.hasOwnProperty(l)&&Is(c)},s),s.g={}}Dn.prototype.N=function(){Dn.aa.N.call(this),fu(this)},Dn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ts=u.JSON.stringify,hp=u.JSON.parse,dp=class{stringify(s){return u.JSON.stringify(s,void 0)}parse(s){return u.JSON.parse(s,void 0)}};function As(){}As.prototype.h=null;function pu(s){return s.h||(s.h=s.i())}function mu(){}var Nn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function bs(){fe.call(this,"d")}O(bs,fe);function Ss(){fe.call(this,"c")}O(Ss,fe);var wt={},gu=null;function Dr(){return gu=gu||new pe}wt.La="serverreachability";function _u(s){fe.call(this,wt.La,s)}O(_u,fe);function On(s){let c=Dr();Ee(c,new _u(c))}wt.STAT_EVENT="statevent";function yu(s,c){fe.call(this,wt.STAT_EVENT,s),this.stat=c}O(yu,fe);function we(s){let c=Dr();Ee(c,new yu(c,s))}wt.Ma="timingevent";function Iu(s,c){fe.call(this,wt.Ma,s),this.size=c}O(Iu,fe);function xn(s,c){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){s()},c)}function Vn(){this.g=!0}Vn.prototype.xa=function(){this.g=!1};function fp(s,c,l,d,w,b){s.info(function(){if(s.g)if(b)for(var C="",J=b.split("&"),he=0;he<J.length;he++){var W=J[he].split("=");if(1<W.length){var me=W[0];W=W[1];var ge=me.split("_");C=2<=ge.length&&ge[1]=="type"?C+(me+"="+W+"&"):C+(me+"=redacted&")}}else C=null;else C=b;return"XMLHTTP REQ ("+d+") [attempt "+w+"]: "+c+`
`+l+`
`+C})}function pp(s,c,l,d,w,b,C){s.info(function(){return"XMLHTTP RESP ("+d+") [ attempt "+w+"]: "+c+`
`+l+`
`+b+" "+C})}function zt(s,c,l,d){s.info(function(){return"XMLHTTP TEXT ("+c+"): "+gp(s,l)+(d?" "+d:"")})}function mp(s,c){s.info(function(){return"TIMEOUT: "+c})}Vn.prototype.info=function(){};function gp(s,c){if(!s.g)return c;if(!c)return null;try{var l=JSON.parse(c);if(l){for(s=0;s<l.length;s++)if(Array.isArray(l[s])){var d=l[s];if(!(2>d.length)){var w=d[1];if(Array.isArray(w)&&!(1>w.length)){var b=w[0];if(b!="noop"&&b!="stop"&&b!="close")for(var C=1;C<w.length;C++)w[C]=""}}}}return Ts(l)}catch{return c}}var Nr={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},vu={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Rs;function Or(){}O(Or,As),Or.prototype.g=function(){return new XMLHttpRequest},Or.prototype.i=function(){return{}},Rs=new Or;function ut(s,c,l,d){this.j=s,this.i=c,this.l=l,this.R=d||1,this.U=new Dn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Eu}function Eu(){this.i=null,this.g="",this.h=!1}var wu={},Ps={};function Cs(s,c,l){s.L=1,s.v=Mr(Ge(c)),s.m=l,s.P=!0,Tu(s,null)}function Tu(s,c){s.F=Date.now(),xr(s),s.A=Ge(s.v);var l=s.A,d=s.R;Array.isArray(d)||(d=[String(d)]),Mu(l.i,"t",d),s.C=0,l=s.j.J,s.h=new Eu,s.g=tl(s.j,l?c:null,!s.m),0<s.O&&(s.M=new lp(S(s.Y,s,s.g),s.O)),c=s.U,l=s.g,d=s.ca;var w="readystatechange";Array.isArray(w)||(w&&(du[0]=w.toString()),w=du);for(var b=0;b<w.length;b++){var C=su(l,w[b],d||c.handleEvent,!1,c.h||c);if(!C)break;c.g[C.key]=C}c=s.H?p(s.H):{},s.m?(s.u||(s.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.A,s.u,s.m,c)):(s.u="GET",s.g.ea(s.A,s.u,null,c)),On(),fp(s.i,s.u,s.A,s.l,s.R,s.m)}ut.prototype.ca=function(s){s=s.target;let c=this.M;c&&Ke(s)==3?c.j():this.Y(s)},ut.prototype.Y=function(s){try{if(s==this.g)e:{let ge=Ke(this.g);var c=this.g.Ba();let Kt=this.g.Z();if(!(3>ge)&&(ge!=3||this.g&&(this.h.h||this.g.oa()||zu(this.g)))){this.J||ge!=4||c==7||(c==8||0>=Kt?On(3):On(2)),ks(this);var l=this.g.Z();this.X=l;t:if(Au(this)){var d=zu(this.g);s="";var w=d.length,b=Ke(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Tt(this),Ln(this);var C="";break t}this.h.i=new u.TextDecoder}for(c=0;c<w;c++)this.h.h=!0,s+=this.h.i.decode(d[c],{stream:!(b&&c==w-1)});d.length=0,this.h.g+=s,this.C=0,C=this.h.g}else C=this.g.oa();if(this.o=l==200,pp(this.i,this.u,this.A,this.l,this.R,ge,l),this.o){if(this.T&&!this.K){t:{if(this.g){var J,he=this.g;if((J=he.g?he.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!H(J)){var W=J;break t}}W=null}if(l=W)zt(this.i,this.l,l,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ds(this,l);else{this.o=!1,this.s=3,we(12),Tt(this),Ln(this);break e}}if(this.P){l=!0;let Ne;for(;!this.J&&this.C<C.length;)if(Ne=_p(this,C),Ne==Ps){ge==4&&(this.s=4,we(14),l=!1),zt(this.i,this.l,null,"[Incomplete Response]");break}else if(Ne==wu){this.s=4,we(15),zt(this.i,this.l,C,"[Invalid Chunk]"),l=!1;break}else zt(this.i,this.l,Ne,null),Ds(this,Ne);if(Au(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ge!=4||C.length!=0||this.h.h||(this.s=1,we(16),l=!1),this.o=this.o&&l,!l)zt(this.i,this.l,C,"[Invalid Chunked Response]"),Tt(this),Ln(this);else if(0<C.length&&!this.W){this.W=!0;var me=this.j;me.g==this&&me.ba&&!me.M&&(me.j.info("Great, no buffering proxy detected. Bytes received: "+C.length),Ms(me),me.M=!0,we(11))}}else zt(this.i,this.l,C,null),Ds(this,C);ge==4&&Tt(this),this.o&&!this.J&&(ge==4?Ju(this.j,this):(this.o=!1,xr(this)))}else xp(this.g),l==400&&0<C.indexOf("Unknown SID")?(this.s=3,we(12)):(this.s=0,we(13)),Tt(this),Ln(this)}}}catch{}finally{}};function Au(s){return s.g?s.u=="GET"&&s.L!=2&&s.j.Ca:!1}function _p(s,c){var l=s.C,d=c.indexOf(`
`,l);return d==-1?Ps:(l=Number(c.substring(l,d)),isNaN(l)?wu:(d+=1,d+l>c.length?Ps:(c=c.slice(d,d+l),s.C=d+l,c)))}ut.prototype.cancel=function(){this.J=!0,Tt(this)};function xr(s){s.S=Date.now()+s.I,bu(s,s.I)}function bu(s,c){if(s.B!=null)throw Error("WatchDog timer not null");s.B=xn(S(s.ba,s),c)}function ks(s){s.B&&(u.clearTimeout(s.B),s.B=null)}ut.prototype.ba=function(){this.B=null;let s=Date.now();0<=s-this.S?(mp(this.i,this.A),this.L!=2&&(On(),we(17)),Tt(this),this.s=2,Ln(this)):bu(this,this.S-s)};function Ln(s){s.j.G==0||s.J||Ju(s.j,s)}function Tt(s){ks(s);var c=s.M;c&&typeof c.ma=="function"&&c.ma(),s.M=null,fu(s.U),s.g&&(c=s.g,s.g=null,c.abort(),c.ma())}function Ds(s,c){try{var l=s.j;if(l.G!=0&&(l.g==s||Ns(l.h,s))){if(!s.K&&Ns(l.h,s)&&l.G==3){try{var d=l.Da.g.parse(c)}catch{d=null}if(Array.isArray(d)&&d.length==3){var w=d;if(w[0]==0){e:if(!l.u){if(l.g)if(l.g.F+3e3<s.F)$r(l),Br(l);else break e;Ls(l),we(18)}}else l.za=w[1],0<l.za-l.T&&37500>w[2]&&l.F&&l.v==0&&!l.C&&(l.C=xn(S(l.Za,l),6e3));if(1>=Pu(l.h)&&l.ca){try{l.ca()}catch{}l.ca=void 0}}else bt(l,11)}else if((s.K||l.g==s)&&$r(l),!H(c))for(w=l.Da.g.parse(c),c=0;c<w.length;c++){let W=w[c];if(l.T=W[0],W=W[1],l.G==2)if(W[0]=="c"){l.K=W[1],l.ia=W[2];let me=W[3];me!=null&&(l.la=me,l.j.info("VER="+l.la));let ge=W[4];ge!=null&&(l.Aa=ge,l.j.info("SVER="+l.Aa));let Kt=W[5];Kt!=null&&typeof Kt=="number"&&0<Kt&&(d=1.5*Kt,l.L=d,l.j.info("backChannelRequestTimeoutMs_="+d)),d=l;let Ne=s.g;if(Ne){let zr=Ne.g?Ne.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(zr){var b=d.h;b.g||zr.indexOf("spdy")==-1&&zr.indexOf("quic")==-1&&zr.indexOf("h2")==-1||(b.j=b.l,b.g=new Set,b.h&&(Os(b,b.h),b.h=null))}if(d.D){let Fs=Ne.g?Ne.g.getResponseHeader("X-HTTP-Session-Id"):null;Fs&&(d.ya=Fs,Z(d.I,d.D,Fs))}}l.G=3,l.l&&l.l.ua(),l.ba&&(l.R=Date.now()-s.F,l.j.info("Handshake RTT: "+l.R+"ms")),d=l;var C=s;if(d.qa=el(d,d.J?d.ia:null,d.W),C.K){Cu(d.h,C);var J=C,he=d.L;he&&(J.I=he),J.B&&(ks(J),xr(J)),d.g=C}else Qu(d);0<l.i.length&&qr(l)}else W[0]!="stop"&&W[0]!="close"||bt(l,7);else l.G==3&&(W[0]=="stop"||W[0]=="close"?W[0]=="stop"?bt(l,7):Vs(l):W[0]!="noop"&&l.l&&l.l.ta(W),l.v=0)}}On(4)}catch{}}var yp=class{constructor(s,c){this.g=s,this.map=c}};function Su(s){this.l=s||10,u.PerformanceNavigationTiming?(s=u.performance.getEntriesByType("navigation"),s=0<s.length&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ru(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function Pu(s){return s.h?1:s.g?s.g.size:0}function Ns(s,c){return s.h?s.h==c:s.g?s.g.has(c):!1}function Os(s,c){s.g?s.g.add(c):s.h=c}function Cu(s,c){s.h&&s.h==c?s.h=null:s.g&&s.g.has(c)&&s.g.delete(c)}Su.prototype.cancel=function(){if(this.i=ku(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let s of this.g.values())s.cancel();this.g.clear()}};function ku(s){if(s.h!=null)return s.i.concat(s.h.D);if(s.g!=null&&s.g.size!==0){let c=s.i;for(let l of s.g.values())c=c.concat(l.D);return c}return V(s.i)}function Ip(s){if(s.V&&typeof s.V=="function")return s.V();if(typeof Map<"u"&&s instanceof Map||typeof Set<"u"&&s instanceof Set)return Array.from(s.values());if(typeof s=="string")return s.split("");if(h(s)){for(var c=[],l=s.length,d=0;d<l;d++)c.push(s[d]);return c}c=[],l=0;for(d in s)c[l++]=s[d];return c}function vp(s){if(s.na&&typeof s.na=="function")return s.na();if(!s.V||typeof s.V!="function"){if(typeof Map<"u"&&s instanceof Map)return Array.from(s.keys());if(!(typeof Set<"u"&&s instanceof Set)){if(h(s)||typeof s=="string"){var c=[];s=s.length;for(var l=0;l<s;l++)c.push(l);return c}c=[],l=0;for(let d in s)c[l++]=d;return c}}}function Du(s,c){if(s.forEach&&typeof s.forEach=="function")s.forEach(c,void 0);else if(h(s)||typeof s=="string")Array.prototype.forEach.call(s,c,void 0);else for(var l=vp(s),d=Ip(s),w=d.length,b=0;b<w;b++)c.call(void 0,d[b],l&&l[b],s)}var Nu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ep(s,c){if(s){s=s.split("&");for(var l=0;l<s.length;l++){var d=s[l].indexOf("="),w=null;if(0<=d){var b=s[l].substring(0,d);w=s[l].substring(d+1)}else b=s[l];c(b,w?decodeURIComponent(w.replace(/\+/g," ")):"")}}}function At(s){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,s instanceof At){this.h=s.h,Vr(this,s.j),this.o=s.o,this.g=s.g,Lr(this,s.s),this.l=s.l;var c=s.i,l=new Un;l.i=c.i,c.g&&(l.g=new Map(c.g),l.h=c.h),Ou(this,l),this.m=s.m}else s&&(c=String(s).match(Nu))?(this.h=!1,Vr(this,c[1]||"",!0),this.o=Mn(c[2]||""),this.g=Mn(c[3]||"",!0),Lr(this,c[4]),this.l=Mn(c[5]||"",!0),Ou(this,c[6]||"",!0),this.m=Mn(c[7]||"")):(this.h=!1,this.i=new Un(null,this.h))}At.prototype.toString=function(){var s=[],c=this.j;c&&s.push(Fn(c,xu,!0),":");var l=this.g;return(l||c=="file")&&(s.push("//"),(c=this.o)&&s.push(Fn(c,xu,!0),"@"),s.push(encodeURIComponent(String(l)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.s,l!=null&&s.push(":",String(l))),(l=this.l)&&(this.g&&l.charAt(0)!="/"&&s.push("/"),s.push(Fn(l,l.charAt(0)=="/"?Ap:Tp,!0))),(l=this.i.toString())&&s.push("?",l),(l=this.m)&&s.push("#",Fn(l,Sp)),s.join("")};function Ge(s){return new At(s)}function Vr(s,c,l){s.j=l?Mn(c,!0):c,s.j&&(s.j=s.j.replace(/:$/,""))}function Lr(s,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);s.s=c}else s.s=null}function Ou(s,c,l){c instanceof Un?(s.i=c,Rp(s.i,s.h)):(l||(c=Fn(c,bp)),s.i=new Un(c,s.h))}function Z(s,c,l){s.i.set(c,l)}function Mr(s){return Z(s,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),s}function Mn(s,c){return s?c?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function Fn(s,c,l){return typeof s=="string"?(s=encodeURI(s).replace(c,wp),l&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function wp(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var xu=/[#\/\?@]/g,Tp=/[#\?:]/g,Ap=/[#\?]/g,bp=/[#\?@]/g,Sp=/#/g;function Un(s,c){this.h=this.g=null,this.i=s||null,this.j=!!c}function lt(s){s.g||(s.g=new Map,s.h=0,s.i&&Ep(s.i,function(c,l){s.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=Un.prototype,n.add=function(s,c){lt(this),this.i=null,s=Wt(this,s);var l=this.g.get(s);return l||this.g.set(s,l=[]),l.push(c),this.h+=1,this};function Vu(s,c){lt(s),c=Wt(s,c),s.g.has(c)&&(s.i=null,s.h-=s.g.get(c).length,s.g.delete(c))}function Lu(s,c){return lt(s),c=Wt(s,c),s.g.has(c)}n.forEach=function(s,c){lt(this),this.g.forEach(function(l,d){l.forEach(function(w){s.call(c,w,d,this)},this)},this)},n.na=function(){lt(this);let s=Array.from(this.g.values()),c=Array.from(this.g.keys()),l=[];for(let d=0;d<c.length;d++){let w=s[d];for(let b=0;b<w.length;b++)l.push(c[d])}return l},n.V=function(s){lt(this);let c=[];if(typeof s=="string")Lu(this,s)&&(c=c.concat(this.g.get(Wt(this,s))));else{s=Array.from(this.g.values());for(let l=0;l<s.length;l++)c=c.concat(s[l])}return c},n.set=function(s,c){return lt(this),this.i=null,s=Wt(this,s),Lu(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[c]),this.h+=1,this},n.get=function(s,c){return s?(s=this.V(s),0<s.length?String(s[0]):c):c};function Mu(s,c,l){Vu(s,c),0<l.length&&(s.i=null,s.g.set(Wt(s,c),V(l)),s.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let s=[],c=Array.from(this.g.keys());for(var l=0;l<c.length;l++){var d=c[l];let b=encodeURIComponent(String(d)),C=this.V(d);for(d=0;d<C.length;d++){var w=b;C[d]!==""&&(w+="="+encodeURIComponent(String(C[d]))),s.push(w)}}return this.i=s.join("&")};function Wt(s,c){return c=String(c),s.j&&(c=c.toLowerCase()),c}function Rp(s,c){c&&!s.j&&(lt(s),s.i=null,s.g.forEach(function(l,d){var w=d.toLowerCase();d!=w&&(Vu(this,d),Mu(this,w,l))},s)),s.j=c}function Pp(s,c){let l=new Vn;if(u.Image){let d=new Image;d.onload=R(ht,l,"TestLoadImage: loaded",!0,c,d),d.onerror=R(ht,l,"TestLoadImage: error",!1,c,d),d.onabort=R(ht,l,"TestLoadImage: abort",!1,c,d),d.ontimeout=R(ht,l,"TestLoadImage: timeout",!1,c,d),u.setTimeout(function(){d.ontimeout&&d.ontimeout()},1e4),d.src=s}else c(!1)}function Cp(s,c){let l=new Vn,d=new AbortController,w=setTimeout(()=>{d.abort(),ht(l,"TestPingServer: timeout",!1,c)},1e4);fetch(s,{signal:d.signal}).then(b=>{clearTimeout(w),b.ok?ht(l,"TestPingServer: ok",!0,c):ht(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(w),ht(l,"TestPingServer: error",!1,c)})}function ht(s,c,l,d,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),d(l)}catch{}}function kp(){this.g=new dp}function Dp(s,c,l){let d=l||"";try{Du(s,function(w,b){let C=w;f(w)&&(C=Ts(w)),c.push(d+b+"="+encodeURIComponent(C))})}catch(w){throw c.push(d+"type="+encodeURIComponent("_badmap")),w}}function Bn(s){this.l=s.Ub||null,this.j=s.eb||!1}O(Bn,As),Bn.prototype.g=function(){return new Fr(this.l,this.j)},Bn.prototype.i=function(s){return function(){return s}}({});function Fr(s,c){pe.call(this),this.D=s,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}O(Fr,pe),n=Fr.prototype,n.open=function(s,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=s,this.A=c,this.readyState=1,$n(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};s&&(c.body=s),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,qn(this)),this.readyState=0},n.Sa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,$n(this)),this.g&&(this.readyState=3,$n(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Fu(this)}else s.text().then(this.Ra.bind(this),this.ga.bind(this))};function Fu(s){s.j.read().then(s.Pa.bind(s)).catch(s.ga.bind(s))}n.Pa=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var c=s.value?s.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!s.done}))&&(this.response=this.responseText+=c)}s.done?qn(this):$n(this),this.readyState==3&&Fu(this)}},n.Ra=function(s){this.g&&(this.response=this.responseText=s,qn(this))},n.Qa=function(s){this.g&&(this.response=s,qn(this))},n.ga=function(){this.g&&qn(this)};function qn(s){s.readyState=4,s.l=null,s.j=null,s.v=null,$n(s)}n.setRequestHeader=function(s,c){this.u.append(s,c)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let s=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,s.push(l[0]+": "+l[1]),l=c.next();return s.join(`\r
`)};function $n(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(Fr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function Uu(s){let c="";return Q(s,function(l,d){c+=d,c+=":",c+=l,c+=`\r
`}),c}function xs(s,c,l){e:{for(d in l){var d=!1;break e}d=!0}d||(l=Uu(l),typeof s=="string"?l!=null&&encodeURIComponent(String(l)):Z(s,c,l))}function ne(s){pe.call(this),this.headers=new Map,this.o=s||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}O(ne,pe);var Np=/^https?$/i,Op=["POST","PUT"];n=ne.prototype,n.Ha=function(s){this.J=s},n.ea=function(s,c,l,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);c=c?c.toUpperCase():"GET",this.D=s,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Rs.g(),this.v=this.o?pu(this.o):pu(Rs),this.g.onreadystatechange=S(this.Ea,this);try{this.B=!0,this.g.open(c,String(s),!0),this.B=!1}catch(b){Bu(this,b);return}if(s=l||"",l=new Map(this.headers),d)if(Object.getPrototypeOf(d)===Object.prototype)for(var w in d)l.set(w,d[w]);else if(typeof d.keys=="function"&&typeof d.get=="function")for(let b of d.keys())l.set(b,d.get(b));else throw Error("Unknown input type for opt_headers: "+String(d));d=Array.from(l.keys()).find(b=>b.toLowerCase()=="content-type"),w=u.FormData&&s instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Op,c,void 0))||d||w||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[b,C]of l)this.g.setRequestHeader(b,C);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ju(this),this.u=!0,this.g.send(s),this.u=!1}catch(b){Bu(this,b)}};function Bu(s,c){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=c,s.m=5,qu(s),Ur(s)}function qu(s){s.A||(s.A=!0,Ee(s,"complete"),Ee(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=s||7,Ee(this,"complete"),Ee(this,"abort"),Ur(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ur(this,!0)),ne.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?$u(this):this.bb())},n.bb=function(){$u(this)};function $u(s){if(s.h&&typeof a<"u"&&(!s.v[1]||Ke(s)!=4||s.Z()!=2)){if(s.u&&Ke(s)==4)lu(s.Ea,0,s);else if(Ee(s,"readystatechange"),Ke(s)==4){s.h=!1;try{let C=s.Z();e:switch(C){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var l;if(!(l=c)){var d;if(d=C===0){var w=String(s.D).match(Nu)[1]||null;!w&&u.self&&u.self.location&&(w=u.self.location.protocol.slice(0,-1)),d=!Np.test(w?w.toLowerCase():"")}l=d}if(l)Ee(s,"complete"),Ee(s,"success");else{s.m=6;try{var b=2<Ke(s)?s.g.statusText:""}catch{b=""}s.l=b+" ["+s.Z()+"]",qu(s)}}finally{Ur(s)}}}}function Ur(s,c){if(s.g){ju(s);let l=s.g,d=s.v[0]?()=>{}:null;s.g=null,s.v=null,c||Ee(s,"ready");try{l.onreadystatechange=d}catch{}}}function ju(s){s.I&&(u.clearTimeout(s.I),s.I=null)}n.isActive=function(){return!!this.g};function Ke(s){return s.g?s.g.readyState:0}n.Z=function(){try{return 2<Ke(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(s){if(this.g){var c=this.g.responseText;return s&&c.indexOf(s)==0&&(c=c.substring(s.length)),hp(c)}};function zu(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.H){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function xp(s){let c={};s=(s.g&&2<=Ke(s)&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let d=0;d<s.length;d++){if(H(s[d]))continue;var l=E(s[d]);let w=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();let b=c[w]||[];c[w]=b,b.push(l)}v(c,function(d){return d.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function jn(s,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[s]||c}function Wu(s){this.Aa=0,this.i=[],this.j=new Vn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=jn("failFast",!1,s),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=jn("baseRetryDelayMs",5e3,s),this.cb=jn("retryDelaySeedMs",1e4,s),this.Wa=jn("forwardChannelMaxRetries",2,s),this.wa=jn("forwardChannelRequestTimeoutMs",2e4,s),this.pa=s&&s.xmlHttpFactory||void 0,this.Xa=s&&s.Tb||void 0,this.Ca=s&&s.useFetchStreams||!1,this.L=void 0,this.J=s&&s.supportsCrossDomainXhr||!1,this.K="",this.h=new Su(s&&s.concurrentRequestLimit),this.Da=new kp,this.P=s&&s.fastHandshake||!1,this.O=s&&s.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=s&&s.Rb||!1,s&&s.xa&&this.j.xa(),s&&s.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&s&&s.detectBufferingProxy||!1,this.ja=void 0,s&&s.longPollingTimeout&&0<s.longPollingTimeout&&(this.ja=s.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Wu.prototype,n.la=8,n.G=1,n.connect=function(s,c,l,d){we(0),this.W=s,this.H=c||{},l&&d!==void 0&&(this.H.OSID=l,this.H.OAID=d),this.F=this.X,this.I=el(this,null,this.W),qr(this)};function Vs(s){if(Gu(s),s.G==3){var c=s.U++,l=Ge(s.I);if(Z(l,"SID",s.K),Z(l,"RID",c),Z(l,"TYPE","terminate"),zn(s,l),c=new ut(s,s.j,c),c.L=2,c.v=Mr(Ge(l)),l=!1,u.navigator&&u.navigator.sendBeacon)try{l=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!l&&u.Image&&(new Image().src=c.v,l=!0),l||(c.g=tl(c.j,null),c.g.ea(c.v)),c.F=Date.now(),xr(c)}Zu(s)}function Br(s){s.g&&(Ms(s),s.g.cancel(),s.g=null)}function Gu(s){Br(s),s.u&&(u.clearTimeout(s.u),s.u=null),$r(s),s.h.cancel(),s.s&&(typeof s.s=="number"&&u.clearTimeout(s.s),s.s=null)}function qr(s){if(!Ru(s.h)&&!s.s){s.s=!0;var c=s.Ga;Rn||iu(),Pn||(Rn(),Pn=!0),ps.add(c,s),s.B=0}}function Vp(s,c){return Pu(s.h)>=s.h.j-(s.s?1:0)?!1:s.s?(s.i=c.D.concat(s.i),!0):s.G==1||s.G==2||s.B>=(s.Va?0:s.Wa)?!1:(s.s=xn(S(s.Ga,s,c),Xu(s,s.B)),s.B++,!0)}n.Ga=function(s){if(this.s)if(this.s=null,this.G==1){if(!s){this.U=Math.floor(1e5*Math.random()),s=this.U++;let w=new ut(this,this.j,s),b=this.o;if(this.S&&(b?(b=p(b),y(b,this.S)):b=this.S),this.m!==null||this.O||(w.H=b,b=null),this.P)e:{for(var c=0,l=0;l<this.i.length;l++){t:{var d=this.i[l];if("__data__"in d.map&&(d=d.map.__data__,typeof d=="string")){d=d.length;break t}d=void 0}if(d===void 0)break;if(c+=d,4096<c){c=l;break e}if(c===4096||l===this.i.length-1){c=l+1;break e}}c=1e3}else c=1e3;c=Hu(this,w,c),l=Ge(this.I),Z(l,"RID",s),Z(l,"CVER",22),this.D&&Z(l,"X-HTTP-Session-Id",this.D),zn(this,l),b&&(this.O?c="headers="+encodeURIComponent(String(Uu(b)))+"&"+c:this.m&&xs(l,this.m,b)),Os(this.h,w),this.Ua&&Z(l,"TYPE","init"),this.P?(Z(l,"$req",c),Z(l,"SID","null"),w.T=!0,Cs(w,l,null)):Cs(w,l,c),this.G=2}}else this.G==3&&(s?Ku(this,s):this.i.length==0||Ru(this.h)||Ku(this))};function Ku(s,c){var l;c?l=c.l:l=s.U++;let d=Ge(s.I);Z(d,"SID",s.K),Z(d,"RID",l),Z(d,"AID",s.T),zn(s,d),s.m&&s.o&&xs(d,s.m,s.o),l=new ut(s,s.j,l,s.B+1),s.m===null&&(l.H=s.o),c&&(s.i=c.D.concat(s.i)),c=Hu(s,l,1e3),l.I=Math.round(.5*s.wa)+Math.round(.5*s.wa*Math.random()),Os(s.h,l),Cs(l,d,c)}function zn(s,c){s.H&&Q(s.H,function(l,d){Z(c,d,l)}),s.l&&Du({},function(l,d){Z(c,d,l)})}function Hu(s,c,l){l=Math.min(s.i.length,l);var d=s.l?S(s.l.Na,s.l,s):null;e:{var w=s.i;let b=-1;for(;;){let C=["count="+l];b==-1?0<l?(b=w[0].g,C.push("ofs="+b)):b=0:C.push("ofs="+b);let J=!0;for(let he=0;he<l;he++){let W=w[he].g,me=w[he].map;if(W-=b,0>W)b=Math.max(0,w[he].g-100),J=!1;else try{Dp(me,C,"req"+W+"_")}catch{d&&d(me)}}if(J){d=C.join("&");break e}}}return s=s.i.splice(0,l),c.D=s,d}function Qu(s){if(!s.g&&!s.u){s.Y=1;var c=s.Fa;Rn||iu(),Pn||(Rn(),Pn=!0),ps.add(c,s),s.v=0}}function Ls(s){return s.g||s.u||3<=s.v?!1:(s.Y++,s.u=xn(S(s.Fa,s),Xu(s,s.v)),s.v++,!0)}n.Fa=function(){if(this.u=null,Yu(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var s=2*this.R;this.j.info("BP detection timer enabled: "+s),this.A=xn(S(this.ab,this),s)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,we(10),Br(this),Yu(this))};function Ms(s){s.A!=null&&(u.clearTimeout(s.A),s.A=null)}function Yu(s){s.g=new ut(s,s.j,"rpc",s.Y),s.m===null&&(s.g.H=s.o),s.g.O=0;var c=Ge(s.qa);Z(c,"RID","rpc"),Z(c,"SID",s.K),Z(c,"AID",s.T),Z(c,"CI",s.F?"0":"1"),!s.F&&s.ja&&Z(c,"TO",s.ja),Z(c,"TYPE","xmlhttp"),zn(s,c),s.m&&s.o&&xs(c,s.m,s.o),s.L&&(s.g.I=s.L);var l=s.g;s=s.ia,l.L=1,l.v=Mr(Ge(c)),l.m=null,l.P=!0,Tu(l,s)}n.Za=function(){this.C!=null&&(this.C=null,Br(this),Ls(this),we(19))};function $r(s){s.C!=null&&(u.clearTimeout(s.C),s.C=null)}function Ju(s,c){var l=null;if(s.g==c){$r(s),Ms(s),s.g=null;var d=2}else if(Ns(s.h,c))l=c.D,Cu(s.h,c),d=1;else return;if(s.G!=0){if(c.o)if(d==1){l=c.m?c.m.length:0,c=Date.now()-c.F;var w=s.B;d=Dr(),Ee(d,new Iu(d,l)),qr(s)}else Qu(s);else if(w=c.s,w==3||w==0&&0<c.X||!(d==1&&Vp(s,c)||d==2&&Ls(s)))switch(l&&0<l.length&&(c=s.h,c.i=c.i.concat(l)),w){case 1:bt(s,5);break;case 4:bt(s,10);break;case 3:bt(s,6);break;default:bt(s,2)}}}function Xu(s,c){let l=s.Ta+Math.floor(Math.random()*s.cb);return s.isActive()||(l*=2),l*c}function bt(s,c){if(s.j.info("Error code "+c),c==2){var l=S(s.fb,s),d=s.Xa;let w=!d;d=new At(d||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Vr(d,"https"),Mr(d),w?Pp(d.toString(),l):Cp(d.toString(),l)}else we(2);s.G=0,s.l&&s.l.sa(c),Zu(s),Gu(s)}n.fb=function(s){s?(this.j.info("Successfully pinged google.com"),we(2)):(this.j.info("Failed to ping google.com"),we(1))};function Zu(s){if(s.G=0,s.ka=[],s.l){let c=ku(s.h);(c.length!=0||s.i.length!=0)&&(N(s.ka,c),N(s.ka,s.i),s.h.i.length=0,V(s.i),s.i.length=0),s.l.ra()}}function el(s,c,l){var d=l instanceof At?Ge(l):new At(l);if(d.g!="")c&&(d.g=c+"."+d.g),Lr(d,d.s);else{var w=u.location;d=w.protocol,c=c?c+"."+w.hostname:w.hostname,w=+w.port;var b=new At(null);d&&Vr(b,d),c&&(b.g=c),w&&Lr(b,w),l&&(b.l=l),d=b}return l=s.D,c=s.ya,l&&c&&Z(d,l,c),Z(d,"VER",s.la),zn(s,d),d}function tl(s,c,l){if(c&&!s.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=s.Ca&&!s.pa?new ne(new Bn({eb:l})):new ne(s.pa),c.Ha(s.J),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function nl(){}n=nl.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function jr(){}jr.prototype.g=function(s,c){return new be(s,c)};function be(s,c){pe.call(this),this.g=new Wu(c),this.l=s,this.h=c&&c.messageUrlParams||null,s=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(s?s["X-WebChannel-Content-Type"]=c.messageContentType:s={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(s?s["X-WebChannel-Client-Profile"]=c.va:s={"X-WebChannel-Client-Profile":c.va}),this.g.S=s,(s=c&&c.Sb)&&!H(s)&&(this.g.m=s),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!H(c)&&(this.g.D=c,s=this.h,s!==null&&c in s&&(s=this.h,c in s&&delete s[c])),this.j=new Gt(this)}O(be,pe),be.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},be.prototype.close=function(){Vs(this.g)},be.prototype.o=function(s){var c=this.g;if(typeof s=="string"){var l={};l.__data__=s,s=l}else this.u&&(l={},l.__data__=Ts(s),s=l);c.i.push(new yp(c.Ya++,s)),c.G==3&&qr(c)},be.prototype.N=function(){this.g.l=null,delete this.j,Vs(this.g),delete this.g,be.aa.N.call(this)};function rl(s){bs.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var c=s.__sm__;if(c){e:{for(let l in c){s=l;break e}s=void 0}(this.i=s)&&(s=this.i,c=c!==null&&s in c?c[s]:void 0),this.data=c}else this.data=s}O(rl,bs);function il(){Ss.call(this),this.status=1}O(il,Ss);function Gt(s){this.g=s}O(Gt,nl),Gt.prototype.ua=function(){Ee(this.g,"a")},Gt.prototype.ta=function(s){Ee(this.g,new rl(s))},Gt.prototype.sa=function(s){Ee(this.g,new il)},Gt.prototype.ra=function(){Ee(this.g,"b")},jr.prototype.createWebChannel=jr.prototype.g,be.prototype.send=be.prototype.o,be.prototype.open=be.prototype.m,be.prototype.close=be.prototype.close,na=nt.createWebChannelTransport=function(){return new jr},ta=nt.getStatEventTarget=function(){return Dr()},ea=nt.Event=wt,Ai=nt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Nr.NO_ERROR=0,Nr.TIMEOUT=8,Nr.HTTP_ERROR=6,rr=nt.ErrorCode=Nr,vu.COMPLETE="complete",Zo=nt.EventType=vu,mu.EventType=Nn,Nn.OPEN="a",Nn.CLOSE="b",Nn.ERROR="c",Nn.MESSAGE="d",pe.prototype.listen=pe.prototype.K,Zt=nt.WebChannel=mu,PI=nt.FetchXmlHttpFactory=Bn,ne.prototype.listenOnce=ne.prototype.L,ne.prototype.getLastError=ne.prototype.Ka,ne.prototype.getLastErrorCode=ne.prototype.Ba,ne.prototype.getStatus=ne.prototype.Z,ne.prototype.getResponseJson=ne.prototype.Oa,ne.prototype.getResponseText=ne.prototype.oa,ne.prototype.send=ne.prototype.ea,ne.prototype.setWithCredentials=ne.prototype.Ha,Xo=nt.XhrIo=ne}).apply(typeof Ti<"u"?Ti:typeof self<"u"?self:typeof window<"u"?window:{});var Yh="@firebase/firestore",Jh="4.7.8";var ue=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ue.UNAUTHENTICATED=new ue(null),ue.GOOGLE_CREDENTIALS=new ue("google-credentials-uid"),ue.FIRST_PARTY=new ue("first-party-uid"),ue.MOCK_USER=new ue("mock-user");var Tn="11.3.1";var qt=new Ce("@firebase/firestore");function en(){return qt.logLevel}function D(n,...e){if(qt.logLevel<=U.DEBUG){let t=e.map(Bc);qt.debug(`Firestore (${Tn}): ${n}`,...t)}}function it(n,...e){if(qt.logLevel<=U.ERROR){let t=e.map(Bc);qt.error(`Firestore (${Tn}): ${n}`,...t)}}function ln(n,...e){if(qt.logLevel<=U.WARN){let t=e.map(Bc);qt.warn(`Firestore (${Tn}): ${n}`,...t)}}function Bc(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function M(n="Unexpected state"){let e=`FIRESTORE (${Tn}) INTERNAL ASSERTION FAILED: `+n;throw it(e),new Error(e)}function te(n,e){n||M()}function $(n,e){return n}var k={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends _e{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var yt=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Di=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},ca=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ue.UNAUTHENTICATED))}shutdown(){}},ua=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},la=class{constructor(e){this.t=e,this.currentUser=ue.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){te(this.o===void 0);let r=this.i,i=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve(),o=new yt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new yt,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let h=o;e.enqueueRetryable(()=>T(this,null,function*(){yield h.promise,yield i(this.currentUser)}))},u=h=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>u(h)),setTimeout(()=>{if(!this.auth){let h=this.t.getImmediate({optional:!0});h?u(h):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new yt)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(te(typeof r.accessToken=="string"),new Di(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return te(e===null||typeof e=="string"),new ue(e)}},ha=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=ue.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);let e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}},da=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new ha(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(ue.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ni=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},fa=class{constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Ye(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,t){te(this.o===void 0);let r=o=>{o.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let a=o.token!==this.R;return this.R=o.token,D("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};let i=o=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){let o=this.A.getImmediate({optional:!0});o?i(o):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new Ni(this.V));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(te(typeof t.token=="string"),this.R=t.token,new Ni(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function CI(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var pa=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=CI(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%62))}return r}};function q(n,e){return n<e?-1:n>e?1:0}function hn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var Xh=-62135596800,Zh=1e6,De=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Zh);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Xh)throw new x(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Zh}_compareTo(e){return this.seconds===e.seconds?q(this.nanoseconds,e.nanoseconds):q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-Xh;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var F=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new De(0,0))}static max(){return new n(new De(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var ed="__name__",Oi=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&M(),r===void 0?r=e.length-t:r>e.length-t&&M(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let o=n.compareSegments(e.get(i),t.get(i));if(o!==0)return o}return Math.sign(e.length-t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):e<t?-1:e>t?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return tt.fromString(e.substring(4,e.length-2))}},ae=class n extends Oi{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new x(k.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},kI=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Le=class n extends Oi{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return kI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ed}static keyField(){return new n([ed])}static fromServerFormat(e){let t=[],r="",i=0,o=()=>{if(r.length===0)throw new x(k.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new x(k.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new x(k.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(r+=u,i++):(o(),i++)}if(o(),a)throw new x(k.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var L=class n{constructor(e){this.path=e}static fromPath(e){return new n(ae.fromString(e))}static fromName(e){return new n(ae.fromString(e).popFirst(5))}static empty(){return new n(ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new ae(e.slice()))}};var lr=-1,ma=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};ma.UNKNOWN_ID=-1;function DI(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=F.fromTimestamp(r===1e9?new De(t+1,0):new De(t,r));return new $t(i,L.empty(),e)}function NI(n){return new $t(n.readTime,n.key,lr)}var $t=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(F.min(),L.empty(),lr)}static max(){return new n(F.max(),L.empty(),lr)}};function OI(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(n.documentKey,e.documentKey),t!==0?t:q(n.largestBatchId,e.largestBatchId))}var xI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ga=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function as(n){return T(this,null,function*(){if(n.code!==k.FAILED_PRECONDITION||n.message!==xI)throw n;D("LocalStore","Unexpectedly lost primary lease")})}var P=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&M(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,o=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++o,a&&o===i&&t()},h=>r(h))}),a=!0,o===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let o=e.length,a=new Array(o),u=0;for(let h=0;h<o;h++){let f=h;t(e[f]).next(m=>{a[f]=m,++u,u===o&&r(a)},m=>i(m))}})}static doWhile(e,t){return new n((r,i)=>{let o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}};function VI(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function An(n){return n.name==="IndexedDbTransactionError"}var qc=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.oe(i),this._e=i=>r.writeSequenceNumber(i))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this._e&&this._e(t),t}}n.ae=-1;return n})(),LI=-1;function cs(n){return n==null}function xi(n){return n===0&&1/n==-1/0}var Bd="";function MI(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=td(e)),e=FI(n.get(t),e);return td(e)}function FI(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let o=n.charAt(i);switch(o){case"\0":t+="";break;case Bd:t+="";break;default:t+=o}}return t}function td(n){return n+Bd+""}var UI="remoteDocuments",qd="owner";var $d="mutationQueues";var jd="mutations";var zd="documentMutations",BI="remoteDocumentsV14";var Wd="remoteDocumentGlobal";var Gd="targets";var Kd="targetDocuments";var Hd="targetGlobal",Qd="collectionParents";var Yd="clientMetadata";var Jd="bundles";var Xd="namedQueries";var qI="indexConfiguration";var $I="indexState";var jI="indexEntries";var Zd="documentOverlays";var zI="globals";var WI=[$d,jd,zd,UI,Gd,qd,Hd,Kd,Yd,Wd,Qd,Jd,Xd],ib=[...WI,Zd],GI=[$d,jd,zd,BI,Gd,qd,Hd,Kd,Yd,Wd,Qd,Jd,Xd,Zd],KI=GI,HI=[...KI,qI,$I,jI];var sb=[...HI,zI];function nd(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ar(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function QI(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ie=class n{constructor(e,t){this.comparator=e,this.root=t||qe.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,qe.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new sn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new sn(this.root,e,this.comparator,!1)}getReverseIterator(){return new sn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new sn(this.root,e,this.comparator,!0)}},sn=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},qe=class n{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new n(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw M();let e=this.left.check();if(e!==this.right.check())throw M();return e+(this.isRed()?0:1)}};qe.EMPTY=null,qe.RED=!0,qe.BLACK=!1;qe.EMPTY=new class{constructor(){this.size=0}get key(){throw M()}get value(){throw M()}get color(){throw M()}get left(){throw M()}get right(){throw M()}copy(e,t,r,i,o){return this}insert(e,t,r){return new qe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var le=class n{constructor(e){this.comparator=e,this.data=new ie(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Vi(this.data.getIterator())}getIteratorFrom(e){return new Vi(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Vi=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var Mt=class n{constructor(e){this.fields=e,e.sort(Le.comparator)}static empty(){return new n([])}unionWith(e){let t=new le(Le.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return hn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Li=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Ie=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Li("Invalid base64 string: "+o):o}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ie.EMPTY_BYTE_STRING=new Ie("");var YI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function st(n){if(te(!!n),typeof n=="string"){let e=0,t=YI.exec(n);if(te(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ee(n.seconds),nanos:ee(n.nanos)}}function ee(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ot(n){return typeof n=="string"?Ie.fromBase64String(n):Ie.fromUint8Array(n)}var ef="server_timestamp",tf="__type__",nf="__previous_value__",rf="__local_write_time__";function $c(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[tf])===null||t===void 0?void 0:t.stringValue)===ef}function us(n){let e=n.mapValue.fields[nf];return $c(e)?us(e):e}function hr(n){let e=st(n.mapValue.fields[rf].timestampValue);return new De(e.seconds,e.nanos)}var _a=class{constructor(e,t,r,i,o,a,u,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=f}},Mi="(default)",Fi=class n{constructor(e,t){this.projectId=e,this.database=t||Mi}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Mi}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var sf="__type__",of="__max__",bi={mapValue:{fields:{__type__:{stringValue:of}}}},af="__vector__",dr="value";function It(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?$c(n)?4:uf(n)?9007199254740991:cf(n)?10:11:M()}function je(n,e){if(n===e)return!0;let t=It(n);if(t!==It(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return hr(n).isEqual(hr(e));case 3:return function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;let a=st(i.timestampValue),u=st(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,o){return ot(i.bytesValue).isEqual(ot(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,o){return ee(i.geoPointValue.latitude)===ee(o.geoPointValue.latitude)&&ee(i.geoPointValue.longitude)===ee(o.geoPointValue.longitude)}(n,e);case 2:return function(i,o){if("integerValue"in i&&"integerValue"in o)return ee(i.integerValue)===ee(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){let a=ee(i.doubleValue),u=ee(o.doubleValue);return a===u?xi(a)===xi(u):isNaN(a)&&isNaN(u)}return!1}(n,e);case 9:return hn(n.arrayValue.values||[],e.arrayValue.values||[],je);case 10:case 11:return function(i,o){let a=i.mapValue.fields||{},u=o.mapValue.fields||{};if(nd(a)!==nd(u))return!1;for(let h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!je(a[h],u[h])))return!1;return!0}(n,e);default:return M()}}function fr(n,e){return(n.values||[]).find(t=>je(t,e))!==void 0}function dn(n,e){if(n===e)return 0;let t=It(n),r=It(e);if(t!==r)return q(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return q(n.booleanValue,e.booleanValue);case 2:return function(o,a){let u=ee(o.integerValue||o.doubleValue),h=ee(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(n,e);case 3:return rd(n.timestampValue,e.timestampValue);case 4:return rd(hr(n),hr(e));case 5:return q(n.stringValue,e.stringValue);case 6:return function(o,a){let u=ot(o),h=ot(a);return u.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(o,a){let u=o.split("/"),h=a.split("/");for(let f=0;f<u.length&&f<h.length;f++){let m=q(u[f],h[f]);if(m!==0)return m}return q(u.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,a){let u=q(ee(o.latitude),ee(a.latitude));return u!==0?u:q(ee(o.longitude),ee(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return id(n.arrayValue,e.arrayValue);case 10:return function(o,a){var u,h,f,m;let I=o.fields||{},S=a.fields||{},R=(u=I[dr])===null||u===void 0?void 0:u.arrayValue,O=(h=S[dr])===null||h===void 0?void 0:h.arrayValue,V=q(((f=R?.values)===null||f===void 0?void 0:f.length)||0,((m=O?.values)===null||m===void 0?void 0:m.length)||0);return V!==0?V:id(R,O)}(n.mapValue,e.mapValue);case 11:return function(o,a){if(o===bi.mapValue&&a===bi.mapValue)return 0;if(o===bi.mapValue)return 1;if(a===bi.mapValue)return-1;let u=o.fields||{},h=Object.keys(u),f=a.fields||{},m=Object.keys(f);h.sort(),m.sort();for(let I=0;I<h.length&&I<m.length;++I){let S=q(h[I],m[I]);if(S!==0)return S;let R=dn(u[h[I]],f[m[I]]);if(R!==0)return R}return q(h.length,m.length)}(n.mapValue,e.mapValue);default:throw M()}}function rd(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return q(n,e);let t=st(n),r=st(e),i=q(t.seconds,r.seconds);return i!==0?i:q(t.nanos,r.nanos)}function id(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let o=dn(t[i],r[i]);if(o)return o}return q(t.length,r.length)}function fn(n){return ya(n)}function ya(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=st(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return ot(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return L.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let o of t.values||[])i?i=!1:r+=",",r+=ya(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",o=!0;for(let a of r)o?o=!1:i+=",",i+=`${a}:${ya(t.fields[a])}`;return i+"}"}(n.mapValue):M()}function Pi(n){switch(It(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=us(n);return e?16+Pi(e):16;case 5:return 2*n.stringValue.length;case 6:return ot(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,o)=>i+Pi(o),0)}(n.arrayValue);case 10:case 11:return function(r){let i=0;return Ar(r.fields,(o,a)=>{i+=o.length+Pi(a)}),i}(n.mapValue);default:throw M()}}function Ia(n){return!!n&&"integerValue"in n}function jc(n){return!!n&&"arrayValue"in n}function sd(n){return!!n&&"nullValue"in n}function od(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ra(n){return!!n&&"mapValue"in n}function cf(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[sf])===null||t===void 0?void 0:t.stringValue)===af}function sr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Ar(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=sr(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=sr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function uf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===of}var ab={mapValue:{fields:{[sf]:{stringValue:af},[dr]:{arrayValue:{}}}}};var rt=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ra(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sr(t)}setAll(e){let t=Le.emptyPath(),r={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let h=this.getFieldsMap(t);this.applyChanges(h,r,i),r={},i=[],t=u.popLast()}a?r[u.lastSegment()]=sr(a):i.push(u.lastSegment())});let o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){let t=this.field(e.popLast());ra(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return je(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];ra(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Ar(t,(i,o)=>e[i]=o);for(let i of r)delete e[i]}clone(){return new n(sr(this.value))}};var Me=class n{constructor(e,t,r,i,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new n(e,0,F.min(),F.min(),F.min(),rt.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,F.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,F.min(),F.min(),rt.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,F.min(),F.min(),rt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(F.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=rt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=rt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=F.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var pn=class{constructor(e,t){this.position=e,this.inclusive=t}};function ad(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let o=e[i],a=n.position[i];if(o.field.isKeyField()?r=L.comparator(L.fromName(a.referenceValue),t.key):r=dn(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function cd(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!je(n.position[t],e.position[t]))return!1;return!0}var mn=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function JI(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var Ui=class{},ce=class n extends Ui{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Ea(e,t,r):t==="array-contains"?new Aa(e,r):t==="in"?new ba(e,r):t==="not-in"?new Sa(e,r):t==="array-contains-any"?new Ra(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new wa(e,r):new Ta(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(dn(t,this.value)):t!==null&&It(this.value)===It(t)&&this.matchesComparison(dn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return M()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ze=class n extends Ui{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new n(e,t)}matches(e){return lf(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}};function lf(n){return n.op==="and"}function hf(n){return XI(n)&&lf(n)}function XI(n){for(let e of n.filters)if(e instanceof ze)return!1;return!0}function va(n){if(n instanceof ce)return n.field.canonicalString()+n.op.toString()+fn(n.value);if(hf(n))return n.filters.map(e=>va(e)).join(",");{let e=n.filters.map(t=>va(t)).join(",");return`${n.op}(${e})`}}function df(n,e){return n instanceof ce?function(r,i){return i instanceof ce&&r.op===i.op&&r.field.isEqual(i.field)&&je(r.value,i.value)}(n,e):n instanceof ze?function(r,i){return i instanceof ze&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,u)=>o&&df(a,i.filters[u]),!0):!1}(n,e):void M()}function ff(n){return n instanceof ce?function(t){return`${t.field.canonicalString()} ${t.op} ${fn(t.value)}`}(n):n instanceof ze?function(t){return t.op.toString()+" {"+t.getFilters().map(ff).join(" ,")+"}"}(n):"Filter"}var Ea=class extends ce{constructor(e,t,r){super(e,t,r),this.key=L.fromName(r.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},wa=class extends ce{constructor(e,t){super(e,"in",t),this.keys=pf("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Ta=class extends ce{constructor(e,t){super(e,"not-in",t),this.keys=pf("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function pf(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>L.fromName(r.referenceValue))}var Aa=class extends ce{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return jc(t)&&fr(t.arrayValue,this.value)}},ba=class extends ce{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&fr(this.value.arrayValue,t)}},Sa=class extends ce{constructor(e,t){super(e,"not-in",t)}matches(e){if(fr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!fr(this.value.arrayValue,t)}},Ra=class extends ce{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!jc(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>fr(this.value.arrayValue,r))}};var Pa=class{constructor(e,t=null,r=[],i=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=u,this.le=null}};function ud(n,e=null,t=[],r=[],i=null,o=null,a=null){return new Pa(n,e,t,r,i,o,a)}function zc(n){let e=$(n);if(e.le===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>va(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),cs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>fn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>fn(r)).join(",")),e.le=t}return e.le}function Wc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!JI(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!df(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!cd(n.startAt,e.startAt)&&cd(n.endAt,e.endAt)}function Ca(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var gn=class{constructor(e,t=null,r=[],i=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}};function ZI(n,e,t,r,i,o,a,u){return new gn(n,e,t,r,i,o,a,u)}function Gc(n){return new gn(n)}function ld(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function ev(n){return n.collectionGroup!==null}function or(n){let e=$(n);if(e.he===null){e.he=[];let t=new Set;for(let o of e.explicitOrderBy)e.he.push(o),t.add(o.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new le(Le.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(u=u.add(f.field))})}),u})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.he.push(new mn(o,r))}),t.has(Le.keyField().canonicalString())||e.he.push(new mn(Le.keyField(),r))}return e.he}function $e(n){let e=$(n);return e.Pe||(e.Pe=tv(e,or(n))),e.Pe}function tv(n,e){if(n.limitType==="F")return ud(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let o=i.dir==="desc"?"asc":"desc";return new mn(i.field,o)});let t=n.endAt?new pn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new pn(n.startAt.position,n.startAt.inclusive):null;return ud(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function ka(n,e,t){return new gn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ls(n,e){return Wc($e(n),$e(e))&&n.limitType===e.limitType}function mf(n){return`${zc($e(n))}|lt:${n.limitType}`}function tn(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>ff(i)).join(", ")}]`),cs(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>fn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>fn(i)).join(",")),`Target(${r})`}($e(n))}; limitType=${n.limitType})`}function hs(n,e){return e.isFoundDocument()&&function(r,i){let o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):L.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,e)&&function(r,i){for(let o of or(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let o of r.filters)if(!o.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,u,h){let f=ad(a,u,h);return a.inclusive?f<=0:f<0}(r.startAt,or(r),i)||r.endAt&&!function(a,u,h){let f=ad(a,u,h);return a.inclusive?f>=0:f>0}(r.endAt,or(r),i))}(n,e)}function nv(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function gf(n){return(e,t)=>{let r=!1;for(let i of or(n)){let o=rv(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function rv(n,e,t){let r=n.field.isKeyField()?L.comparator(e.key,t.key):function(o,a,u){let h=a.data.field(o),f=u.data.field(o);return h!==null&&f!==null?dn(h,f):M()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return M()}}var at=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ar(this.inner,(t,r)=>{for(let[i,o]of r)e(i,o)})}isEmpty(){return QI(this.inner)}size(){return this.innerSize}};var iv=new ie(L.comparator);function vt(){return iv}var _f=new ie(L.comparator);function ir(...n){let e=_f;for(let t of n)e=e.insert(t.key,t);return e}function sv(n){let e=_f;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ft(){return ar()}function yf(){return ar()}function ar(){return new at(n=>n.toString(),(n,e)=>n.isEqual(e))}var cb=new ie(L.comparator),ov=new le(L.comparator);function j(...n){let e=ov;for(let t of n)e=e.add(t);return e}var av=new le(q);function cv(){return av}function uv(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xi(e)?"-0":e}}function lv(n){return{integerValue:""+n}}var _n=class{constructor(){this._=void 0}};function hv(n,e,t){return n instanceof pr?function(i,o){let a={fields:{[tf]:{stringValue:ef},[rf]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&$c(o)&&(o=us(o)),o&&(a.fields[nf]=o),{mapValue:a}}(t,e):n instanceof yn?If(n,e):n instanceof In?vf(n,e):function(i,o){let a=fv(i,o),u=hd(a)+hd(i.Ie);return Ia(a)&&Ia(i.Ie)?lv(u):uv(i.serializer,u)}(n,e)}function dv(n,e,t){return n instanceof yn?If(n,e):n instanceof In?vf(n,e):t}function fv(n,e){return n instanceof mr?function(r){return Ia(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}var pr=class extends _n{},yn=class extends _n{constructor(e){super(),this.elements=e}};function If(n,e){let t=Ef(e);for(let r of n.elements)t.some(i=>je(i,r))||t.push(r);return{arrayValue:{values:t}}}var In=class extends _n{constructor(e){super(),this.elements=e}};function vf(n,e){let t=Ef(e);for(let r of n.elements)t=t.filter(i=>!je(i,r));return{arrayValue:{values:t}}}var mr=class extends _n{constructor(e,t){super(),this.serializer=e,this.Ie=t}};function hd(n){return ee(n.integerValue||n.doubleValue)}function Ef(n){return jc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function pv(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof yn&&i instanceof yn||r instanceof In&&i instanceof In?hn(r.elements,i.elements,je):r instanceof mr&&i instanceof mr?je(r.Ie,i.Ie):r instanceof pr&&i instanceof pr}(n.transform,e.transform)}var cr=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Ci(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var gr=class{};function wf(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Da(n.key,cr.none()):new _r(n.key,n.data,cr.none());{let t=n.data,r=rt.empty(),i=new le(Le.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new vn(n.key,r,new Mt(i.toArray()),cr.none())}}function mv(n,e,t){n instanceof _r?function(i,o,a){let u=i.value.clone(),h=fd(i.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(n,e,t):n instanceof vn?function(i,o,a){if(!Ci(i.precondition,o))return void o.convertToUnknownDocument(a.version);let u=fd(i.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Tf(i)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,e,t):function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function ur(n,e,t,r){return n instanceof _r?function(o,a,u,h){if(!Ci(o.precondition,a))return u;let f=o.value.clone(),m=pd(o.fieldTransforms,h,a);return f.setAll(m),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null}(n,e,t,r):n instanceof vn?function(o,a,u,h){if(!Ci(o.precondition,a))return u;let f=pd(o.fieldTransforms,h,a),m=a.data;return m.setAll(Tf(o)),m.setAll(f),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(I=>I.field))}(n,e,t,r):function(o,a,u){return Ci(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(n,e,t)}function dd(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&hn(r,i,(o,a)=>pv(o,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var _r=class extends gr{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},vn=class extends gr{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function Tf(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function fd(n,e,t){let r=new Map;te(n.length===t.length);for(let i=0;i<t.length;i++){let o=n[i],a=o.transform,u=e.data.field(o.field);r.set(o.field,dv(a,u,t[i]))}return r}function pd(n,e,t){let r=new Map;for(let i of n){let o=i.transform,a=t.data.field(i.field);r.set(i.field,hv(o,a,e))}return r}var Da=class extends gr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};var Na=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let o=this.mutations[i];o.key.isEqual(e.key)&&mv(o,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=ur(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=ur(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=yf();return this.mutations.forEach(i=>{let o=e.get(i.key),a=o.overlayedDocument,u=this.applyToLocalView(a,o.mutatedFields);u=t.has(i.key)?null:u;let h=wf(a,u);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument(F.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),j())}isEqual(e){return this.batchId===e.batchId&&hn(this.mutations,e.mutations,(t,r)=>dd(t,r))&&hn(this.baseMutations,e.baseMutations,(t,r)=>dd(t,r))}};var Oa=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var xa=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var se,B;function Af(n){if(n===void 0)return it("GRPC error has no .code"),k.UNKNOWN;switch(n){case se.OK:return k.OK;case se.CANCELLED:return k.CANCELLED;case se.UNKNOWN:return k.UNKNOWN;case se.DEADLINE_EXCEEDED:return k.DEADLINE_EXCEEDED;case se.RESOURCE_EXHAUSTED:return k.RESOURCE_EXHAUSTED;case se.INTERNAL:return k.INTERNAL;case se.UNAVAILABLE:return k.UNAVAILABLE;case se.UNAUTHENTICATED:return k.UNAUTHENTICATED;case se.INVALID_ARGUMENT:return k.INVALID_ARGUMENT;case se.NOT_FOUND:return k.NOT_FOUND;case se.ALREADY_EXISTS:return k.ALREADY_EXISTS;case se.PERMISSION_DENIED:return k.PERMISSION_DENIED;case se.FAILED_PRECONDITION:return k.FAILED_PRECONDITION;case se.ABORTED:return k.ABORTED;case se.OUT_OF_RANGE:return k.OUT_OF_RANGE;case se.UNIMPLEMENTED:return k.UNIMPLEMENTED;case se.DATA_LOSS:return k.DATA_LOSS;default:return M()}}(B=se||(se={}))[B.OK=0]="OK",B[B.CANCELLED=1]="CANCELLED",B[B.UNKNOWN=2]="UNKNOWN",B[B.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",B[B.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",B[B.NOT_FOUND=5]="NOT_FOUND",B[B.ALREADY_EXISTS=6]="ALREADY_EXISTS",B[B.PERMISSION_DENIED=7]="PERMISSION_DENIED",B[B.UNAUTHENTICATED=16]="UNAUTHENTICATED",B[B.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",B[B.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",B[B.ABORTED=10]="ABORTED",B[B.OUT_OF_RANGE=11]="OUT_OF_RANGE",B[B.UNIMPLEMENTED=12]="UNIMPLEMENTED",B[B.INTERNAL=13]="INTERNAL",B[B.UNAVAILABLE=14]="UNAVAILABLE",B[B.DATA_LOSS=15]="DATA_LOSS";var md=null;function gv(){return new TextEncoder}var _v=new tt([4294967295,4294967295],0);function gd(n){let e=gv().encode(n),t=new Jo;return t.update(e),new Uint8Array(t.digest())}function _d(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new tt([t,r],0),new tt([i,o],0)]}var Va=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Ut(`Invalid padding: ${t}`);if(r<0)throw new Ut(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ut(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Ut(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=tt.fromNumber(this.Ee)}Ae(e,t,r){let i=e.add(t.multiply(tt.fromNumber(r)));return i.compare(_v)===1&&(i=new tt([i.getBits(0),i.getBits(1)],0)),i.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;let t=gd(e),[r,i]=_d(t);for(let o=0;o<this.hashCount;o++){let a=this.Ae(r,i,o);if(!this.Re(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new n(o,i,t);return r.forEach(u=>a.insert(u)),a}insert(e){if(this.Ee===0)return;let t=gd(e),[r,i]=_d(t);for(let o=0;o<this.hashCount;o++){let a=this.Ae(r,i,o);this.Ve(a)}}Ve(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Ut=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Bi=class n{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,yr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(F.min(),i,new ie(q),vt(),j())}},yr=class n{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,j(),j(),j())}};var on=class{constructor(e,t,r,i){this.me=e,this.removedTargetIds=t,this.key=r,this.fe=i}},qi=class{constructor(e,t){this.targetId=e,this.ge=t}},$i=class{constructor(e,t,r=Ie.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},ji=class{constructor(){this.pe=0,this.ye=yd(),this.we=Ie.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=j(),t=j(),r=j();return this.ye.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:M()}}),new yr(this.we,this.Se,e,t,r)}Me(){this.be=!1,this.ye=yd()}xe(e,t){this.be=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,te(this.pe>=0)}Le(){this.be=!0,this.Se=!0}},La=class{constructor(e){this.ke=e,this.qe=new Map,this.Qe=vt(),this.$e=Si(),this.Ke=Si(),this.Ue=new ie(q)}We(e){for(let t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(let t of e.removedTargetIds)this.ze(t,e.key,e.fe)}je(e){this.forEachTarget(e,t=>{let r=this.He(t);switch(e.state){case 0:this.Je(t)&&r.Ce(e.resumeToken);break;case 1:r.Be(),r.De||r.Me(),r.Ce(e.resumeToken);break;case 2:r.Be(),r.De||this.removeTarget(t);break;case 3:this.Je(t)&&(r.Le(),r.Ce(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),r.Ce(e.resumeToken));break;default:M()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach((r,i)=>{this.Je(i)&&t(i)})}Ze(e){let t=e.targetId,r=e.ge.count,i=this.Xe(t);if(i){let o=i.target;if(Ca(o))if(r===0){let a=new L(o.path);this.ze(t,a,Me.newNoDocument(a,F.min()))}else te(r===1);else{let a=this.et(t);if(a!==r){let u=this.tt(e),h=u?this.nt(u,e,a):1;if(h!==0){this.Ye(t);let f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(t,f)}md?.rt(function(m,I,S,R,O){var V,N,G,H,z,X;let ve={localCacheCount:m,existenceFilterCount:I.count,databaseId:S.database,projectId:S.projectId},Q=I.unchangedNames;return Q&&(ve.bloomFilter={applied:O===0,hashCount:(V=Q?.hashCount)!==null&&V!==void 0?V:0,bitmapLength:(H=(G=(N=Q?.bits)===null||N===void 0?void 0:N.bitmap)===null||G===void 0?void 0:G.length)!==null&&H!==void 0?H:0,padding:(X=(z=Q?.bits)===null||z===void 0?void 0:z.padding)!==null&&X!==void 0?X:0,mightContain:v=>{var p;return(p=R?.mightContain(v))!==null&&p!==void 0&&p}}),ve}(a,e.ge,this.ke.it(),u,h))}}}}tt(e){let t=e.ge.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t,a,u;try{a=ot(r).toUint8Array()}catch(h){if(h instanceof Li)return ln("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new Va(a,i,o)}catch(h){return ln(h instanceof Ut?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.Ee===0?null:u}nt(e,t,r){return t.ge.count===r-this.st(e,t.targetId)?0:2}st(e,t){let r=this.ke.getRemoteKeysForTarget(t),i=0;return r.forEach(o=>{let a=this.ke.it(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.ze(t,o,null),i++)}),i}ot(e){let t=new Map;this.qe.forEach((o,a)=>{let u=this.Xe(a);if(u){if(o.current&&Ca(u.target)){let h=new L(u.target.path);this._t(h).has(a)||this.ut(a,h)||this.ze(a,h,Me.newNoDocument(h,e))}o.ve&&(t.set(a,o.Fe()),o.Me())}});let r=j();this.Ke.forEach((o,a)=>{let u=!0;a.forEachWhile(h=>{let f=this.Xe(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(o))}),this.Qe.forEach((o,a)=>a.setReadTime(e));let i=new Bi(e,t,this.Ue,this.Qe,r);return this.Qe=vt(),this.$e=Si(),this.Ke=Si(),this.Ue=new ie(q),i}Ge(e,t){if(!this.Je(e))return;let r=this.ut(e,t.key)?2:0;this.He(e).xe(t.key,r),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ke=this.Ke.insert(t.key,this.ct(t.key).add(e))}ze(e,t,r){if(!this.Je(e))return;let i=this.He(e);this.ut(e,t)?i.xe(t,1):i.Oe(t),this.Ke=this.Ke.insert(t,this.ct(t).delete(e)),this.Ke=this.Ke.insert(t,this.ct(t).add(e)),r&&(this.Qe=this.Qe.insert(t,r))}removeTarget(e){this.qe.delete(e)}et(e){let t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new ji,this.qe.set(e,t)),t}ct(e){let t=this.Ke.get(e);return t||(t=new le(q),this.Ke=this.Ke.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new le(q),this.$e=this.$e.insert(e,t)),t}Je(e){let t=this.Xe(e)!==null;return t||D("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){let t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new ji),this.ke.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}};function Si(){return new ie(L.comparator)}function yd(){return new ie(L.comparator)}var yv={asc:"ASCENDING",desc:"DESCENDING"},Iv={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vv={and:"AND",or:"OR"},Ma=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Fa(n,e){return n.useProto3Json||cs(e)?e:{value:e}}function Ev(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function wv(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function an(n){return te(!!n),F.fromTimestamp(function(t){let r=st(t);return new De(r.seconds,r.nanos)}(n))}function Tv(n,e){return Ua(n,e).canonicalString()}function Ua(n,e){let t=function(i){return new ae(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function bf(n){let e=ae.fromString(n);return te(kf(e)),e}function ia(n,e){let t=bf(e);if(t.get(1)!==n.databaseId.projectId)throw new x(k.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new x(k.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(Rf(t))}function Sf(n,e){return Tv(n.databaseId,e)}function Av(n){let e=bf(n);return e.length===4?ae.emptyPath():Rf(e)}function Id(n){return new ae(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Rf(n){return te(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function bv(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:M()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(f,m){return f.useProto3Json?(te(m===void 0||typeof m=="string"),Ie.fromBase64String(m||"")):(te(m===void 0||m instanceof Buffer||m instanceof Uint8Array),Ie.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(f){let m=f.code===void 0?k.UNKNOWN:Af(f.code);return new x(m,f.message||"")}(a);t=new $i(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=ia(n,r.document.name),o=an(r.document.updateTime),a=r.document.createTime?an(r.document.createTime):F.min(),u=new rt({mapValue:{fields:r.document.fields}}),h=Me.newFoundDocument(i,o,a,u),f=r.targetIds||[],m=r.removedTargetIds||[];t=new on(f,m,h.key,h)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=ia(n,r.document),o=r.readTime?an(r.readTime):F.min(),a=Me.newNoDocument(i,o),u=r.removedTargetIds||[];t=new on([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=ia(n,r.document),o=r.removedTargetIds||[];t=new on([],o,i,null)}else{if(!("filter"in e))return M();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:o}=r,a=new xa(i,o),u=r.targetId;t=new qi(u,a)}}return t}function Sv(n,e){return{documents:[Sf(n,e.path)]}}function Rv(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Sf(n,i);let o=function(f){if(f.length!==0)return Cf(ze.create(f,"and"))}(e.filters);o&&(t.structuredQuery.where=o);let a=function(f){if(f.length!==0)return f.map(m=>function(S){return{field:nn(S.field),direction:kv(S.dir)}}(m))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=Fa(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(f){return{before:f.inclusive,values:f.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(e.endAt)),{ht:t,parent:i}}function Pv(n){let e=Av(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){te(r===1);let m=t.from[0];m.allDescendants?i=m.collectionId:e=e.child(m.collectionId)}let o=[];t.where&&(o=function(I){let S=Pf(I);return S instanceof ze&&hf(S)?S.getFilters():[S]}(t.where));let a=[];t.orderBy&&(a=function(I){return I.map(S=>function(O){return new mn(rn(O.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(O.direction))}(S))}(t.orderBy));let u=null;t.limit&&(u=function(I){let S;return S=typeof I=="object"?I.value:I,cs(S)?null:S}(t.limit));let h=null;t.startAt&&(h=function(I){let S=!!I.before,R=I.values||[];return new pn(R,S)}(t.startAt));let f=null;return t.endAt&&(f=function(I){let S=!I.before,R=I.values||[];return new pn(R,S)}(t.endAt)),ZI(e,i,a,o,u,"F",h,f)}function Cv(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Pf(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=rn(t.unaryFilter.field);return ce.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=rn(t.unaryFilter.field);return ce.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=rn(t.unaryFilter.field);return ce.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=rn(t.unaryFilter.field);return ce.create(a,"!=",{nullValue:"NULL_VALUE"});default:return M()}}(n):n.fieldFilter!==void 0?function(t){return ce.create(rn(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return M()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ze.create(t.compositeFilter.filters.map(r=>Pf(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return M()}}(t.compositeFilter.op))}(n):M()}function kv(n){return yv[n]}function Dv(n){return Iv[n]}function Nv(n){return vv[n]}function nn(n){return{fieldPath:n.canonicalString()}}function rn(n){return Le.fromServerFormat(n.fieldPath)}function Cf(n){return n instanceof ce?function(t){if(t.op==="=="){if(od(t.value))return{unaryFilter:{field:nn(t.field),op:"IS_NAN"}};if(sd(t.value))return{unaryFilter:{field:nn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(od(t.value))return{unaryFilter:{field:nn(t.field),op:"IS_NOT_NAN"}};if(sd(t.value))return{unaryFilter:{field:nn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:nn(t.field),op:Dv(t.op),value:t.value}}}(n):n instanceof ze?function(t){let r=t.getFilters().map(i=>Cf(i));return r.length===1?r[0]:{compositeFilter:{op:Nv(t.op),filters:r}}}(n):M()}function kf(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ir=class n{constructor(e,t,r,i,o=F.min(),a=F.min(),u=Ie.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Ba=class{constructor(e){this.Tt=e}};function Ov(n){let e=Pv({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ka(e,e.limit,"L"):e}var zi=class{constructor(){}At(e,t){this.Rt(e,t),t.Vt()}Rt(e,t){if("nullValue"in e)this.ft(t,5);else if("booleanValue"in e)this.ft(t,10),t.gt(e.booleanValue?1:0);else if("integerValue"in e)this.ft(t,15),t.gt(ee(e.integerValue));else if("doubleValue"in e){let r=ee(e.doubleValue);isNaN(r)?this.ft(t,13):(this.ft(t,15),xi(r)?t.gt(0):t.gt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.ft(t,20),typeof r=="string"&&(r=st(r)),t.yt(`${r.seconds||""}`),t.gt(r.nanos||0)}else if("stringValue"in e)this.wt(e.stringValue,t),this.St(t);else if("bytesValue"in e)this.ft(t,30),t.bt(ot(e.bytesValue)),this.St(t);else if("referenceValue"in e)this.Dt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.ft(t,45),t.gt(r.latitude||0),t.gt(r.longitude||0)}else"mapValue"in e?uf(e)?this.ft(t,Number.MAX_SAFE_INTEGER):cf(e)?this.vt(e.mapValue,t):(this.Ct(e.mapValue,t),this.St(t)):"arrayValue"in e?(this.Ft(e.arrayValue,t),this.St(t)):M()}wt(e,t){this.ft(t,25),this.Mt(e,t)}Mt(e,t){t.yt(e)}Ct(e,t){let r=e.fields||{};this.ft(t,55);for(let i of Object.keys(r))this.wt(i,t),this.Rt(r[i],t)}vt(e,t){var r,i;let o=e.fields||{};this.ft(t,53);let a=dr,u=((i=(r=o[a].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.ft(t,15),t.gt(ee(u)),this.wt(a,t),this.Rt(o[a],t)}Ft(e,t){let r=e.values||[];this.ft(t,50);for(let i of r)this.Rt(i,t)}Dt(e,t){this.ft(t,37),L.fromName(e).path.forEach(r=>{this.ft(t,60),this.Mt(r,t)})}ft(e,t){e.gt(t)}St(e){e.gt(2)}};zi.xt=new zi;var qa=class{constructor(){this.Tn=new $a}addToCollectionParentIndex(e,t){return this.Tn.add(t),P.resolve()}getCollectionParents(e,t){return P.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return P.resolve()}deleteFieldIndex(e,t){return P.resolve()}deleteAllFieldIndexes(e){return P.resolve()}createTargetIndexes(e,t){return P.resolve()}getDocumentsMatchingTarget(e,t){return P.resolve(null)}getIndexType(e,t){return P.resolve(0)}getFieldIndexes(e,t){return P.resolve([])}getNextCollectionGroupToUpdate(e){return P.resolve(null)}getMinOffset(e,t){return P.resolve($t.min())}getMinOffsetFromCollectionGroup(e,t){return P.resolve($t.min())}updateCollectionGroup(e,t,r){return P.resolve()}updateIndexEntries(e,t){return P.resolve()}},$a=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new le(ae.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new le(ae.comparator)).toArray()}};var ub=new Uint8Array(0);var vd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Df=41943040,ke=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};ke.DEFAULT_COLLECTION_PERCENTILE=10,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ke.DEFAULT=new ke(Df,ke.DEFAULT_COLLECTION_PERCENTILE,ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ke.DISABLED=new ke(-1,0,0);var vr=class n{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Kn(){return new n(0)}static Un(){return new n(-1)}};var Ed="LruGarbageCollector",xv=1048576;function wd([n,e],[t,r]){let i=q(n,t);return i===0?q(e,r):i}var ja=class{constructor(e){this.Hn=e,this.buffer=new le(wd),this.Jn=0}Yn(){return++this.Jn}Zn(e){let t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();wd(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},za=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){D(Ed,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>T(this,null,function*(){this.Xn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){An(t)?D(Ed,"Ignoring IndexedDB error during garbage collection: ",t):yield as(t)}yield this.er(3e5)}))}},Wa=class{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return P.resolve(qc.ae);let r=new ja(t);return this.tr.forEachTarget(e,i=>r.Zn(i.sequenceNumber)).next(()=>this.tr.rr(e,i=>r.Zn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.tr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(D("LruGarbageCollector","Garbage collection skipped; disabled"),P.resolve(vd)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vd):this.ir(e,t))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,t){let r,i,o,a,u,h,f,m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),i=this.params.maximumSequenceNumbersToCollect):i=I,a=Date.now(),this.nthSequenceNumber(e,i))).next(I=>(r=I,u=Date.now(),this.removeTargets(e,r,t))).next(I=>(o=I,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(I=>(f=Date.now(),en()<=U.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-m}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${I} documents in `+(f-h)+`ms
Total Duration: ${f-m}ms`),P.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:I})))}};function Vv(n,e){return new Wa(n,e)}var Ga=class{constructor(){this.changes=new at(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Me.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?P.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Ka=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Ha=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&ur(r.mutation,i,Mt.empty(),De.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,j()).next(()=>r))}getLocalViewOfDocuments(e,t,r=j()){let i=Ft();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let a=ir();return o.forEach((u,h)=>{a=a.insert(u,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=Ft();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,j()))}populateOverlays(e,t,r){let i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,r,i){let o=vt(),a=ar(),u=function(){return ar()}();return t.forEach((h,f)=>{let m=r.get(f.key);i.has(f.key)&&(m===void 0||m.mutation instanceof vn)?o=o.insert(f.key,f):m!==void 0?(a.set(f.key,m.mutation.getFieldMask()),ur(m.mutation,f,m.mutation.getFieldMask(),De.now())):a.set(f.key,Mt.empty())}),this.recalculateAndSaveOverlays(e,o).next(h=>(h.forEach((f,m)=>a.set(f,m)),t.forEach((f,m)=>{var I;return u.set(f,new Ka(m,(I=a.get(f))!==null&&I!==void 0?I:null))}),u))}recalculateAndSaveOverlays(e,t){let r=ar(),i=new ie((a,u)=>a-u),o=j();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(h=>{let f=t.get(h);if(f===null)return;let m=r.get(h)||Mt.empty();m=u.applyToLocalView(f,m),r.set(h,m);let I=(i.get(u.batchId)||j()).add(h);i=i.insert(u.batchId,I)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let h=u.getNext(),f=h.key,m=h.value,I=yf();m.forEach(S=>{if(!o.has(S)){let R=wf(t.get(S),r.get(S));R!==null&&I.set(S,R),o=o.add(S)}}),a.push(this.documentOverlayCache.saveOverlays(e,f,I))}return P.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return L.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ev(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{let a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):P.resolve(Ft()),u=lr,h=o;return a.next(f=>P.forEach(f,(m,I)=>(u<I.largestBatchId&&(u=I.largestBatchId),o.get(m)?P.resolve():this.remoteDocumentCache.getEntry(e,m).next(S=>{h=h.insert(m,S)}))).next(()=>this.populateOverlays(e,f,o)).next(()=>this.computeViews(e,h,f,j())).next(m=>({batchId:u,changes:sv(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(r=>{let i=ir();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let o=t.collectionGroup,a=ir();return this.indexManager.getCollectionParents(e,o).next(u=>P.forEach(u,h=>{let f=function(I,S){return new gn(S,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next(m=>{m.forEach((I,S)=>{a=a.insert(I,S)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(a=>{o.forEach((h,f)=>{let m=f.getKey();a.get(m)===null&&(a=a.insert(m,Me.newInvalidDocument(m)))});let u=ir();return a.forEach((h,f)=>{let m=o.get(h);m!==void 0&&ur(m.mutation,f,Mt.empty(),De.now()),hs(t,f)&&(u=u.insert(h,f))}),u})}};var Qa=class{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return P.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:an(i.createTime)}}(t)),P.resolve()}getNamedQuery(e,t){return P.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,function(i){return{name:i.name,query:Ov(i.bundledQuery),readTime:an(i.readTime)}}(t)),P.resolve()}};var Ya=class{constructor(){this.overlays=new ie(L.comparator),this.Rr=new Map}getOverlay(e,t){return P.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Ft();return P.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.Et(e,t,o)}),P.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.Rr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.Rr.delete(r)),P.resolve()}getOverlaysForCollection(e,t,r){let i=Ft(),o=t.length+1,a=new L(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let h=u.getNext().value,f=h.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&i.set(h.getKey(),h)}return P.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new ie((f,m)=>f-m),a=this.overlays.getIterator();for(;a.hasNext();){let f=a.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let m=o.get(f.largestBatchId);m===null&&(m=Ft(),o=o.insert(f.largestBatchId,m)),m.set(f.getKey(),f)}}let u=Ft(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,m)=>u.set(f,m)),!(u.size()>=i)););return P.resolve(u)}Et(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.Rr.get(i.largestBatchId).delete(r.key);this.Rr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Oa(t,r));let o=this.Rr.get(t);o===void 0&&(o=j(),this.Rr.set(t,o)),this.Rr.set(t,o.add(r.key))}};var Ja=class{constructor(){this.sessionToken=Ie.EMPTY_BYTE_STRING}getSessionToken(e){return P.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,P.resolve()}};var Er=class{constructor(){this.Vr=new le(oe.mr),this.gr=new le(oe.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){let r=new oe(e,t);this.Vr=this.Vr.add(r),this.gr=this.gr.add(r)}yr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.wr(new oe(e,t))}Sr(e,t){e.forEach(r=>this.removeReference(r,t))}br(e){let t=new L(new ae([])),r=new oe(t,e),i=new oe(t,e+1),o=[];return this.gr.forEachInRange([r,i],a=>{this.wr(a),o.push(a.key)}),o}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){let t=new L(new ae([])),r=new oe(t,e),i=new oe(t,e+1),o=j();return this.gr.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(e){let t=new oe(e,0),r=this.Vr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},oe=class{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return L.comparator(e.key,t.key)||q(e.Cr,t.Cr)}static pr(e,t){return q(e.Cr,t.Cr)||L.comparator(e.key,t.key)}};var Xa=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new le(oe.mr)}checkEmpty(e){return P.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let o=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Na(o,t,r,i);this.mutationQueue.push(a);for(let u of i)this.Mr=this.Mr.add(new oe(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return P.resolve(a)}lookupMutationBatch(e,t){return P.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Nr(r),o=i<0?0:i;return P.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return P.resolve(this.mutationQueue.length===0?LI:this.Fr-1)}getAllMutationBatches(e){return P.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new oe(t,0),i=new oe(t,Number.POSITIVE_INFINITY),o=[];return this.Mr.forEachInRange([r,i],a=>{let u=this.Or(a.Cr);o.push(u)}),P.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new le(q);return t.forEach(i=>{let o=new oe(i,0),a=new oe(i,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([o,a],u=>{r=r.add(u.Cr)})}),P.resolve(this.Br(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,o=r;L.isDocumentKey(o)||(o=o.child(""));let a=new oe(new L(o),0),u=new le(q);return this.Mr.forEachWhile(h=>{let f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(u=u.add(h.Cr)),!0)},a),P.resolve(this.Br(u))}Br(e){let t=[];return e.forEach(r=>{let i=this.Or(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){te(this.Lr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.Mr;return P.forEach(t.mutations,i=>{let o=new oe(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Mr=r})}qn(e){}containsKey(e,t){let r=new oe(t,0),i=this.Mr.firstAfterOrEqual(r);return P.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,P.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){let t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Za=class{constructor(e){this.kr=e,this.docs=function(){return new ie(L.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.kr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return P.resolve(r?r.document.mutableCopy():Me.newInvalidDocument(t))}getEntries(e,t){let r=vt();return t.forEach(i=>{let o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():Me.newInvalidDocument(i))}),P.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=vt(),a=t.path,u=new L(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){let{key:f,value:{document:m}}=h.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||OI(NI(m),r)<=0||(i.has(m.key)||hs(t,m))&&(o=o.insert(m.key,m.mutableCopy()))}return P.resolve(o)}getAllFromCollectionGroup(e,t,r,i){M()}qr(e,t){return P.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new ec(this)}getSize(e){return P.resolve(this.size)}},ec=class extends Ga{constructor(e){super(),this.Ir=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Ir.addEntry(e,i)):this.Ir.removeEntry(r)}),P.waitFor(t)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}};var tc=class{constructor(e){this.persistence=e,this.Qr=new at(t=>zc(t),Wc),this.lastRemoteSnapshotVersion=F.min(),this.highestTargetId=0,this.$r=0,this.Kr=new Er,this.targetCount=0,this.Ur=vr.Kn()}forEachTarget(e,t){return this.Qr.forEach((r,i)=>t(i)),P.resolve()}getLastRemoteSnapshotVersion(e){return P.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return P.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Ur.next(),P.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.$r&&(this.$r=t),P.resolve()}zn(e){this.Qr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Ur=new vr(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,P.resolve()}updateTargetData(e,t){return this.zn(t),P.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Kr.br(t.targetId),this.targetCount-=1,P.resolve()}removeTargets(e,t,r){let i=0,o=[];return this.Qr.forEach((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.Qr.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),P.waitFor(o).next(()=>i)}getTargetCount(e){return P.resolve(this.targetCount)}getTargetData(e,t){let r=this.Qr.get(t)||null;return P.resolve(r)}addMatchingKeys(e,t,r){return this.Kr.yr(t,r),P.resolve()}removeMatchingKeys(e,t,r){this.Kr.Sr(t,r);let i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),P.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.Kr.br(t),P.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Kr.vr(t);return P.resolve(r)}containsKey(e,t){return P.resolve(this.Kr.containsKey(t))}};var Wi=class{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new qc(0),this.zr=!1,this.zr=!0,this.jr=new Ja,this.referenceDelegate=e(this),this.Hr=new tc(this),this.indexManager=new qa,this.remoteDocumentCache=function(i){return new Za(i)}(r=>this.referenceDelegate.Jr(r)),this.serializer=new Ba(t),this.Yr=new Qa(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ya,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Wr[e.toKey()];return r||(r=new Xa(t,this.referenceDelegate),this.Wr[e.toKey()]=r),r}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,r){D("MemoryPersistence","Starting transaction:",e);let i=new nc(this.Gr.next());return this.referenceDelegate.Zr(),r(i).next(o=>this.referenceDelegate.Xr(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}ei(e,t){return P.or(Object.values(this.Wr).map(r=>()=>r.containsKey(e,t)))}},nc=class extends ga{constructor(e){super(),this.currentSequenceNumber=e}},rc=class n{constructor(e){this.persistence=e,this.ti=new Er,this.ni=null}static ri(e){return new n(e)}get ii(){if(this.ni)return this.ni;throw M()}addReference(e,t,r){return this.ti.addReference(r,t),this.ii.delete(r.toString()),P.resolve()}removeReference(e,t,r){return this.ti.removeReference(r,t),this.ii.add(r.toString()),P.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),P.resolve()}removeTarget(e,t){this.ti.br(t.targetId).forEach(i=>this.ii.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.ii.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}Zr(){this.ni=new Set}Xr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return P.forEach(this.ii,r=>{let i=L.fromPath(r);return this.si(e,i).next(o=>{o||t.removeEntry(i,F.min())})}).next(()=>(this.ni=null,t.apply(e)))}updateLimboDocument(e,t){return this.si(e,t).next(r=>{r?this.ii.delete(t.toString()):this.ii.add(t.toString())})}Jr(e){return 0}si(e,t){return P.or([()=>P.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}},Gi=class n{constructor(e,t){this.persistence=e,this.oi=new at(r=>MI(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=Vv(this,t)}static ri(e,t){return new n(e,t)}Zr(){}Xr(e){return P.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){let t=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}sr(e){let t=0;return this.rr(e,r=>{t++}).next(()=>t)}rr(e,t){return P.forEach(this.oi,(r,i)=>this.ar(e,r,i).next(o=>o?P.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.qr(e,a=>this.ar(e,a,t).next(u=>{u||(r++,o.removeEntry(a,F.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),P.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.oi.set(r,e.currentSequenceNumber),P.resolve()}removeReference(e,t,r){return this.oi.set(r,e.currentSequenceNumber),P.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),P.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Pi(e.data.value)),t}ar(e,t,r){return P.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.oi.get(t);return P.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var ic=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Hi=r,this.Ji=i}static Yi(e,t){let r=j(),i=j();for(let o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new n(e,t.fromCache,r,i)}};var sc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var oc=class{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return wl()?8:VI(Se())>0?6:4}()}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(e,t,r,i){let o={result:null};return this.rs(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.ss(e,t,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;let a=new sc;return this._s(e,t,a).next(u=>{if(o.result=u,this.Xi)return this.us(e,t,a,u.size)})}).next(()=>o.result)}us(e,t,r,i){return r.documentReadCount<this.es?(en()<=U.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",tn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),P.resolve()):(en()<=U.DEBUG&&D("QueryEngine","Query:",tn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ts*i?(en()<=U.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",tn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,$e(t))):P.resolve())}rs(e,t){if(ld(t))return P.resolve(null);let r=$e(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=ka(t,null,"F"),r=$e(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{let a=j(...o);return this.ns.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,r).next(h=>{let f=this.cs(t,u);return this.ls(t,f,a,h.readTime)?this.rs(e,ka(t,null,"F")):this.hs(e,f,t,h)}))})))}ss(e,t,r,i){return ld(t)||i.isEqual(F.min())?P.resolve(null):this.ns.getDocuments(e,r).next(o=>{let a=this.cs(t,o);return this.ls(t,a,r,i)?P.resolve(null):(en()<=U.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),tn(t)),this.hs(e,a,t,DI(i,lr)).next(u=>u))})}cs(e,t){let r=new le(gf(e));return t.forEach((i,o)=>{hs(e,o)&&(r=r.add(o))}),r}ls(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}_s(e,t,r){return en()<=U.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",tn(t)),this.ns.getDocumentsMatchingQuery(e,t,$t.min(),r)}hs(e,t,r,i){return this.ns.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}};var Kc="LocalStore",Lv=3e8,ac=class{constructor(e,t,r,i){this.persistence=e,this.Ps=t,this.serializer=i,this.Ts=new ie(q),this.Is=new at(o=>zc(o),Wc),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(r)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ha(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ts))}};function Mv(n,e,t,r){return new ac(n,e,t,r)}function Nf(n,e){return T(this,null,function*(){let t=$(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.As(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],u=[],h=j();for(let f of i){a.push(f.batchId);for(let m of f.mutations)h=h.add(m.key)}for(let f of o){u.push(f.batchId);for(let m of f.mutations)h=h.add(m.key)}return t.localDocuments.getDocuments(r,h).next(f=>({Rs:f,removedBatchIds:a,addedBatchIds:u}))})})})}function Of(n){let e=$(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Hr.getLastRemoteSnapshotVersion(t))}function Fv(n,e){let t=$(n),r=e.snapshotVersion,i=t.Ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let a=t.ds.newChangeBuffer({trackRemovals:!0});i=t.Ts;let u=[];e.targetChanges.forEach((m,I)=>{let S=i.get(I);if(!S)return;u.push(t.Hr.removeMatchingKeys(o,m.removedDocuments,I).next(()=>t.Hr.addMatchingKeys(o,m.addedDocuments,I)));let R=S.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(I)!==null?R=R.withResumeToken(Ie.EMPTY_BYTE_STRING,F.min()).withLastLimboFreeSnapshotVersion(F.min()):m.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(m.resumeToken,r)),i=i.insert(I,R),function(V,N,G){return V.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=Lv?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0}(S,R,m)&&u.push(t.Hr.updateTargetData(o,R))});let h=vt(),f=j();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,m))}),u.push(Uv(o,a,e.documentUpdates).next(m=>{h=m.Vs,f=m.fs})),!r.isEqual(F.min())){let m=t.Hr.getLastRemoteSnapshotVersion(o).next(I=>t.Hr.setTargetsMetadata(o,o.currentSequenceNumber,r));u.push(m)}return P.waitFor(u).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,h,f)).next(()=>h)}).then(o=>(t.Ts=i,o))}function Uv(n,e,t){let r=j(),i=j();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=vt();return t.forEach((u,h)=>{let f=o.get(u);h.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(u)),h.isNoDocument()&&h.version.isEqual(F.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):D(Kc,"Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",h.version)}),{Vs:a,fs:i}})}function Bv(n,e){let t=$(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Hr.getTargetData(r,e).next(o=>o?(i=o,P.resolve(i)):t.Hr.allocateTargetId(r).next(a=>(i=new Ir(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Hr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ts=t.Ts.insert(r.targetId,r),t.Is.set(e,r.targetId)),r})}function cc(n,e,t){return T(this,null,function*(){let r=$(n),i=r.Ts.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!An(a))throw a;D(Kc,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ts=r.Ts.remove(e),r.Is.delete(i.target)})}function Td(n,e,t){let r=$(n),i=F.min(),o=j();return r.persistence.runTransaction("Execute query","readwrite",a=>function(h,f,m){let I=$(h),S=I.Is.get(m);return S!==void 0?P.resolve(I.Ts.get(S)):I.Hr.getTargetData(f,m)}(r,a,$e(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Hr.getMatchingKeysForTargetId(a,u.targetId).next(h=>{o=h})}).next(()=>r.Ps.getDocumentsMatchingQuery(a,e,t?i:F.min(),t?o:j())).next(u=>(qv(r,nv(e),u),{documents:u,gs:o})))}function qv(n,e,t){let r=n.Es.get(e)||F.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Es.set(e,r)}var Ki=class{constructor(){this.activeTargetIds=cv()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var uc=class{constructor(){this.ho=new Ki,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,r){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new Ki,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var lc=class{To(e){}shutdown(){}};var Ad="ConnectivityMonitor",Hi=class{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){D(Ad,"Network connectivity changed: AVAILABLE");for(let e of this.Vo)e(0)}Ro(){D(Ad,"Network connectivity changed: UNAVAILABLE");for(let e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ri=null;function hc(){return Ri===null?Ri=function(){return 268435456+Math.round(2147483648*Math.random())}():Ri++,"0x"+Ri.toString(16)}var sa="RestConnection",$v={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},dc=class{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${r}/databases/${i}`,this.wo=this.databaseId.database===Mi?`project_id=${r}`:`project_id=${r}&database_id=${i}`}So(e,t,r,i,o){let a=hc(),u=this.bo(e,t.toUriEncodedString());D(sa,`Sending RPC '${e}' ${a}:`,u,r);let h={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(h,i,o),this.vo(e,u,h,r).then(f=>(D(sa,`Received RPC '${e}' ${a}: `,f),f),f=>{throw ln(sa,`RPC '${e}' ${a} failed with error: `,f,"url: ",u,"request:",r),f})}Co(e,t,r,i,o,a){return this.So(e,t,r,i,o)}Do(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Tn}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}bo(e,t){let r=$v[e];return`${this.po}/v1/${t}:${r}`}terminate(){}};var fc=class{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Ko(e){this.ko(e)}Uo(e){this.qo(e)}};var ye="WebChannelConnection",pc=class extends dc{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,r,i){let o=hc();return new Promise((a,u)=>{let h=new Xo;h.setWithCredentials(!0),h.listenOnce(Zo.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case rr.NO_ERROR:let m=h.getResponseJson();D(ye,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(m)),a(m);break;case rr.TIMEOUT:D(ye,`RPC '${e}' ${o} timed out`),u(new x(k.DEADLINE_EXCEEDED,"Request time out"));break;case rr.HTTP_ERROR:let I=h.getStatus();if(D(ye,`RPC '${e}' ${o} failed with status:`,I,"response text:",h.getResponseText()),I>0){let S=h.getResponseJson();Array.isArray(S)&&(S=S[0]);let R=S?.error;if(R&&R.status&&R.message){let O=function(N){let G=N.toLowerCase().replace(/_/g,"-");return Object.values(k).indexOf(G)>=0?G:k.UNKNOWN}(R.status);u(new x(O,R.message))}else u(new x(k.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new x(k.UNAVAILABLE,"Connection failed."));break;default:M()}}finally{D(ye,`RPC '${e}' ${o} completed.`)}});let f=JSON.stringify(i);D(ye,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",f,r,15)})}Wo(e,t,r){let i=hc(),o=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=na(),u=ta(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.Do(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;let m=o.join("");D(ye,`Creating RPC '${e}' stream ${i}: ${m}`,h);let I=a.createWebChannel(m,h),S=!1,R=!1,O=new fc({Fo:N=>{R?D(ye,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(S||(D(ye,`Opening RPC '${e}' stream ${i} transport.`),I.open(),S=!0),D(ye,`RPC '${e}' stream ${i} sending:`,N),I.send(N))},Mo:()=>I.close()}),V=(N,G,H)=>{N.listen(G,z=>{try{H(z)}catch(X){setTimeout(()=>{throw X},0)}})};return V(I,Zt.EventType.OPEN,()=>{R||(D(ye,`RPC '${e}' stream ${i} transport opened.`),O.Qo())}),V(I,Zt.EventType.CLOSE,()=>{R||(R=!0,D(ye,`RPC '${e}' stream ${i} transport closed`),O.Ko())}),V(I,Zt.EventType.ERROR,N=>{R||(R=!0,ln(ye,`RPC '${e}' stream ${i} transport errored:`,N),O.Ko(new x(k.UNAVAILABLE,"The operation could not be completed")))}),V(I,Zt.EventType.MESSAGE,N=>{var G;if(!R){let H=N.data[0];te(!!H);let z=H,X=z?.error||((G=z[0])===null||G===void 0?void 0:G.error);if(X){D(ye,`RPC '${e}' stream ${i} received error:`,X);let ve=X.status,Q=function(_){let y=se[_];if(y!==void 0)return Af(y)}(ve),v=X.message;Q===void 0&&(Q=k.INTERNAL,v="Unknown error status: "+ve+" with message "+X.message),R=!0,O.Ko(new x(Q,v)),I.close()}else D(ye,`RPC '${e}' stream ${i} received:`,H),O.Uo(H)}}),V(u,ea.STAT_EVENT,N=>{N.stat===Ai.PROXY?D(ye,`RPC '${e}' stream ${i} detected buffering proxy`):N.stat===Ai.NOPROXY&&D(ye,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{O.$o()},0),O}};function oa(){return typeof document<"u"?document:null}function xf(n){return new Ma(n,!0)}var Qi=class{constructor(e,t,r=1e3,i=1.5,o=6e4){this.Ti=e,this.timerId=t,this.Go=r,this.zo=i,this.jo=o,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();let t=Math.floor(this.Ho+this.e_()),r=Math.max(0,Date.now()-this.Yo),i=Math.max(0,t-r);i>0&&D("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,i,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}};var bd="PersistentStream",mc=class{constructor(e,t,r,i,o,a,u,h){this.Ti=e,this.n_=r,this.r_=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Qi(e,t)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}stop(){return T(this,null,function*(){this.u_()&&(yield this.close(0))})}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}T_(){return T(this,null,function*(){if(this.c_())return this.close(0)})}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}close(e,t){return T(this,null,function*(){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():t&&t.code===k.RESOURCE_EXHAUSTED?(it(t.toString()),it("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===k.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.Lo(t)})}A_(){}auth(){this.state=1;let e=this.R_(this.i_),t=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.i_===t&&this.V_(r,i)},r=>{e(()=>{let i=new x(k.UNKNOWN,"Fetching auth token failed: "+r.message);return this.m_(i)})})}V_(e,t){let r=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo(()=>{r(()=>this.listener.xo())}),this.stream.No(()=>{r(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(i=>{r(()=>this.m_(i))}),this.stream.onMessage(i=>{r(()=>++this.__==1?this.g_(i):this.onNext(i))})}l_(){this.state=5,this.a_.Xo(()=>T(this,null,function*(){this.state=0,this.start()}))}m_(e){return D(bd,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return t=>{this.Ti.enqueueAndForget(()=>this.i_===e?t():(D(bd,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},gc=class extends mc{constructor(e,t,r,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();let t=bv(this.serializer,e),r=function(o){if(!("targetChange"in o))return F.min();let a=o.targetChange;return a.targetIds&&a.targetIds.length?F.min():a.readTime?an(a.readTime):F.min()}(e);return this.listener.p_(t,r)}y_(e){let t={};t.database=Id(this.serializer),t.addTarget=function(o,a){let u,h=a.target;if(u=Ca(h)?{documents:Sv(o,h)}:{query:Rv(o,h).ht},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=wv(o,a.resumeToken);let f=Fa(o,a.expectedCount);f!==null&&(u.expectedCount=f)}else if(a.snapshotVersion.compareTo(F.min())>0){u.readTime=Ev(o,a.snapshotVersion.toTimestamp());let f=Fa(o,a.expectedCount);f!==null&&(u.expectedCount=f)}return u}(this.serializer,e);let r=Cv(this.serializer,e);r&&(t.labels=r),this.I_(t)}w_(e){let t={};t.database=Id(this.serializer),t.removeTarget=e,this.I_(t)}};var _c=class{},yc=class extends _c{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.F_=!1}M_(){if(this.F_)throw new x(k.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,r,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.So(e,Ua(t,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new x(k.UNKNOWN,o.toString())})}Co(e,t,r,i,o){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Co(e,Ua(t,r),i,a,u,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(k.UNKNOWN,a.toString())})}terminate(){this.F_=!0,this.connection.terminate()}},Ic=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(it(t),this.N_=!1):D("OnlineStateTracker",t)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}};var En="RemoteStore",vc=class{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=o,this.z_.To(a=>{r.enqueueAndForget(()=>T(this,null,function*(){Sr(this)&&(D(En,"Restarting streams for network reachability change."),yield function(h){return T(this,null,function*(){let f=$(h);f.W_.add(4),yield br(f),f.j_.set("Unknown"),f.W_.delete(4),yield ds(f)})}(this))}))}),this.j_=new Ic(r,i)}};function ds(n){return T(this,null,function*(){if(Sr(n))for(let e of n.G_)yield e(!0)})}function br(n){return T(this,null,function*(){for(let e of n.G_)yield e(!1)})}function Vf(n,e){let t=$(n);t.U_.has(e.targetId)||(t.U_.set(e.targetId,e),Jc(t)?Yc(t):bn(t).c_()&&Qc(t,e))}function Hc(n,e){let t=$(n),r=bn(t);t.U_.delete(e),r.c_()&&Lf(t,e),t.U_.size===0&&(r.c_()?r.P_():Sr(t)&&t.j_.set("Unknown"))}function Qc(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(F.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}bn(n).y_(e)}function Lf(n,e){n.H_.Ne(e),bn(n).w_(e)}function Yc(n){n.H_=new La({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.U_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),bn(n).start(),n.j_.B_()}function Jc(n){return Sr(n)&&!bn(n).u_()&&n.U_.size>0}function Sr(n){return $(n).W_.size===0}function Mf(n){n.H_=void 0}function jv(n){return T(this,null,function*(){n.j_.set("Online")})}function zv(n){return T(this,null,function*(){n.U_.forEach((e,t)=>{Qc(n,e)})})}function Wv(n,e){return T(this,null,function*(){Mf(n),Jc(n)?(n.j_.q_(e),Yc(n)):n.j_.set("Unknown")})}function Gv(n,e,t){return T(this,null,function*(){if(n.j_.set("Online"),e instanceof $i&&e.state===2&&e.cause)try{yield function(i,o){return T(this,null,function*(){let a=o.cause;for(let u of o.targetIds)i.U_.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.U_.delete(u),i.H_.removeTarget(u))})}(n,e)}catch(r){D(En,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Sd(n,r)}else if(e instanceof on?n.H_.We(e):e instanceof qi?n.H_.Ze(e):n.H_.je(e),!t.isEqual(F.min()))try{let r=yield Of(n.localStore);t.compareTo(r)>=0&&(yield function(o,a){let u=o.H_.ot(a);return u.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){let m=o.U_.get(f);m&&o.U_.set(f,m.withResumeToken(h.resumeToken,a))}}),u.targetMismatches.forEach((h,f)=>{let m=o.U_.get(h);if(!m)return;o.U_.set(h,m.withResumeToken(Ie.EMPTY_BYTE_STRING,m.snapshotVersion)),Lf(o,h);let I=new Ir(m.target,h,f,m.sequenceNumber);Qc(o,I)}),o.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(r){D(En,"Failed to raise snapshot:",r),yield Sd(n,r)}})}function Sd(n,e,t){return T(this,null,function*(){if(!An(e))throw e;n.W_.add(1),yield br(n),n.j_.set("Offline"),t||(t=()=>Of(n.localStore)),n.asyncQueue.enqueueRetryable(()=>T(this,null,function*(){D(En,"Retrying IndexedDB access"),yield t(),n.W_.delete(1),yield ds(n)}))})}function Rd(n,e){return T(this,null,function*(){let t=$(n);t.asyncQueue.verifyOperationInProgress(),D(En,"RemoteStore received new credentials");let r=Sr(t);t.W_.add(3),yield br(t),r&&t.j_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.W_.delete(3),yield ds(t)})}function Kv(n,e){return T(this,null,function*(){let t=$(n);e?(t.W_.delete(2),yield ds(t)):e||(t.W_.add(2),yield br(t),t.j_.set("Unknown"))})}function bn(n){return n.J_||(n.J_=function(t,r,i){let o=$(t);return o.M_(),new gc(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)}(n.datastore,n.asyncQueue,{xo:jv.bind(null,n),No:zv.bind(null,n),Lo:Wv.bind(null,n),p_:Gv.bind(null,n)}),n.G_.push(e=>T(this,null,function*(){e?(n.J_.h_(),Jc(n)?Yc(n):n.j_.set("Unknown")):(yield n.J_.stop(),Mf(n))}))),n.J_}var Ec=class n{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new yt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){let a=Date.now()+r,u=new n(e,t,a,i,o);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(k.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Ff(n,e){if(it("AsyncQueue",`${e}: ${n}`),An(n))return new x(k.UNAVAILABLE,`${e}: ${n}`);throw n}var Yi=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||L.comparator(t.key,r.key):(t,r)=>L.comparator(t.key,r.key),this.keyedMap=ir(),this.sortedSet=new ie(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Ji=class{constructor(){this.Z_=new ie(L.comparator)}track(e){let t=e.doc.key,r=this.Z_.get(t);r?e.type!==0&&r.type===3?this.Z_=this.Z_.insert(t,e):e.type===3&&r.type!==1?this.Z_=this.Z_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Z_=this.Z_.remove(t):e.type===1&&r.type===2?this.Z_=this.Z_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):M():this.Z_=this.Z_.insert(t,e)}X_(){let e=[];return this.Z_.inorderTraversal((t,r)=>{e.push(r)}),e}},wn=class n{constructor(e,t,r,i,o,a,u,h,f){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,t,r,i,o){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new n(e,t,Yi.emptySet(t),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ls(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var wc=class{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}},Tc=class{constructor(){this.queries=Pd(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(t,r){let i=$(t),o=i.queries;i.queries=Pd(),o.forEach((a,u)=>{for(let h of u.ta)h.onError(r)})})(this,new x(k.ABORTED,"Firestore shutting down"))}};function Pd(){return new at(n=>mf(n),ls)}function Hv(n,e){return T(this,null,function*(){let t=$(n),r=3,i=e.query,o=t.queries.get(i);o?!o.na()&&e.ra()&&(r=2):(o=new wc,r=e.ra()?0:1);try{switch(r){case 0:o.ea=yield t.onListen(i,!0);break;case 1:o.ea=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let u=Ff(a,`Initialization of query '${tn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,o),o.ta.push(e),e.sa(t.onlineState),o.ea&&e.oa(o.ea)&&Xc(t)})}function Qv(n,e){return T(this,null,function*(){let t=$(n),r=e.query,i=3,o=t.queries.get(r);if(o){let a=o.ta.indexOf(e);a>=0&&(o.ta.splice(a,1),o.ta.length===0?i=e.ra()?0:1:!o.na()&&e.ra()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function Yv(n,e){let t=$(n),r=!1;for(let i of e){let o=i.query,a=t.queries.get(o);if(a){for(let u of a.ta)u.oa(i)&&(r=!0);a.ea=i}}r&&Xc(t)}function Jv(n,e,t){let r=$(n),i=r.queries.get(e);if(i)for(let o of i.ta)o.onError(t);r.queries.delete(e)}function Xc(n){n.ia.forEach(e=>{e.next()})}var Ac,Cd;(Cd=Ac||(Ac={}))._a="default",Cd.Cache="cache";var bc=class{constructor(e,t,r){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=r||{}}oa(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new wn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ua?this.la(e)&&(this.aa.next(e),t=!0):this.ha(e,this.onlineState)&&(this.Pa(e),t=!0),this.ca=e,t}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){if(!e.fromCache||!this.ra())return!0;let r=t!=="Offline";return(!this.options.Ta||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}la(e){if(e.docChanges.length>0)return!0;let t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Pa(e){e=wn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==Ac.Cache}};var Xi=class{constructor(e){this.key=e}},Zi=class{constructor(e){this.key=e}},Sc=class{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=j(),this.mutatedKeys=j(),this.ya=gf(e),this.wa=new Yi(this.ya)}get Sa(){return this.fa}ba(e,t){let r=t?t.Da:new Ji,i=t?t.wa:this.wa,o=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1,h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,f=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((m,I)=>{let S=i.get(m),R=hs(this.query,I)?I:null,O=!!S&&this.mutatedKeys.has(S.key),V=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),N=!1;S&&R?S.data.isEqual(R.data)?O!==V&&(r.track({type:3,doc:R}),N=!0):this.va(S,R)||(r.track({type:2,doc:R}),N=!0,(h&&this.ya(R,h)>0||f&&this.ya(R,f)<0)&&(u=!0)):!S&&R?(r.track({type:0,doc:R}),N=!0):S&&!R&&(r.track({type:1,doc:S}),N=!0,(h||f)&&(u=!0)),N&&(R?(a=a.add(R),o=V?o.add(m):o.delete(m)):(a=a.delete(m),o=o.delete(m)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let m=this.query.limitType==="F"?a.last():a.first();a=a.delete(m.key),o=o.delete(m.key),r.track({type:1,doc:m})}return{wa:a,Da:r,ls:u,mutatedKeys:o}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let o=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;let a=e.Da.X_();a.sort((m,I)=>function(R,O){let V=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M()}};return V(R)-V(O)}(m.type,I.type)||this.ya(m.doc,I.doc)),this.Ca(r),i=i!=null&&i;let u=t&&!i?this.Fa():[],h=this.pa.size===0&&this.current&&!i?1:0,f=h!==this.ga;return this.ga=h,a.length!==0||f?{snapshot:new wn(this.query,e.wa,o,a,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ma:u}:{Ma:u}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new Ji,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(t=>this.fa=this.fa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.fa=this.fa.delete(t)),this.current=e.current)}Fa(){if(!this.current)return[];let e=this.pa;this.pa=j(),this.wa.forEach(r=>{this.xa(r.key)&&(this.pa=this.pa.add(r.key))});let t=[];return e.forEach(r=>{this.pa.has(r)||t.push(new Zi(r))}),this.pa.forEach(r=>{e.has(r)||t.push(new Xi(r))}),t}Oa(e){this.fa=e.gs,this.pa=j();let t=this.ba(e.documents);return this.applyChanges(t,!0)}Na(){return wn.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}},Zc="SyncEngine",Rc=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},Pc=class{constructor(e){this.key=e,this.Ba=!1}},Cc=class{constructor(e,t,r,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.La={},this.ka=new at(u=>mf(u),ls),this.qa=new Map,this.Qa=new Set,this.$a=new ie(L.comparator),this.Ka=new Map,this.Ua=new Er,this.Wa={},this.Ga=new Map,this.za=vr.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}};function Xv(n,e,t=!0){return T(this,null,function*(){let r=jf(n),i,o=r.ka.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.Na()):i=yield Uf(r,e,t,!0),i})}function Zv(n,e){return T(this,null,function*(){let t=jf(n);yield Uf(t,e,!0,!1)})}function Uf(n,e,t,r){return T(this,null,function*(){let i=yield Bv(n.localStore,$e(e)),o=i.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t),u;return r&&(u=yield eE(n,e,o,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&Vf(n.remoteStore,i),u})}function eE(n,e,t,r,i){return T(this,null,function*(){n.Ha=(I,S,R)=>function(V,N,G,H){return T(this,null,function*(){let z=N.view.ba(G);z.ls&&(z=yield Td(V.localStore,N.query,!1).then(({documents:v})=>N.view.ba(v,z)));let X=H&&H.targetChanges.get(N.targetId),ve=H&&H.targetMismatches.get(N.targetId)!=null,Q=N.view.applyChanges(z,V.isPrimaryClient,X,ve);return Dd(V,N.targetId,Q.Ma),Q.snapshot})}(n,I,S,R);let o=yield Td(n.localStore,e,!0),a=new Sc(e,o.gs),u=a.ba(o.documents),h=yr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),f=a.applyChanges(u,n.isPrimaryClient,h);Dd(n,t,f.Ma);let m=new Rc(e,t,a);return n.ka.set(e,m),n.qa.has(t)?n.qa.get(t).push(e):n.qa.set(t,[e]),f.snapshot})}function tE(n,e,t){return T(this,null,function*(){let r=$(n),i=r.ka.get(e),o=r.qa.get(i.targetId);if(o.length>1)return r.qa.set(i.targetId,o.filter(a=>!ls(a,e))),void r.ka.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield cc(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Hc(r.remoteStore,i.targetId),kc(r,i.targetId)}).catch(as))):(kc(r,i.targetId),yield cc(r.localStore,i.targetId,!0))})}function nE(n,e){return T(this,null,function*(){let t=$(n),r=t.ka.get(e),i=t.qa.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Hc(t.remoteStore,r.targetId))})}function Bf(n,e){return T(this,null,function*(){let t=$(n);try{let r=yield Fv(t.localStore,e);e.targetChanges.forEach((i,o)=>{let a=t.Ka.get(o);a&&(te(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Ba=!0:i.modifiedDocuments.size>0?te(a.Ba):i.removedDocuments.size>0&&(te(a.Ba),a.Ba=!1))}),yield $f(t,r,e)}catch(r){yield as(r)}})}function kd(n,e,t){let r=$(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.ka.forEach((o,a)=>{let u=a.view.sa(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){let h=$(a);h.onlineState=u;let f=!1;h.queries.forEach((m,I)=>{for(let S of I.ta)S.sa(u)&&(f=!0)}),f&&Xc(h)}(r.eventManager,e),i.length&&r.La.p_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function rE(n,e,t){return T(this,null,function*(){let r=$(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Ka.get(e),o=i&&i.key;if(o){let a=new ie(L.comparator);a=a.insert(o,Me.newNoDocument(o,F.min()));let u=j().add(o),h=new Bi(F.min(),new Map,new ie(q),a,u);yield Bf(r,h),r.$a=r.$a.remove(o),r.Ka.delete(e),eu(r)}else yield cc(r.localStore,e,!1).then(()=>kc(r,e,t)).catch(as)})}function kc(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.qa.get(e))n.ka.delete(r),t&&n.La.Ja(r,t);n.qa.delete(e),n.isPrimaryClient&&n.Ua.br(e).forEach(r=>{n.Ua.containsKey(r)||qf(n,r)})}function qf(n,e){n.Qa.delete(e.path.canonicalString());let t=n.$a.get(e);t!==null&&(Hc(n.remoteStore,t),n.$a=n.$a.remove(e),n.Ka.delete(t),eu(n))}function Dd(n,e,t){for(let r of t)r instanceof Xi?(n.Ua.addReference(r.key,e),iE(n,r)):r instanceof Zi?(D(Zc,"Document no longer in limbo: "+r.key),n.Ua.removeReference(r.key,e),n.Ua.containsKey(r.key)||qf(n,r.key)):M()}function iE(n,e){let t=e.key,r=t.path.canonicalString();n.$a.get(t)||n.Qa.has(r)||(D(Zc,"New document in limbo: "+t),n.Qa.add(r),eu(n))}function eu(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){let e=n.Qa.values().next().value;n.Qa.delete(e);let t=new L(ae.fromString(e)),r=n.za.next();n.Ka.set(r,new Pc(t)),n.$a=n.$a.insert(t,r),Vf(n.remoteStore,new Ir($e(Gc(t.path)),r,"TargetPurposeLimboResolution",qc.ae))}}function $f(n,e,t){return T(this,null,function*(){let r=$(n),i=[],o=[],a=[];r.ka.isEmpty()||(r.ka.forEach((u,h)=>{a.push(r.Ha(h,e,t).then(f=>{var m;if((f||t)&&r.isPrimaryClient){let I=f?!f.fromCache:(m=t?.targetChanges.get(h.targetId))===null||m===void 0?void 0:m.current;r.sharedClientState.updateQueryState(h.targetId,I?"current":"not-current")}if(f){i.push(f);let I=ic.Yi(h.targetId,f);o.push(I)}}))}),yield Promise.all(a),r.La.p_(i),yield function(h,f){return T(this,null,function*(){let m=$(h);try{yield m.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>P.forEach(f,S=>P.forEach(S.Hi,R=>m.persistence.referenceDelegate.addReference(I,S.targetId,R)).next(()=>P.forEach(S.Ji,R=>m.persistence.referenceDelegate.removeReference(I,S.targetId,R)))))}catch(I){if(!An(I))throw I;D(Kc,"Failed to update sequence numbers: "+I)}for(let I of f){let S=I.targetId;if(!I.fromCache){let R=m.Ts.get(S),O=R.snapshotVersion,V=R.withLastLimboFreeSnapshotVersion(O);m.Ts=m.Ts.insert(S,V)}}})}(r.localStore,o))})}function sE(n,e){return T(this,null,function*(){let t=$(n);if(!t.currentUser.isEqual(e)){D(Zc,"User change. New user:",e.toKey());let r=yield Nf(t.localStore,e);t.currentUser=e,function(o,a){o.Ga.forEach(u=>{u.forEach(h=>{h.reject(new x(k.CANCELLED,a))})}),o.Ga.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield $f(t,r.Rs)}})}function oE(n,e){let t=$(n),r=t.Ka.get(e);if(r&&r.Ba)return j().add(r.key);{let i=j(),o=t.qa.get(e);if(!o)return i;for(let a of o){let u=t.ka.get(a);i=i.unionWith(u.view.Sa)}return i}}function jf(n){let e=$(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Bf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=oE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=rE.bind(null,e),e.La.p_=Yv.bind(null,e.eventManager),e.La.Ja=Jv.bind(null,e.eventManager),e}var zf=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return T(this,null,function*(){this.serializer=xf(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),yield this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)})}tu(t,r){return null}nu(t,r){return null}eu(t){return Mv(this.persistence,new oc,t.initialUser,this.serializer)}Xa(t){return new Wi(rc.ri,this.serializer)}Za(t){return new uc}terminate(){return T(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Dc=class extends zf{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){te(this.persistence.referenceDelegate instanceof Gi);let r=this.persistence.referenceDelegate.garbageCollector;return new za(r,e.asyncQueue,t)}Xa(e){let t=this.cacheSizeBytes!==void 0?ke.withCacheSize(this.cacheSizeBytes):ke.DEFAULT;return new Wi(r=>Gi.ri(r,t),this.serializer)}};var aE=(()=>{class n{initialize(t,r){return T(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>kd(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=sE.bind(null,this.syncEngine),yield Kv(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Tc}()}createDatastore(t){let r=xf(t.databaseInfo.databaseId),i=function(a){return new pc(a)}(t.databaseInfo);return function(a,u,h,f){return new yc(a,u,h,f)}(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return function(i,o,a,u,h){return new vc(i,o,a,u,h)}(this.localStore,this.datastore,t.asyncQueue,r=>kd(this.syncEngine,r,0),function(){return Hi.D()?new Hi:new lc}())}createSyncEngine(t,r){return function(o,a,u,h,f,m,I){let S=new Cc(o,a,u,h,f,m);return I&&(S.ja=!0),S}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return T(this,null,function*(){var t,r;yield function(o){return T(this,null,function*(){let a=$(o);D(En,"RemoteStore shutting down."),a.W_.add(5),yield br(a),a.z_.shutdown(),a.j_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var Nc=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):it("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Et="FirestoreClient",Oc=class{constructor(e,t,r,i,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ue.UNAUTHENTICATED,this.clientId=pa.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,a=>T(this,null,function*(){D(Et,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(D(Et,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new yt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>T(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Ff(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function aa(n,e){return T(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),D(Et,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>T(this,null,function*(){r.isEqual(i)||(yield Nf(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function Nd(n,e){return T(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield cE(n);D(Et,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Rd(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Rd(e.remoteStore,i)),n._onlineComponents=e})}function cE(n){return T(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){D(Et,"Using user provided OfflineComponentProvider");try{yield aa(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===k.FAILED_PRECONDITION||i.code===k.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;ln("Error using user provided cache. Falling back to memory cache: "+t),yield aa(n,new zf)}}else D(Et,"Using default OfflineComponentProvider"),yield aa(n,new Dc(void 0));return n._offlineComponents})}function uE(n){return T(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(D(Et,"Using user provided OnlineComponentProvider"),yield Nd(n,n._uninitializedComponentsProvider._online)):(D(Et,"Using default OnlineComponentProvider"),yield Nd(n,new aE))),n._onlineComponents})}function Od(n){return T(this,null,function*(){let e=yield uE(n),t=e.eventManager;return t.onListen=Xv.bind(null,e.syncEngine),t.onUnlisten=tE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Zv.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=nE.bind(null,e.syncEngine),t})}function Wf(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var xd=new Map;function lE(n,e,t){if(!t)throw new x(k.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function hE(n,e,t,r){if(e===!0&&r===!0)throw new x(k.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Vd(n){if(L.isDocumentKey(n))throw new x(k.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function dE(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":M()}function ki(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new x(k.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=dE(n);throw new x(k.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}var Gf="firestore.googleapis.com",Ld=!0,es=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new x(k.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Gf,this.ssl=Ld}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Ld;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Df;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<xv)throw new x(k.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}hE("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Wf((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new x(k.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new x(k.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new x(k.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},wr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new es({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(k.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new x(k.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new es(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new ca;switch(r.type){case"firstParty":return new da(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new x(k.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return T(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=xd.get(t);r&&(D("ComponentProvider","Removing Datastore"),xd.delete(t),r.terminate())}(this),Promise.resolve()}};function Kf(n,e,t,r={}){var i;let o=(n=ki(n,wr))._getSettings(),a=`${e}:${t}`;if(o.host!==Gf&&o.host!==a&&ln("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let u,h;if(typeof r.mockUserToken=="string")u=r.mockUserToken,h=ue.MOCK_USER;else{u=yl(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new x(k.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new ue(f)}n._authCredentials=new ua(new Di(u,h))}}var ts=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},jt=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new cn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},cn=class n extends ts{constructor(e,t,r){super(e,t,Gc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new jt(this.firestore,null,new L(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Hf(n,e,...t){if(n=Pe(n),lE("collection","path",e),n instanceof wr){let r=ae.fromString(e,...t);return Vd(r),new cn(n,null,r)}{if(!(n instanceof jt||n instanceof cn))throw new x(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ae.fromString(e,...t));return Vd(r),new cn(n.firestore,null,r)}}var Md="AsyncQueue",ns=class{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Qi(this,"async_queue_retry"),this.Su=()=>{let r=oa();r&&D(Md,"Visibility state changed to "+r.visibilityState),this.a_.t_()},this.bu=e;let t=oa();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;let t=oa();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});let t=new yt;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}Cu(){return T(this,null,function*(){if(this.Vu.length!==0){try{yield this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!An(e))throw e;D(Md,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}})}vu(e){let t=this.bu.then(()=>(this.pu=!0,e().catch(r=>{this.gu=r,this.pu=!1;let i=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(r);throw it("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.pu=!1,r))));return this.bu=t,t}enqueueAfterDelay(e,t,r){this.Du(),this.wu.indexOf(e)>-1&&(t=0);let i=Ec.createAndSchedule(this,e,t,r,o=>this.Fu(o));return this.fu.push(i),i}Du(){this.gu&&M()}verifyOperationInProgress(){}Mu(){return T(this,null,function*(){let e;do e=this.bu,yield e;while(e!==this.bu)})}xu(e){for(let t of this.fu)if(t.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.fu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){let t=this.fu.indexOf(e);this.fu.splice(t,1)}};function Fd(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let o of r)if(o in i&&typeof i[o]=="function")return!0;return!1}(n,["next","error","complete"])}var Tr=class extends wr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new ns,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return T(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new ns(e),this._firestoreClient=void 0,yield e}})}};function Qf(n,e){let t=typeof n=="object"?n:Je(),r=typeof n=="string"?n:e||Mi,i=Be(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let o=gl("firestore");o&&Kf(i,...o)}return i}function fE(n){if(n._terminated)throw new x(k.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||pE(n),n._firestoreClient}function pE(n){var e,t,r;let i=n._freezeSettings(),o=function(u,h,f,m){return new _a(u,h,f,m.host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,Wf(m.experimentalLongPollingOptions),m.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new Oc(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&function(u){let h=u?._online.build();return{_offline:u?._offline.build(h),_online:h}}(n._componentsProvider))}var xc=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ie.fromBase64String(e))}catch(t){throw new x(k.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ie.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var rs=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(k.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Le(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Vc=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(k.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(k.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return q(this._lat,e._lat)||q(this._long,e._long)}};var Lc=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0}(this._values,e._values)}};var mE=new RegExp("[~\\*/\\[\\]]");function gE(n,e,t){if(e.search(mE)>=0)throw Ud(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new rs(...e.split("."))._internalPath}catch{throw Ud(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ud(n,e,t,r,i){let o=r&&!r.isEmpty(),a=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new x(k.INVALID_ARGUMENT,u+n+h)}var is=class{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new jt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Mc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Yf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Mc=class extends is{data(){return super.data()}};function Yf(n,e){return typeof e=="string"?gE(n,e):e instanceof rs?e._internalPath:e._delegate._internalPath}function _E(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new x(k.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Fc=class{convertValue(e,t="none"){switch(It(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ee(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ot(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw M()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Ar(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertVectorValue(e){var t,r,i;let o=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[dr].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>ee(a.doubleValue));return new Lc(o)}convertGeoPoint(e){return new Vc(ee(e.latitude),ee(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=us(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(hr(e));default:return null}}convertTimestamp(e){let t=st(e);return new De(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ae.fromString(e);te(kf(r));let i=new Fi(r.get(1),r.get(3)),o=new L(r.popFirst(5));return i.isEqual(t)||it(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}};var Bt=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},ss=class extends is{constructor(e,t,r,i,o,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new un(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Yf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},un=class extends ss{data(e={}){return super.data(e)}},Uc=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Bt(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new un(this._firestore,this._userDataWriter,r.key,r,new Bt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(k.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let h=new un(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Bt(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>o||u.type!==3).map(u=>{let h=new un(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Bt(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),f=-1,m=-1;return u.type!==0&&(f=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),m=a.indexOf(u.doc.key)),{type:yE(u.type),doc:h,oldIndex:f,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function yE(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M()}}var os=class extends Fc{constructor(e){super(),this.firestore=e}convertBytes(e){return new xc(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new jt(this.firestore,null,t)}};function tu(n,...e){var t,r,i;n=Pe(n);let o={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Fd(e[a])||(o=e[a],a++);let u={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(Fd(e[a])){let I=e[a];e[a]=(t=I.next)===null||t===void 0?void 0:t.bind(I),e[a+1]=(r=I.error)===null||r===void 0?void 0:r.bind(I),e[a+2]=(i=I.complete)===null||i===void 0?void 0:i.bind(I)}let h,f,m;if(n instanceof jt)f=ki(n.firestore,Tr),m=Gc(n._key.path),h={next:I=>{e[a]&&e[a](IE(f,n,I))},error:e[a+1],complete:e[a+2]};else{let I=ki(n,ts);f=ki(I.firestore,Tr),m=I._query;let S=new os(f);h={next:R=>{e[a]&&e[a](new Uc(f,S,I,R))},error:e[a+1],complete:e[a+2]},_E(n._query)}return function(S,R,O,V){let N=new Nc(V),G=new bc(R,N,O);return S.asyncQueue.enqueueAndForget(()=>T(this,null,function*(){return Hv(yield Od(S),G)})),()=>{N.su(),S.asyncQueue.enqueueAndForget(()=>T(this,null,function*(){return Qv(yield Od(S),G)}))}}(fE(f),m,u,h)}function IE(n,e,t){let r=t.docs.get(e._key),i=new os(n);return new ss(n,i,e._key,r,new Bt(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){Tn=i})(Yt),de(new re("firestore",(r,{instanceIdentifier:i,options:o})=>{let a=r.getProvider("app").getImmediate(),u=new Tr(new la(r.getProvider("auth-internal")),new fa(a,r.getProvider("app-check-internal")),function(f,m){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new x(k.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Fi(f.options.projectId,m)}(a,i),a);return o=Object.assign({useFetchStreams:t},o),u._setSettings(o),u},"PUBLIC").setMultipleInstances(!0)),Y(Yh,Jh,e),Y(Yh,Jh,"esm2017")})();var fs=function(){return fs=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},fs.apply(this,arguments)};var wE={includeMetadataChanges:!1};function Jf(n,e){return e===void 0&&(e=wE),new St(function(t){var r=tu(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function Xf(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:fs(fs({},r),(t={},t[e.idField]=n.id,t))}function Zf(n){return Jf(n,{includeMetadataChanges:!0}).pipe($s(function(e){return e.docs}))}function ep(n,e){return e===void 0&&(e={}),Zf(n).pipe($s(function(t){return t.map(function(r){return Xf(r,e)})}))}var Rr=class{constructor(e){return e}},tp="firestore",nu=class{constructor(){return mt(tp)}};var ru=new Ht("angularfire2.firestore-instances");function TE(n,e){let t=Xt(tp,n,e);return t&&new Rr(t)}function AE(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Rr(r)}}var bE={provide:nu,deps:[[new Oe,ru]]},SE={provide:Rr,useFactory:TE,deps:[[new Oe,ru],et]};function US(n,...e){return Y("angularfire",Xe.full,"fst"),Qt([SE,bE,{provide:ru,useFactory:AE(n),multi:!0,deps:[Fe,dt,Ze,Dt,[new Oe,wi],[new Oe,hi],...e]}])}var BS=xe(ep,!0);var qS=xe(Hf,!0,2);var $S=xe(Qf,!0);export{kw as a,Dw as b,nr as c,BA as d,qA as e,jA as f,Rr as g,US as h,BS as i,qS as j,$S as k};
